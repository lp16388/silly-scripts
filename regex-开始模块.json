{
    "id": "bc6db429-be11-4e21-b31f-daa5530d846a",
    "scriptName": "开始模块",
    "findRegex": "\\[开始游戏.*\\]",
    "replaceString": "<!doctype html><html lang=\"zh-CN\"><head><meta charset=\"UTF-8\"/><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/><title>白木市魔法少女角色创建</title><style>:root{--primary-pink:#ff69b4;--primary-purple:#9370db;--primary-blue:#4682b4;--evil-red:#8b0000;--neutral-gray:#6c757d;--bg-gradient:linear-gradient(135deg,#667eea 0%,#764ba2 100%);--card-shadow:0 8px 32px rgba(0,0,0,0.1);--hover-shadow:0 12px 40px rgba(0,0,0,0.15);--text-primary:#2c3e50;--text-secondary:#6c757d;--border-color:#e9ecef;--border-radius:12px;--transition:all 0.3s cubic-bezier(0.4,0,0.2,1)}*{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",Arial,sans-serif;line-height:1.6;color:var(--text-primary);background:var(--bg-gradient);min-width:280px;overflow-x:hidden}.magical-girl-creator{position:relative;width:100%;max-width:1200px;margin:0 auto;padding:20px;min-height:100vh}.header-section{text-align:center;margin-bottom:40px;position:relative;z-index:2}.main-title{font-size:clamp(2rem,5vw,3rem);font-weight:700;color:#fff;text-shadow:2px 2px 4px rgba(0,0,0,.3);margin-bottom:10px}.main-title .sparkle{display:inline-block;animation:sparkle 2s ease-in-out infinite alternate}.subtitle{font-size:clamp(1rem,3vw,1.2rem);color:hsla(0,0%,100%,.9);text-shadow:1px 1px 2px rgba(0,0,0,.3)}.creator-form{background:hsla(0,0%,100%,.95);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:var(--border-radius);padding:30px;box-shadow:var(--card-shadow);position:relative;z-index:2}.section{margin-bottom:40px}.section:last-child{margin-bottom:0}.section-title{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin-bottom:20px;display:flex;align-items:center;gap:10px}.section-title .icon{font-size:1.2em}.faction-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px}.faction-card{background:#fff;border:2px solid var(--border-color);border-radius:var(--border-radius);padding:25px;text-align:center;cursor:pointer;transition:var(--transition);position:relative;overflow:hidden}.faction-card::before{content:\"\";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);transition:left .5s}.faction-card:hover{transform:translateY(-5px);box-shadow:var(--hover-shadow)}.faction-card:hover::before{left:100%}.faction-card.selected{border-width:3px;transform:scale(1.02)}.faction-card.selected[data-faction=magical_girl]{border-color:var(--primary-pink);background:linear-gradient(135deg,#fff,#fff0f5)}.faction-card.selected[data-faction=evil_forces]{border-color:var(--evil-red);background:linear-gradient(135deg,#fff,#fff5f5)}.faction-card.selected[data-faction=ordinary_people]{border-color:var(--primary-blue);background:linear-gradient(135deg,#fff,#f0f8ff)}.faction-icon{font-size:3rem;margin-bottom:15px;animation:float 3s ease-in-out infinite}.faction-name{font-size:1.2rem;font-weight:600;margin-bottom:10px;color:var(--text-primary)}.faction-desc{font-size:.9rem;color:var(--text-secondary);line-height:1.4}.job-grid{display:grid;gap:25px}.identity-section{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px}.identity-section h4{font-size:1.1rem;font-weight:600;color:var(--text-primary);margin-bottom:15px;padding:10px 15px;background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-radius:8px;border-left:4px solid var(--primary-purple)}.identity-section:first-child h4{border-left-color:var(--primary-pink)}.job-card{background:#fff;border:2px solid var(--border-color);border-radius:var(--border-radius);padding:20px;text-align:center;cursor:pointer;transition:transform .3s ease,box-shadow .3s ease,height .4s ease;overflow:hidden}.job-card .job-desc{font-size:.85em;color:#888;margin-top:8px}.job-card .job-detailed-desc{font-size:.9em;color:#555;margin-top:12px;padding-top:12px;border-top:1px solid #eee;opacity:0;max-height:0;transition:opacity .4s ease,max-height .4s ease,margin-top .4s ease,padding-top .4s ease}.job-card:hover{transform:translateY(-5px) scale(1.02);box-shadow:0 12px 24px rgba(0,0,0,.12)}.job-card:hover .job-detailed-desc{opacity:1;max-height:200px}.job-card.selected{border-color:var(--primary-purple);background:linear-gradient(135deg,#fff,#f8f4ff);transform:scale(1.02)}.job-card.supernatural-identity.selected{border-color:var(--primary-pink);background:linear-gradient(135deg,#fff,#fff8fb)}.job-card.ordinary-identity.selected{border-color:var(--primary-blue);background:linear-gradient(135deg,#fff,#f0f8ff)}.job-card.disabled{opacity:.5;cursor:not-allowed;pointer-events:none}.job-icon{font-size:2rem;margin-bottom:10px;display:block}.job-name{font-size:1rem;font-weight:600;margin-bottom:8px;color:var(--text-primary)}.location-container{display:flex;flex-direction:column;gap:20px}.city-selector{display:flex;align-items:center;gap:10px}.city-selector label{font-weight:500;color:var(--text-primary)}.city-selector select{padding:10px;border:2px solid var(--border-color);border-radius:8px;background:#fff;font-size:1rem;cursor:pointer;transition:var(--transition)}.city-selector select:focus{outline:none;border-color:var(--primary-purple)}.location-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px}.location-card{background:#fff;border:2px solid var(--border-color);border-radius:var(--border-radius);padding:20px;cursor:pointer;transition:var(--transition)}.location-card:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(0,0,0,.1)}.location-card.selected{border-color:var(--primary-blue);background:linear-gradient(135deg,#fff,#f0f8ff);transform:scale(1.02)}.location-card.disabled{opacity:.5;cursor:not-allowed;pointer-events:none}.location-name{font-size:1rem;font-weight:600;margin-bottom:8px;color:var(--text-primary)}.location-desc{font-size:.85rem;color:var(--text-secondary);line-height:1.3}.location-category{display:inline-block;background:var(--primary-blue);color:#fff;padding:2px 8px;border-radius:12px;font-size:.7rem;font-weight:500;margin-top:8px}.basic-info-grid{display:grid;grid-template-columns:1fr 1fr;gap:30px}@media (max-width:768px){.basic-info-grid{grid-template-columns:1fr;gap:20px}}.input-group{display:flex;flex-direction:column;gap:10px}.input-group label{font-weight:500;color:var(--text-primary)}.input-group input[type=text]{padding:12px;border:2px solid var(--border-color);border-radius:8px;font-size:1rem;transition:var(--transition)}.input-group input[type=text]:focus{outline:none;border-color:var(--primary-purple)}.gender-options{display:flex;gap:15px;flex-wrap:wrap}.gender-option{display:flex;align-items:center;cursor:pointer}.gender-option input[type=radio]{display:none}.gender-option .gender-label{padding:8px 16px;border:2px solid var(--border-color);border-radius:20px;background:#fff;transition:var(--transition);font-size:.9rem;font-weight:500}.gender-option input[type=radio]:checked+.gender-label{border-color:var(--primary-purple);background:var(--primary-purple);color:#fff}.description-container{position:relative}textarea{width:100%;padding:15px;border:2px solid var(--border-color);border-radius:var(--border-radius);font-size:1rem;font-family:inherit;line-height:1.6;resize:vertical;min-height:120px;transition:var(--transition)}textarea:focus{outline:none;border-color:var(--primary-purple)}.char-counter{position:absolute;bottom:10px;right:15px;font-size:.8rem;color:var(--text-secondary);background:hsla(0,0%,100%,.9);padding:2px 6px;border-radius:4px}.character-preview{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-radius:var(--border-radius);padding:25px}.preview-card{background:#fff;border-radius:var(--border-radius);padding:25px;box-shadow:0 4px 15px rgba(0,0,0,.1)}.preview-header{text-align:center;margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid var(--border-color)}.preview-name{font-size:1.5rem;font-weight:700;color:var(--text-primary);margin-bottom:5px}.preview-faction{font-size:1rem;color:var(--text-secondary);font-weight:500}.preview-details{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin-bottom:20px}.preview-item{display:flex;flex-direction:column;gap:5px}.preview-item .label{font-size:.9rem;color:var(--text-secondary);font-weight:500}.preview-item .value{font-size:1rem;color:var(--text-primary);font-weight:600}.preview-description .desc-label{font-size:.9rem;color:var(--text-secondary);font-weight:500;margin-bottom:8px}.preview-description .desc-content{font-size:1rem;color:var(--text-primary);line-height:1.6;padding:15px;background:#f8f9fa;border-radius:8px;border-left:4px solid var(--primary-purple)}.actions-section{text-align:center}.action-buttons{display:flex;justify-content:center;gap:20px;margin-bottom:15px;flex-wrap:wrap}.create-btn,.reset-btn{display:flex;align-items:center;gap:10px;padding:15px 30px;border:none;border-radius:25px;font-size:1.1rem;font-weight:600;cursor:pointer;transition:var(--transition);text-decoration:none}.create-btn .btn-icon,.reset-btn .btn-icon{font-size:1.2em}.create-btn{background:linear-gradient(135deg,var(--primary-pink),var(--primary-purple));color:#fff}.create-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 25px rgba(255,105,180,.4)}.create-btn:disabled{background:var(--neutral-gray);cursor:not-allowed;opacity:.6}.reset-btn{background:#fff;color:var(--text-primary);border:2px solid var(--border-color)}.reset-btn:hover{transform:translateY(-2px);border-color:var(--text-primary);box-shadow:0 8px 25px rgba(0,0,0,.1)}.validation-message{font-size:.9rem;color:var(--text-secondary);font-style:italic}.background-effects{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1;overflow:hidden}.star{position:absolute;font-size:2rem;animation:float 6s ease-in-out infinite;opacity:.7}.star-1{top:10%;left:10%;animation-delay:0s}.star-2{top:20%;right:15%;animation-delay:1s}.star-3{top:60%;left:5%;animation-delay:2s}.star-4{bottom:30%;right:10%;animation-delay:3s}.star-5{bottom:10%;left:20%;animation-delay:4s}.star-6{top:40%;right:5%;animation-delay:5s}@keyframes sparkle{0%{transform:scale(1)}100%{transform:scale(1.1)}}@keyframes float{0%,100%{transform:translateY(0px)}50%{transform:translateY(-20px)}}.no-selection{text-align:center;color:var(--text-secondary);font-style:italic;padding:40px 20px;border:2px dashed var(--border-color);border-radius:var(--border-radius);background:#f8f9fa}.loading{opacity:.6;pointer-events:none}.result-section{margin-top:30px;animation:fadeIn .5s ease-in-out}.result-card{background:#fff;border:1px solid var(--border-color);border-radius:var(--border-radius);padding:25px;margin-bottom:20px;box-shadow:var(--shadow-medium);transition:var(--transition)}.result-card:hover{box-shadow:var(--shadow-large);transform:translateY(-2px)}.card-title{display:flex;align-items:center;gap:10px;font-size:1.3rem;font-weight:600;color:var(--text-primary);margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid var(--border-color)}.card-title .card-icon{font-size:1.4em}.character-info-content .character-name{font-size:1.5rem;font-weight:700;color:var(--primary-pink);margin-bottom:10px}.character-info-content .character-details{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}.character-info-content .character-details .detail-item{padding:12px;background:#f8f9fa;border-radius:8px;border-left:4px solid var(--primary-pink)}.character-info-content .character-details .detail-item .detail-label{font-weight:600;color:var(--text-secondary);font-size:.9rem;margin-bottom:5px}.character-info-content .character-details .detail-item .detail-value{color:var(--text-primary);font-weight:500}.character-info-content .character-description{padding:15px;background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-radius:10px;line-height:1.6;color:var(--text-primary)}.story-content{line-height:1.8;color:var(--text-primary);padding:20px;background:linear-gradient(135deg,#f1f8ff,#e8f4f8);border-radius:10px;border-left:5px solid var(--primary-blue);font-size:1.05rem}.story-content p{margin-bottom:15px}.story-content p:last-child{margin-bottom:0}.combat-content{display:grid;gap:25px}.panel-title{font-size:1.1rem;font-weight:600;color:var(--text-primary);margin-bottom:15px;padding-bottom:8px;border-bottom:1px solid var(--border-color)}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px}.stats-grid .stat-item{display:flex;flex-direction:column;align-items:center;padding:15px;background:linear-gradient(135deg,#fff,#f8f9fa);border:1px solid var(--border-color);border-radius:10px;transition:var(--transition)}.stats-grid .stat-item:hover{transform:translateY(-2px);box-shadow:var(--shadow-medium)}.stats-grid .stat-item .stat-icon{font-size:2rem;margin-bottom:8px}.stats-grid .stat-item .stat-name{font-weight:600;color:var(--text-secondary);font-size:.9rem;margin-bottom:5px}.stats-grid .stat-item .stat-value{font-size:1.3rem;font-weight:700;color:var(--primary-pink)}.cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px}.cards-grid .card-item{background:#fff;border:2px solid var(--border-color);border-radius:10px;padding:15px;transition:var(--transition);position:relative;overflow:hidden}.cards-grid .card-item:hover{transform:translateY(-3px);box-shadow:var(--shadow-large);border-color:var(--primary-pink)}.cards-grid .card-item .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.cards-grid .card-item .card-header .card-name{font-weight:600;color:var(--text-primary);font-size:1rem}.cards-grid .card-item .card-header .card-cost{background:var(--primary-pink);color:#fff;border-radius:50%;width:25px;height:25px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.9rem}.cards-grid .card-item .card-type{display:inline-block;padding:3px 8px;background:var(--neutral-gray);color:#fff;border-radius:12px;font-size:.8rem;font-weight:500;margin-bottom:10px}.cards-grid .card-item .card-description{font-size:.9rem;line-height:1.4;color:var(--text-secondary)}.cards-grid .card-item .card-rarity{position:absolute;top:8px;right:8px;font-size:1.2rem}.relics-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:15px}.relics-grid .relic-item{background:linear-gradient(135deg,#fff,#f8f9fa);border:2px solid var(--border-color);border-radius:12px;padding:20px;transition:var(--transition);position:relative}.relics-grid .relic-item:hover{transform:translateY(-3px);box-shadow:var(--shadow-large);border-color:var(--primary-purple)}.relics-grid .relic-item .relic-header{display:flex;align-items:center;gap:12px;margin-bottom:15px}.relics-grid .relic-item .relic-header .relic-icon{font-size:2rem}.relics-grid .relic-item .relic-header .relic-info{flex:1}.relics-grid .relic-item .relic-header .relic-info .relic-name{font-weight:600;color:var(--text-primary);font-size:1.1rem;margin-bottom:3px}.relics-grid .relic-item .relic-header .relic-info .relic-rarity{font-size:.8rem;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.5px}.relics-grid .relic-item .relic-description{line-height:1.5;color:var(--text-primary);font-size:.95rem}.result-actions{display:flex;gap:15px;justify-content:center;flex-wrap:wrap;margin-top:30px;padding-top:25px;border-top:2px solid var(--border-color)}.result-actions button{display:flex;align-items:center;gap:8px;padding:12px 25px;border:none;border-radius:25px;font-size:1rem;font-weight:600;cursor:pointer;transition:var(--transition);text-decoration:none}.result-actions button .btn-icon{font-size:1.1em}.result-actions button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.15)}.result-actions .regenerate-btn{background:linear-gradient(135deg,#ffa726,#ff7043);color:#fff}.result-actions .regenerate-btn:hover{box-shadow:0 6px 20px rgba(255,167,38,.4)}.result-actions .save-btn{background:linear-gradient(135deg,#4caf50,#2e7d32);color:#fff}.result-actions .save-btn:hover{box-shadow:0 6px 20px rgba(76,175,80,.4)}.result-actions .start-game-btn{background:linear-gradient(135deg,var(--primary-pink),var(--primary-purple));color:#fff}.result-actions .start-game-btn:hover{box-shadow:0 6px 20px rgba(255,105,180,.4)}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@media (max-width:768px){.magical-girl-creator{padding:15px}.creator-form{padding:20px}.faction-grid{grid-template-columns:1fr}.job-grid{grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}.location-grid{grid-template-columns:1fr}.action-buttons{flex-direction:column;align-items:center}.create-btn,.reset-btn{width:100%;max-width:300px}.star{font-size:1.5rem}}@media (max-width:480px){.main-title{font-size:1.8rem}.subtitle{font-size:.9rem}.section-title{font-size:1.2rem}.job-grid{grid-template-columns:1fr}.gender-options{flex-direction:column;gap:10px}}.city-grid,.location-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;margin-top:15px}.city-card,.location-card{background-color:#fff;border-radius:12px;padding:20px;text-align:center;border:2px solid rgba(0,0,0,0);cursor:pointer;box-shadow:0 4px 6px rgba(0,0,0,.05);transition:transform .3s ease,box-shadow .3s ease}.city-card .city-emoji,.location-card .city-emoji{font-size:2.5em;margin-bottom:10px}.city-card .city-name,.city-card .location-name,.location-card .city-name,.location-card .location-name{font-size:1.2em;font-weight:bold;color:#333}.city-card .city-status,.location-card .city-status{font-size:.8em;color:#fff;background-color:#ffc107;padding:2px 8px;border-radius:10px;display:inline-block;margin-top:8px}.city-card .city-desc,.city-card .location-desc,.location-card .city-desc,.location-card .location-desc{font-size:.9em;color:#777;margin-top:8px}.city-card:hover,.location-card:hover{transform:translateY(-5px);box-shadow:0 8px 16px rgba(0,0,0,.1)}.city-card.selected,.location-card.selected{border-color:var(--primary-color);box-shadow:0 0 0 4px rgba(106,90,205,.2)}.city-card.disabled,.location-card.disabled{cursor:not-allowed;background-color:#f8f9fa;color:#adb5bd}.city-card.disabled .city-name,.city-card.disabled .location-name,.location-card.disabled .city-name,.location-card.disabled .location-name{color:#adb5bd}.city-card.disabled:hover,.location-card.disabled:hover{transform:none;box-shadow:0 4px 6px rgba(0,0,0,.05)}\n</style></head><body><div class=\"magical-girl-creator\" id=\"character-creator-container\"><div class=\"header-section\"><h1 class=\"main-title\"><span class=\"sparkle\">✨</span> 白木市角色创建 <span class=\"sparkle\">✨</span></h1><p class=\"subtitle\">在怪人与怪谈的现代都市中创建你的角色</p></div><div class=\"creator-form\"><div class=\"section faction-section\"><h2 class=\"section-title\"><span class=\"icon\">⚔️</span> 选择阵营</h2><div class=\"faction-grid\"><div class=\"faction-card\" data-faction=\"magical_girl\"><div class=\"faction-icon\">🌟</div><div class=\"faction-name\">魔法少女阵营</div><div class=\"faction-desc\">守护正义与和平的魔法使用者</div></div><div class=\"faction-card\" data-faction=\"evil_forces\"><div class=\"faction-icon\">👿</div><div class=\"faction-name\">邪恶敌对势力</div><div class=\"faction-desc\">企图破坏世界秩序的黑暗力量</div></div><div class=\"faction-card\" data-faction=\"ordinary_people\"><div class=\"faction-icon\">👥</div><div class=\"faction-name\">普通人</div><div class=\"faction-desc\">生活在现代社会中的普通民众</div></div></div></div><div class=\"section job-section\"><h2 class=\"section-title\"><span class=\"icon\">👔</span> 选择职业</h2><div class=\"job-grid\"></div></div><div class=\"section location-section\"><h2 class=\"section-title\"><span class=\"icon\">🏙️</span> 选择城市</h2><div class=\"city-grid\"></div></div><div class=\"section location-section\" id=\"location-section-container\" style=\"display:none\"><h2 class=\"section-title\"><span class=\"icon\">🏢</span> 选择所在地点</h2><div class=\"location-grid\"></div></div><div class=\"section description-section\"><h2 class=\"section-title\"><span class=\"icon\">💭</span> 额外描述（可选）</h2><div class=\"description-container\"><textarea id=\"custom-description\" placeholder=\"在这里添加角色的特殊设定、性格特点、背景故事等...&#10;例如：喜欢甜食的温柔女孩，有着不为人知的魔法天赋...\" rows=\"4\" maxlength=\"300\">\n            </textarea><div class=\"char-counter\"><span id=\"char-count\">0</span>/300</div></div></div><div class=\"section preview-section\"><h2 class=\"section-title\"><span class=\"icon\">👁️</span> 角色预览</h2><div class=\"character-preview\"><div class=\"preview-card\"><div class=\"preview-header\"><div class=\"preview-name\">未设置角色</div><div class=\"preview-faction\">请先选择阵营</div></div><div class=\"preview-details\"><div class=\"preview-item\"><span class=\"label\">职业：</span> <span class=\"value\" id=\"preview-job\">未选择</span></div><div class=\"preview-item\"><span class=\"label\">地点：</span> <span class=\"value\" id=\"preview-location\">未选择</span></div></div><div class=\"preview-description\"><div class=\"desc-label\">描述：</div><div class=\"desc-content\" id=\"preview-description\">AI将根据你的选择生成角色</div></div></div></div></div><div class=\"section actions-section\"><div class=\"action-buttons\"><button id=\"create-character-btn\" class=\"create-btn\" disabled=\"disabled\"><span class=\"btn-icon\">🎭</span> <span class=\"btn-text\">创建角色</span></button> <button id=\"reset-form-btn\" class=\"reset-btn\"><span class=\"btn-icon\">🔄</span> <span class=\"btn-text\">重置表单</span></button></div><div class=\"validation-message\" id=\"validation-message\">请选择阵营、职业和地点后才能创建角色</div></div></div></div><script>const e=[{id:'shiroki_high',name:'白木高中',description:'{{user}}就读的学校，是城市高中教育的中心',category:'school'},{id:'shiroki_middle',name:'白木初中',description:'城市主要的初中之一，培养青少年学生',category:'school'},{id:'shiroki_elementary',name:'白木小学',description:'城市重点小学，为儿童提供优质教育',category:'school'},{id:'user_home',name:'{{user}}的家',description:'{{user}}的生活起居场所',category:'residential'},{id:'city_hall',name:'白木市政大楼',description:'市政府所在地，处理城市行政事务',category:'public'},{id:'forever_convenience',name:'永夜便利店',description:'24小时营业的超市，满足居民日常需求',category:'commercial'},{id:'shirakawa_mansion',name:'白川豪宅',description:'城市中一座神秘的大宅院',category:'residential'},{id:'shiroki_shopping_street',name:'白木商业街',description:'繁华的购物区，汇集各类商铺',category:'commercial'},{id:'shiroki_mall',name:'白木购物中心',description:'豪华商场，聚集高端品牌',category:'commercial'},{id:'night_market',name:'夜市小吃街',description:'汇集各种地方特色小吃的美食天堂',category:'commercial'},{id:'shiroki_shrine',name:'白木神社',description:'城市中历史悠久的神社，市民祈福之地',category:'religious'},{id:'central_park',name:'白木中央公园',description:'城市中心的大型公园，市民休闲娱乐场所',category:'public'},{id:'shiroki_hotspring',name:'白木温泉',description:'城市著名的温泉度假区',category:'entertainment'},{id:'shiroki_cinema',name:'白木影院',description:'大型电影院，放映各类影片',category:'entertainment'}],t=[{id:'magical_guardian',name:'魔法守护者',description:'觉醒了魔法力量的守护者，守护正义与和平',detailedDescription:'天生的魔法使用者，通过与神明、精灵或概念意志签订契约获得力量。觉醒后会获得强大的魔法能力，能够变身并使用各种魔法技能来保护世界。',icon:'🌟',faction:'magical_girl'},{id:'guardian_spirit',name:'守护精灵',description:'辅助魔法守护者的神秘存在，提供指导和力量',detailedDescription:'通常为非人类的神秘存在，作为魔法守护者的引导者与力量之源。它们往往以可爱的小动物、玩偶或无机物的形态出现，负责寻找有资质的人类并引导他们签订契约。其本体可能极为强大，但受限于规则，只能以这种无害的形态示人。',icon:'✨',faction:'magical_girl'},{id:'dark_witch',name:'黑暗魔女',description:'堕入黑暗的前魔法使用者，力量强大但内心扭曲',detailedDescription:'通常是因绝望、背叛或强烈欲望而堕落的前魔法守护者。她们的力量源于负面情感，虽然强大，但极不稳定。她们精通诅咒与黑魔法，将曾经守护的一切视为嘲讽，以散播痛苦为乐。',icon:'🔮',faction:'evil_forces'},{id:'shadow_apostle',name:'阴影使徒',description:'侍奉黑暗势力的神秘存在，散布恐惧和绝望',detailedDescription:'黑暗主宰的忠实仆从，形态各异，可能是被改造的人类，也可能是来自异界的阴影生物。他们没有自我，只为执行主人的命令而存在，是黑暗势力最主要的行动人员，负责在城市中制造混乱与恐慌。',icon:'👤',faction:'evil_forces'},{id:'fallen_guardian',name:'堕落守护者',description:'被黑暗侵蚀的前魔法守护者，在光明与黑暗间挣扎',detailedDescription:'与黑暗魔女不同，堕落守护者并非自愿堕落。他们可能是在战斗中被强行污染，或是为了守护某物而不得不借助禁忌力量。内心仍在光明与黑暗间痛苦挣扎，时而清醒，时而疯狂，是极不稳定的危险存在。',icon:'💔',faction:'evil_forces'},{id:'demon_lord',name:'魔王',description:'黑暗势力的统治者，拥有毁灭性的力量',detailedDescription:'黑暗势力的顶点，是所有邪恶存在的源头或最高统帅。他们的目标是颠覆世界秩序，将一切拖入混沌。每一位魔王都拥有足以与一个国家抗衡的恐怖力量，其存在本身就是对世界法则的挑战。',icon:'👹',faction:'evil_forces'},{id:'potential_awakener',name:'潜在觉醒者',description:'普通人中隐藏着超自然潜能的存在，尚未觉醒',detailedDescription:'生活在城市中的普通人，但血脉或灵魂中隐藏着尚未被发现的超自然潜能。他们可能会在某个契机下觉醒，成为魔法守护者，也可能被黑暗诱惑而堕落。目前，他们只是比常人稍微幸运或不幸一点的普通市民。',icon:'🌱',faction:'ordinary_people'}],i=[{id:'student',name:'学生',description:'在校学习的学生，专注于学业和成长',icon:'📚'},{id:'office_worker',name:'上班族',description:'忙碌的都市工作者，生活在规律的日常中',icon:'💼'},{id:'shop_owner',name:'店主',description:'经营着小店的普通人，见证着城市的变化',icon:'🏪'},{id:'teacher',name:'教师',description:'教书育人的老师，关心学生的成长',icon:'👨‍🏫'},{id:'freelancer',name:'自由职业者',description:'独立工作的创作者，有着灵活的生活方式',icon:'💻'},{id:'artist',name:'艺术家',description:'追求艺术创作的人，敏感而富有想象力',icon:'🎨'},{id:'doctor',name:'医生',description:'救死扶伤的医疗工作者，守护他人健康',icon:'⚕️'},{id:'police_officer',name:'警察',description:'维护治安的执法者，保护市民安全',icon:'👮'}],n=[{id:'shiroki',name:'白木市',description:'存在怪谈和怪人组织，但在魔法少女的保护下，是相对安全的多元化都市。',emoji:'🏙️',status:'available'},{id:'kogyoku',name:'红玉市',description:'邪恶组织活动猖獗，其力量已严重影响到市民的日常生活。',emoji:'🌇',status:'developing'},{id:'kokuchou',name:'黑潮市',description:'极度混乱无序的法外之地，也是一个与外界几乎隔绝的神秘城市。',emoji:'🌃',status:'developing'}],o={magical_girl:{name:'魔法少女阵营',description:'守护正义与和平的魔法使用者',color:'#ff69b4',icon:'🌟'},evil_forces:{name:'邪恶敌对势力',description:'企图破坏世界秩序的黑暗力量',color:'#8b0000',icon:'👿'},ordinary_people:{name:'普通人',description:'生活在现代社会中的普通民众',color:'#4682b4',icon:'👥'}};class r{container;userName='{{user}}';currentConfig={name:this.userName};constructor(){if(this.container=document.getElementById('character-creator-container'),!this.container)return console.error('Character creator container not found! Looking for element with id=\"character-creator-container\"'),console.log('Available elements:',document.querySelectorAll('*')),void console.log('Body content:',document.body?.innerHTML?.substring(0,500));console.log('✅ Character creator container found:',this.container),this.initializeEventListeners(),this.renderDefaultState(),this.renderCityOptions(),this.fetchUserName()}async fetchUserName(){try{const e=await triggerSlash('/pass {{user}}');e&&(this.userName=e,this.currentConfig.name=this.userName,this.updatePreview())}catch(e){console.error('Failed to fetch user name:',e),this.userName='玩家',this.currentConfig.name=this.userName,this.updatePreview()}}initializeEventListeners(){console.log('🔧 开始绑定事件监听器');const e=document.querySelectorAll('.faction-card');console.log('找到阵营卡片:',e.length,e),e.forEach((e=>{e.addEventListener('click',(()=>{console.log('阵营卡片被点击:',e);const t=e.getAttribute('data-faction');console.log('选择的阵营:',t),this.selectFaction(t)}))}));const t=document.getElementById('custom-description');console.log('找到描述输入框:',t),t?.addEventListener('input',(()=>this.updateCharacterCounter()));const i=document.getElementById('reset-form-btn');console.log('找到重置按钮:',i),i?.addEventListener('click',(()=>this.resetForm()));const n=document.getElementById('create-character-btn');console.log('找到创建按钮:',n),n?.addEventListener('click',(()=>this.createCharacter())),console.log('✅ 事件监听器绑定完成')}selectFaction(e){console.log('🎯 selectFaction 被调用，选择的阵营:',e);const i=document.querySelectorAll('.faction-card');console.log('找到阵营卡片总数:',i.length),i.forEach((e=>e.classList.remove('selected')));const n=document.querySelector(`[data-faction=\"${e}\"]`);if(console.log('目标阵营卡片:',n),n?.classList.add('selected'),this.currentConfig.faction=e,console.log('当前配置更新为:',this.currentConfig),'ordinary_people'===e){const e=t.find((e=>'potential_awakener'===e.id));this.currentConfig.supernaturalIdentity=e||null,document.querySelectorAll('.supernatural-identity').forEach((e=>{e.style.pointerEvents='none',e.classList.remove('selected')}))}else this.currentConfig.supernaturalIdentity=void 0,document.querySelectorAll('.supernatural-identity').forEach((e=>{e.style.pointerEvents='auto'}));console.log('开始渲染职业选项...'),this.renderJobOptions(),console.log('开始更新预览...'),this.updatePreview(),console.log('开始验证表单...'),this.validateForm(),console.log('✅ selectFaction 执行完成')}renderCityOptions(){console.log('🏙️ 开始渲染城市选项');const e=document.querySelector('.city-grid');console.log('找到城市网格:',e),e?(e.innerHTML='',n.forEach((t=>{const i=document.createElement('div');i.className='city-card',i.dataset.cityId=t.id,'developing'===t.status&&i.classList.add('disabled'),i.innerHTML=`\\n        <div class=\"city-emoji\">${t.emoji}</div>\\n        <div class=\"city-name\">${t.name}</div>\\n        <div class=\"city-desc\">${t.description}</div>\\n        ${'developing'===t.status?'<div class=\"city-status\">开发中</div>':''}\\n      `,'available'===t.status&&i.addEventListener('click',(()=>this.selectCity(t))),e.appendChild(i)}))):console.log('❌ 城市网格未找到，退出渲染')}selectCity(e){document.querySelectorAll('.city-card').forEach((e=>e.classList.remove('selected'))),document.querySelector(`.city-card[data-city-id=\"${e.id}\"]`)?.classList.add('selected'),this.currentConfig.city=e,this.currentConfig.location=void 0;const t=document.getElementById('location-section-container');if(t&&(t.style.display='block'),'shiroki'===e.id)this.renderLocationOptions();else{const e=document.querySelector('.location-grid');e&&(e.innerHTML='')}this.updatePreview(),this.validateForm()}renderJobOptions(){console.log('🔨 开始渲染职业选项，当前阵营:',this.currentConfig.faction);const e=document.querySelector('.job-grid');if(console.log('找到职业网格:',e),!e||!this.currentConfig.faction)return void console.log('❌ 职业网格或阵营未找到，退出渲染');e.innerHTML='';const n=(e,t)=>{const i=document.createElement('div');return i.className='identity-section',i.innerHTML=`<h4>${e}</h4>`,t.forEach((e=>{const t=document.createElement('div'),n='faction'in e;t.className='job-card '+(n?'supernatural-identity':'ordinary-identity'),t.dataset.identityId=e.id,t.innerHTML=`\\n          <div class=\"job-icon\">${e.icon}</div>\\n          <div class=\"job-name\">${n?this.getIdentityDisplayName(e):e.name}</div>\\n          <div class=\"job-desc\">${e.description}</div>\\n          <div class=\"job-detailed-desc\">${n?e.detailedDescription:''}</div>\\n        `,n?t.addEventListener('click',(()=>this.selectSupernaturalIdentity(e))):t.addEventListener('click',(()=>this.selectOrdinaryIdentity(e))),i.appendChild(t)})),i},o=t.filter((e=>e.faction===this.currentConfig.faction));o.length>0&&e.appendChild(n('超自然身份',o)),e.appendChild(n('普通身份',i))}getIdentityDisplayName(e){return e.name}selectSupernaturalIdentity(e){document.querySelectorAll('.supernatural-identity').forEach((e=>e.classList.remove('selected'))),document.querySelectorAll('.ordinary-identity').forEach((e=>e.classList.remove('selected'))),document.querySelector(`[data-identity-id=\"${e.id}\"]`)?.classList.add('selected'),this.currentConfig.supernaturalIdentity=e,this.currentConfig.ordinaryIdentity||(this.currentConfig.ordinaryIdentity=i[0],document.querySelector(`.ordinary-identity[data-identity-id=\"${i[0].id}\"]`)?.classList.add('selected')),this.updatePreview(),this.validateForm()}selectOrdinaryIdentity(e){document.querySelectorAll('.ordinary-identity').forEach((e=>e.classList.remove('selected'))),document.querySelector(`[data-identity-id=\"${e.id}\"]`)?.classList.add('selected'),this.currentConfig.ordinaryIdentity=e,'ordinary_people'!==this.currentConfig.faction&&void 0===this.currentConfig.supernaturalIdentity&&(this.currentConfig.supernaturalIdentity=null),this.updatePreview(),this.validateForm()}renderLocationOptions(){const t=document.querySelector('.location-grid');t&&(t.innerHTML='',e.forEach((e=>{const i=document.createElement('div');i.className='location-card',i.dataset.locationId=e.id,i.innerHTML=`\\n        <div class=\"location-name\">${e.name}</div>\\n        <div class=\"location-desc\">${e.description}</div>\\n        <div class=\"location-category\">${this.getCategoryName(e.category)}</div>\\n      `,i.addEventListener('click',(()=>this.selectLocation(e))),t.appendChild(i)})))}selectLocation(e){document.querySelectorAll('.location-card').forEach((e=>e.classList.remove('selected'))),document.querySelector(`[data-location-id=\"${e.id}\"]`)?.classList.add('selected'),this.currentConfig.location=e,this.updatePreview(),this.validateForm()}getCategoryName(e){return{school:'学校',public:'公共设施',commercial:'商业区',residential:'居住区',religious:'宗教场所',entertainment:'娱乐场所'}[e]||e}updatePreview(){this.updatePreviewDisplay()}updatePreviewDisplay(){const e={name:document.querySelector('.preview-name'),faction:document.querySelector('.preview-faction'),job:document.getElementById('preview-job'),location:document.getElementById('preview-location'),description:document.getElementById('preview-description')},t=e.name;t&&(t.textContent=this.currentConfig.name||'未设置角色');const i=e.faction,n=this.currentConfig.faction;if(n){const e=o[n];i.textContent=e.name,i.style.backgroundColor=e.color,i.style.visibility='visible'}else i.textContent='请先选择阵营',i.style.visibility='hidden';const r=e.job;if(r){let e='未选择';this.currentConfig.supernaturalIdentity?e=this.getIdentityDisplayName(this.currentConfig.supernaturalIdentity):null===this.currentConfig.supernaturalIdentity&&(e='待定'),r.textContent=e}const c=e.location;if(c){let e=this.currentConfig.city?this.currentConfig.city.name:'未选择城市';this.currentConfig.location&&(e=`${this.currentConfig.city?.name} - ${this.currentConfig.location.name}`),c.textContent=e}const s=e.description;s&&(this.isConfigValid(this.currentConfig)?s.textContent='点击\"创建角色\"后，将根据您的选择生成描述并开始故事。':s.textContent='AI将根据你的选择生成角色')}updateCharacterCounter(){const e=document.getElementById('custom-description'),t=document.getElementById('char-count');if(e&&t){const i=e.value.length;t.textContent=i.toString(),t.style.color=i>250?'#dc3545':i>200?'#ffc107':'#6c757d'}this.updatePreview()}validateForm(){const e=document.getElementById('create-character-btn'),t=document.getElementById('validation-message');this.isConfigValid(this.currentConfig)?(e.disabled=!1,t.style.display='none'):(e.disabled=!0,t.style.display='block')}async createCharacter(){console.log('🎭 开始创建角色');const e=document.getElementById('custom-description');if(e&&(this.currentConfig.customDescription=e.value.trim()),!this.isConfigValid(this.currentConfig))return void this.showMessage('请完善角色信息后再创建','warning');const t=this.currentConfig;console.log('✅ 角色配置验证通过:',t);try{console.log('📝 生成角色描述文本...');const e=this.buildUserDescription(t);console.log('角色描述生成完成:',e),this.showMessage('角色创建成功！正在启动游戏...','success'),await new Promise((e=>setTimeout(e,1e3)));try{console.log('📤 发送角色描述为用户消息...'),await triggerSlash(`/send ${e}`),console.log('🚀 触发AI对话...'),await triggerSlash('/trigger'),console.log('✨ 游戏启动成功！'),this.showMessage('游戏已启动！AI正在生成开场剧情...','info')}catch(e){console.error('❌ TavernHelper API 调用失败:',e),this.showMessage('TavernHelper API 调用失败，无法启动游戏。','error')}}catch(e){console.error('❌ 创建角色失败:',e),this.showMessage('创建角色失败，请重试。','error')}}buildUserDescription(e){const t=[];t.push(`我是${e.name}。`);return t.push(`我属于${{magical_girl:'魔法少女',ordinary_people:'普通人',evil_forces:'邪恶势力'}[e.faction]}阵营。`),e.ordinaryIdentity&&t.push(`我的普通身份是${e.ordinaryIdentity.name}：${e.ordinaryIdentity.description}`),e.supernaturalIdentity&&t.push(`我的超自然身份是${e.supernaturalIdentity.name}：${e.supernaturalIdentity.description}`),e.city&&t.push(`我生活在${e.city.name}。${e.city.description}`),e.location&&t.push(`我目前在${e.location.name}。${e.location.description}`),e.customDescription&&e.customDescription.trim()&&t.push(`\\n补充描述：${e.customDescription.trim()}`),t.push('\\n请开始我的魔法少女RPG冒险吧！'),t.join(' ')}isConfigValid(e){const{faction:t,supernaturalIdentity:i,ordinaryIdentity:n,city:o,location:r}=e;return'ordinary_people'===t?!!(t&&n&&o&&r):!!(t&&i&&n&&o&&r)}showMessage(e,t){'undefined'!=typeof toastr?toastr[t](e,'',{closeButton:!0,timeOut:5e3,extendedTimeOut:2e3,progressBar:!0,positionClass:'toast-top-center'}):(console.log(`[${t}] ${e}`),alert(`[${t}] ${e}`))}resetForm(){this.currentConfig={name:this.userName},document.querySelectorAll('.faction-card, .job-card, .location-card, .city-card').forEach((e=>{e.classList.remove('selected')})),document.getElementById('custom-description').value='';const e=document.getElementById('location-section-container');e&&(e.style.display='none');const t=document.querySelector('.location-grid');t&&(t.innerHTML='\\x3c!-- 地点选项将通过JS动态生成 --\\x3e');const i=document.querySelector('.job-grid');i&&(i.innerHTML='\\x3c!-- 职业选项将通过JS动态生成 --\\x3e'),this.updateCharacterCounter(),this.updatePreview(),this.validateForm();const n=document.getElementById('create-character-btn');n&&(n.disabled=!0,n.querySelector('.btn-text').textContent='创建角色'),this.showMessage('表单已重置。','info')}renderDefaultState(){this.updatePreview(),this.updateCharacterCounter(),this.validateForm()}}console.log('🌟 白木市魔法少女角色创建系统启动');const c=()=>{console.log('🚀 开始初始化角色创建系统');try{if('undefined'==typeof document)return void console.error('❌ 文档对象未找到');new r,console.log('✨ 角色创建系统初始化完成')}catch(e){console.error('❌ 角色创建系统初始化失败:',e)}};'loading'===document.readyState?document.addEventListener('DOMContentLoaded',c):c();</script></body></html><div class=\"section result-section\" id=\"result-section\" style=\"display:none\"><h2 class=\"section-title\"><span class=\"icon\">🌟</span> 角色生成结果</h2><div class=\"result-card character-info-card\"><h3 class=\"card-title\"><span class=\"card-icon\">👤</span> 角色信息</h3><div class=\"character-info-content\" id=\"character-info-content\"></div></div><div class=\"result-card story-card\"><h3 class=\"card-title\"><span class=\"card-icon\">📖</span> 初始剧情</h3><div class=\"story-content\" id=\"story-content\"></div></div><div class=\"result-card combat-card\"><h3 class=\"card-title\"><span class=\"card-icon\">⚔️</span> 战斗数据</h3><div class=\"combat-content\"><div class=\"stats-panel\" id=\"stats-panel\"><h4 class=\"panel-title\">角色属性</h4><div class=\"stats-grid\" id=\"stats-grid\"></div></div><div class=\"cards-panel\" id=\"cards-panel\"><h4 class=\"panel-title\">初始卡组</h4><div class=\"cards-grid\" id=\"cards-grid\"></div></div><div class=\"relics-panel\" id=\"relics-panel\"><h4 class=\"panel-title\">初始遗物</h4><div class=\"relics-grid\" id=\"relics-grid\"></div></div></div></div><div class=\"result-actions\"><button id=\"regenerate-btn\" class=\"regenerate-btn\"><span class=\"btn-icon\">🔄</span> <span class=\"btn-text\">重新生成</span></button> <button id=\"save-character-btn\" class=\"save-btn\"><span class=\"btn-icon\">💾</span> <span class=\"btn-text\">保存角色</span></button> <button id=\"start-game-btn\" class=\"start-game-btn\"><span class=\"btn-icon\">🎮</span> <span class=\"btn-text\">开始游戏</span></button></div></div><div class=\"background-effects\"><div class=\"star star-1\">⭐</div><div class=\"star star-2\">✨</div><div class=\"star star-3\">🌟</div><div class=\"star star-4\">💫</div><div class=\"star star-5\">⭐</div><div class=\"star star-6\">✨</div></div>",
    "trimStrings": [],
    "placement": [
        1,
        2
    ],
    "disabled": false,
    "markdownOnly": true,
    "promptOnly": false,
    "runOnEdit": true,
    "substituteRegex": 0,
    "minDepth": null,
    "maxDepth": 1
}