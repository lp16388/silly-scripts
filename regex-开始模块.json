{
    "id": "bc6db429-be11-4e21-b31f-daa5530d846a",
    "scriptName": "å¼€å§‹æ¨¡å—",
    "findRegex": "\\[å¼€å§‹æ¸¸æˆ.*\\]",
    "replaceString": "<!doctype html><html lang=\"zh-CN\"><head><meta charset=\"UTF-8\"/><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/><title>ç™½æœ¨å¸‚é­”æ³•å°‘å¥³è§’è‰²åˆ›å»º</title><style>:root{--primary-pink:#ff69b4;--primary-purple:#9370db;--primary-blue:#4682b4;--evil-red:#8b0000;--neutral-gray:#6c757d;--bg-gradient:linear-gradient(135deg,#667eea 0%,#764ba2 100%);--card-shadow:0 8px 32px rgba(0,0,0,0.1);--hover-shadow:0 12px 40px rgba(0,0,0,0.15);--text-primary:#2c3e50;--text-secondary:#6c757d;--border-color:#e9ecef;--border-radius:12px;--transition:all 0.3s cubic-bezier(0.4,0,0.2,1)}*{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",Arial,sans-serif;line-height:1.6;color:var(--text-primary);background:var(--bg-gradient);min-width:280px;overflow-x:hidden}.magical-girl-creator{position:relative;width:100%;max-width:1200px;margin:0 auto;padding:20px;min-height:100vh}.header-section{text-align:center;margin-bottom:40px;position:relative;z-index:2}.main-title{font-size:clamp(2rem,5vw,3rem);font-weight:700;color:#fff;text-shadow:2px 2px 4px rgba(0,0,0,.3);margin-bottom:10px}.main-title .sparkle{display:inline-block;animation:sparkle 2s ease-in-out infinite alternate}.subtitle{font-size:clamp(1rem,3vw,1.2rem);color:hsla(0,0%,100%,.9);text-shadow:1px 1px 2px rgba(0,0,0,.3)}.creator-form{background:hsla(0,0%,100%,.95);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:var(--border-radius);padding:30px;box-shadow:var(--card-shadow);position:relative;z-index:2}.section{margin-bottom:40px}.section:last-child{margin-bottom:0}.section-title{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin-bottom:20px;display:flex;align-items:center;gap:10px}.section-title .icon{font-size:1.2em}.faction-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px}.faction-card{background:#fff;border:2px solid var(--border-color);border-radius:var(--border-radius);padding:25px;text-align:center;cursor:pointer;transition:var(--transition);position:relative;overflow:hidden}.faction-card::before{content:\"\";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);transition:left .5s}.faction-card:hover{transform:translateY(-5px);box-shadow:var(--hover-shadow)}.faction-card:hover::before{left:100%}.faction-card.selected{border-width:3px;transform:scale(1.02)}.faction-card.selected[data-faction=magical_girl]{border-color:var(--primary-pink);background:linear-gradient(135deg,#fff,#fff0f5)}.faction-card.selected[data-faction=evil_forces]{border-color:var(--evil-red);background:linear-gradient(135deg,#fff,#fff5f5)}.faction-card.selected[data-faction=ordinary_people]{border-color:var(--primary-blue);background:linear-gradient(135deg,#fff,#f0f8ff)}.faction-icon{font-size:3rem;margin-bottom:15px;animation:float 3s ease-in-out infinite}.faction-name{font-size:1.2rem;font-weight:600;margin-bottom:10px;color:var(--text-primary)}.faction-desc{font-size:.9rem;color:var(--text-secondary);line-height:1.4}.job-grid{display:grid;gap:25px}.identity-section{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px}.identity-section h4{font-size:1.1rem;font-weight:600;color:var(--text-primary);margin-bottom:15px;padding:10px 15px;background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-radius:8px;border-left:4px solid var(--primary-purple)}.identity-section:first-child h4{border-left-color:var(--primary-pink)}.job-card{background:#fff;border:2px solid var(--border-color);border-radius:var(--border-radius);padding:20px;text-align:center;cursor:pointer;transition:transform .3s ease,box-shadow .3s ease,height .4s ease;overflow:hidden}.job-card .job-desc{font-size:.85em;color:#888;margin-top:8px}.job-card .job-detailed-desc{font-size:.9em;color:#555;margin-top:12px;padding-top:12px;border-top:1px solid #eee;opacity:0;max-height:0;transition:opacity .4s ease,max-height .4s ease,margin-top .4s ease,padding-top .4s ease}.job-card:hover{transform:translateY(-5px) scale(1.02);box-shadow:0 12px 24px rgba(0,0,0,.12)}.job-card:hover .job-detailed-desc{opacity:1;max-height:200px}.job-card.selected{border-color:var(--primary-purple);background:linear-gradient(135deg,#fff,#f8f4ff);transform:scale(1.02)}.job-card.supernatural-identity.selected{border-color:var(--primary-pink);background:linear-gradient(135deg,#fff,#fff8fb)}.job-card.ordinary-identity.selected{border-color:var(--primary-blue);background:linear-gradient(135deg,#fff,#f0f8ff)}.job-card.disabled{opacity:.5;cursor:not-allowed;pointer-events:none}.job-icon{font-size:2rem;margin-bottom:10px;display:block}.job-name{font-size:1rem;font-weight:600;margin-bottom:8px;color:var(--text-primary)}.location-container{display:flex;flex-direction:column;gap:20px}.city-selector{display:flex;align-items:center;gap:10px}.city-selector label{font-weight:500;color:var(--text-primary)}.city-selector select{padding:10px;border:2px solid var(--border-color);border-radius:8px;background:#fff;font-size:1rem;cursor:pointer;transition:var(--transition)}.city-selector select:focus{outline:none;border-color:var(--primary-purple)}.location-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px}.location-card{background:#fff;border:2px solid var(--border-color);border-radius:var(--border-radius);padding:20px;cursor:pointer;transition:var(--transition)}.location-card:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(0,0,0,.1)}.location-card.selected{border-color:var(--primary-blue);background:linear-gradient(135deg,#fff,#f0f8ff);transform:scale(1.02)}.location-card.disabled{opacity:.5;cursor:not-allowed;pointer-events:none}.location-name{font-size:1rem;font-weight:600;margin-bottom:8px;color:var(--text-primary)}.location-desc{font-size:.85rem;color:var(--text-secondary);line-height:1.3}.location-category{display:inline-block;background:var(--primary-blue);color:#fff;padding:2px 8px;border-radius:12px;font-size:.7rem;font-weight:500;margin-top:8px}.basic-info-grid{display:grid;grid-template-columns:1fr 1fr;gap:30px}@media (max-width:768px){.basic-info-grid{grid-template-columns:1fr;gap:20px}}.input-group{display:flex;flex-direction:column;gap:10px}.input-group label{font-weight:500;color:var(--text-primary)}.input-group input[type=text]{padding:12px;border:2px solid var(--border-color);border-radius:8px;font-size:1rem;transition:var(--transition)}.input-group input[type=text]:focus{outline:none;border-color:var(--primary-purple)}.gender-options{display:flex;gap:15px;flex-wrap:wrap}.gender-option{display:flex;align-items:center;cursor:pointer}.gender-option input[type=radio]{display:none}.gender-option .gender-label{padding:8px 16px;border:2px solid var(--border-color);border-radius:20px;background:#fff;transition:var(--transition);font-size:.9rem;font-weight:500}.gender-option input[type=radio]:checked+.gender-label{border-color:var(--primary-purple);background:var(--primary-purple);color:#fff}.description-container{position:relative}textarea{width:100%;padding:15px;border:2px solid var(--border-color);border-radius:var(--border-radius);font-size:1rem;font-family:inherit;line-height:1.6;resize:vertical;min-height:120px;transition:var(--transition)}textarea:focus{outline:none;border-color:var(--primary-purple)}.char-counter{position:absolute;bottom:10px;right:15px;font-size:.8rem;color:var(--text-secondary);background:hsla(0,0%,100%,.9);padding:2px 6px;border-radius:4px}.character-preview{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-radius:var(--border-radius);padding:25px}.preview-card{background:#fff;border-radius:var(--border-radius);padding:25px;box-shadow:0 4px 15px rgba(0,0,0,.1)}.preview-header{text-align:center;margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid var(--border-color)}.preview-name{font-size:1.5rem;font-weight:700;color:var(--text-primary);margin-bottom:5px}.preview-faction{font-size:1rem;color:var(--text-secondary);font-weight:500}.preview-details{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin-bottom:20px}.preview-item{display:flex;flex-direction:column;gap:5px}.preview-item .label{font-size:.9rem;color:var(--text-secondary);font-weight:500}.preview-item .value{font-size:1rem;color:var(--text-primary);font-weight:600}.preview-description .desc-label{font-size:.9rem;color:var(--text-secondary);font-weight:500;margin-bottom:8px}.preview-description .desc-content{font-size:1rem;color:var(--text-primary);line-height:1.6;padding:15px;background:#f8f9fa;border-radius:8px;border-left:4px solid var(--primary-purple)}.actions-section{text-align:center}.action-buttons{display:flex;justify-content:center;gap:20px;margin-bottom:15px;flex-wrap:wrap}.create-btn,.reset-btn{display:flex;align-items:center;gap:10px;padding:15px 30px;border:none;border-radius:25px;font-size:1.1rem;font-weight:600;cursor:pointer;transition:var(--transition);text-decoration:none}.create-btn .btn-icon,.reset-btn .btn-icon{font-size:1.2em}.create-btn{background:linear-gradient(135deg,var(--primary-pink),var(--primary-purple));color:#fff}.create-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 25px rgba(255,105,180,.4)}.create-btn:disabled{background:var(--neutral-gray);cursor:not-allowed;opacity:.6}.reset-btn{background:#fff;color:var(--text-primary);border:2px solid var(--border-color)}.reset-btn:hover{transform:translateY(-2px);border-color:var(--text-primary);box-shadow:0 8px 25px rgba(0,0,0,.1)}.validation-message{font-size:.9rem;color:var(--text-secondary);font-style:italic}.background-effects{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1;overflow:hidden}.star{position:absolute;font-size:2rem;animation:float 6s ease-in-out infinite;opacity:.7}.star-1{top:10%;left:10%;animation-delay:0s}.star-2{top:20%;right:15%;animation-delay:1s}.star-3{top:60%;left:5%;animation-delay:2s}.star-4{bottom:30%;right:10%;animation-delay:3s}.star-5{bottom:10%;left:20%;animation-delay:4s}.star-6{top:40%;right:5%;animation-delay:5s}@keyframes sparkle{0%{transform:scale(1)}100%{transform:scale(1.1)}}@keyframes float{0%,100%{transform:translateY(0px)}50%{transform:translateY(-20px)}}.no-selection{text-align:center;color:var(--text-secondary);font-style:italic;padding:40px 20px;border:2px dashed var(--border-color);border-radius:var(--border-radius);background:#f8f9fa}.loading{opacity:.6;pointer-events:none}.result-section{margin-top:30px;animation:fadeIn .5s ease-in-out}.result-card{background:#fff;border:1px solid var(--border-color);border-radius:var(--border-radius);padding:25px;margin-bottom:20px;box-shadow:var(--shadow-medium);transition:var(--transition)}.result-card:hover{box-shadow:var(--shadow-large);transform:translateY(-2px)}.card-title{display:flex;align-items:center;gap:10px;font-size:1.3rem;font-weight:600;color:var(--text-primary);margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid var(--border-color)}.card-title .card-icon{font-size:1.4em}.character-info-content .character-name{font-size:1.5rem;font-weight:700;color:var(--primary-pink);margin-bottom:10px}.character-info-content .character-details{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}.character-info-content .character-details .detail-item{padding:12px;background:#f8f9fa;border-radius:8px;border-left:4px solid var(--primary-pink)}.character-info-content .character-details .detail-item .detail-label{font-weight:600;color:var(--text-secondary);font-size:.9rem;margin-bottom:5px}.character-info-content .character-details .detail-item .detail-value{color:var(--text-primary);font-weight:500}.character-info-content .character-description{padding:15px;background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-radius:10px;line-height:1.6;color:var(--text-primary)}.story-content{line-height:1.8;color:var(--text-primary);padding:20px;background:linear-gradient(135deg,#f1f8ff,#e8f4f8);border-radius:10px;border-left:5px solid var(--primary-blue);font-size:1.05rem}.story-content p{margin-bottom:15px}.story-content p:last-child{margin-bottom:0}.combat-content{display:grid;gap:25px}.panel-title{font-size:1.1rem;font-weight:600;color:var(--text-primary);margin-bottom:15px;padding-bottom:8px;border-bottom:1px solid var(--border-color)}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px}.stats-grid .stat-item{display:flex;flex-direction:column;align-items:center;padding:15px;background:linear-gradient(135deg,#fff,#f8f9fa);border:1px solid var(--border-color);border-radius:10px;transition:var(--transition)}.stats-grid .stat-item:hover{transform:translateY(-2px);box-shadow:var(--shadow-medium)}.stats-grid .stat-item .stat-icon{font-size:2rem;margin-bottom:8px}.stats-grid .stat-item .stat-name{font-weight:600;color:var(--text-secondary);font-size:.9rem;margin-bottom:5px}.stats-grid .stat-item .stat-value{font-size:1.3rem;font-weight:700;color:var(--primary-pink)}.cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px}.cards-grid .card-item{background:#fff;border:2px solid var(--border-color);border-radius:10px;padding:15px;transition:var(--transition);position:relative;overflow:hidden}.cards-grid .card-item:hover{transform:translateY(-3px);box-shadow:var(--shadow-large);border-color:var(--primary-pink)}.cards-grid .card-item .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.cards-grid .card-item .card-header .card-name{font-weight:600;color:var(--text-primary);font-size:1rem}.cards-grid .card-item .card-header .card-cost{background:var(--primary-pink);color:#fff;border-radius:50%;width:25px;height:25px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.9rem}.cards-grid .card-item .card-type{display:inline-block;padding:3px 8px;background:var(--neutral-gray);color:#fff;border-radius:12px;font-size:.8rem;font-weight:500;margin-bottom:10px}.cards-grid .card-item .card-description{font-size:.9rem;line-height:1.4;color:var(--text-secondary)}.cards-grid .card-item .card-rarity{position:absolute;top:8px;right:8px;font-size:1.2rem}.relics-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:15px}.relics-grid .relic-item{background:linear-gradient(135deg,#fff,#f8f9fa);border:2px solid var(--border-color);border-radius:12px;padding:20px;transition:var(--transition);position:relative}.relics-grid .relic-item:hover{transform:translateY(-3px);box-shadow:var(--shadow-large);border-color:var(--primary-purple)}.relics-grid .relic-item .relic-header{display:flex;align-items:center;gap:12px;margin-bottom:15px}.relics-grid .relic-item .relic-header .relic-icon{font-size:2rem}.relics-grid .relic-item .relic-header .relic-info{flex:1}.relics-grid .relic-item .relic-header .relic-info .relic-name{font-weight:600;color:var(--text-primary);font-size:1.1rem;margin-bottom:3px}.relics-grid .relic-item .relic-header .relic-info .relic-rarity{font-size:.8rem;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.5px}.relics-grid .relic-item .relic-description{line-height:1.5;color:var(--text-primary);font-size:.95rem}.result-actions{display:flex;gap:15px;justify-content:center;flex-wrap:wrap;margin-top:30px;padding-top:25px;border-top:2px solid var(--border-color)}.result-actions button{display:flex;align-items:center;gap:8px;padding:12px 25px;border:none;border-radius:25px;font-size:1rem;font-weight:600;cursor:pointer;transition:var(--transition);text-decoration:none}.result-actions button .btn-icon{font-size:1.1em}.result-actions button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.15)}.result-actions .regenerate-btn{background:linear-gradient(135deg,#ffa726,#ff7043);color:#fff}.result-actions .regenerate-btn:hover{box-shadow:0 6px 20px rgba(255,167,38,.4)}.result-actions .save-btn{background:linear-gradient(135deg,#4caf50,#2e7d32);color:#fff}.result-actions .save-btn:hover{box-shadow:0 6px 20px rgba(76,175,80,.4)}.result-actions .start-game-btn{background:linear-gradient(135deg,var(--primary-pink),var(--primary-purple));color:#fff}.result-actions .start-game-btn:hover{box-shadow:0 6px 20px rgba(255,105,180,.4)}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@media (max-width:768px){.magical-girl-creator{padding:15px}.creator-form{padding:20px}.faction-grid{grid-template-columns:1fr}.job-grid{grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}.location-grid{grid-template-columns:1fr}.action-buttons{flex-direction:column;align-items:center}.create-btn,.reset-btn{width:100%;max-width:300px}.star{font-size:1.5rem}}@media (max-width:480px){.main-title{font-size:1.8rem}.subtitle{font-size:.9rem}.section-title{font-size:1.2rem}.job-grid{grid-template-columns:1fr}.gender-options{flex-direction:column;gap:10px}}.city-grid,.location-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;margin-top:15px}.city-card,.location-card{background-color:#fff;border-radius:12px;padding:20px;text-align:center;border:2px solid rgba(0,0,0,0);cursor:pointer;box-shadow:0 4px 6px rgba(0,0,0,.05);transition:transform .3s ease,box-shadow .3s ease}.city-card .city-emoji,.location-card .city-emoji{font-size:2.5em;margin-bottom:10px}.city-card .city-name,.city-card .location-name,.location-card .city-name,.location-card .location-name{font-size:1.2em;font-weight:bold;color:#333}.city-card .city-status,.location-card .city-status{font-size:.8em;color:#fff;background-color:#ffc107;padding:2px 8px;border-radius:10px;display:inline-block;margin-top:8px}.city-card .city-desc,.city-card .location-desc,.location-card .city-desc,.location-card .location-desc{font-size:.9em;color:#777;margin-top:8px}.city-card:hover,.location-card:hover{transform:translateY(-5px);box-shadow:0 8px 16px rgba(0,0,0,.1)}.city-card.selected,.location-card.selected{border-color:var(--primary-color);box-shadow:0 0 0 4px rgba(106,90,205,.2)}.city-card.disabled,.location-card.disabled{cursor:not-allowed;background-color:#f8f9fa;color:#adb5bd}.city-card.disabled .city-name,.city-card.disabled .location-name,.location-card.disabled .city-name,.location-card.disabled .location-name{color:#adb5bd}.city-card.disabled:hover,.location-card.disabled:hover{transform:none;box-shadow:0 4px 6px rgba(0,0,0,.05)}\n</style></head><body><div class=\"magical-girl-creator\" id=\"character-creator-container\"><div class=\"header-section\"><h1 class=\"main-title\"><span class=\"sparkle\">âœ¨</span> ç™½æœ¨å¸‚è§’è‰²åˆ›å»º <span class=\"sparkle\">âœ¨</span></h1><p class=\"subtitle\">åœ¨æ€ªäººä¸æ€ªè°ˆçš„ç°ä»£éƒ½å¸‚ä¸­åˆ›å»ºä½ çš„è§’è‰²</p></div><div class=\"creator-form\"><div class=\"section faction-section\"><h2 class=\"section-title\"><span class=\"icon\">âš”ï¸</span> é€‰æ‹©é˜µè¥</h2><div class=\"faction-grid\"><div class=\"faction-card\" data-faction=\"magical_girl\"><div class=\"faction-icon\">ğŸŒŸ</div><div class=\"faction-name\">é­”æ³•å°‘å¥³é˜µè¥</div><div class=\"faction-desc\">å®ˆæŠ¤æ­£ä¹‰ä¸å’Œå¹³çš„é­”æ³•ä½¿ç”¨è€…</div></div><div class=\"faction-card\" data-faction=\"evil_forces\"><div class=\"faction-icon\">ğŸ‘¿</div><div class=\"faction-name\">é‚ªæ¶æ•Œå¯¹åŠ¿åŠ›</div><div class=\"faction-desc\">ä¼å›¾ç ´åä¸–ç•Œç§©åºçš„é»‘æš—åŠ›é‡</div></div><div class=\"faction-card\" data-faction=\"ordinary_people\"><div class=\"faction-icon\">ğŸ‘¥</div><div class=\"faction-name\">æ™®é€šäºº</div><div class=\"faction-desc\">ç”Ÿæ´»åœ¨ç°ä»£ç¤¾ä¼šä¸­çš„æ™®é€šæ°‘ä¼—</div></div></div></div><div class=\"section job-section\"><h2 class=\"section-title\"><span class=\"icon\">ğŸ‘”</span> é€‰æ‹©èŒä¸š</h2><div class=\"job-grid\"></div></div><div class=\"section location-section\"><h2 class=\"section-title\"><span class=\"icon\">ğŸ™ï¸</span> é€‰æ‹©åŸå¸‚</h2><div class=\"city-grid\"></div></div><div class=\"section location-section\" id=\"location-section-container\" style=\"display:none\"><h2 class=\"section-title\"><span class=\"icon\">ğŸ¢</span> é€‰æ‹©æ‰€åœ¨åœ°ç‚¹</h2><div class=\"location-grid\"></div></div><div class=\"section description-section\"><h2 class=\"section-title\"><span class=\"icon\">ğŸ’­</span> é¢å¤–æè¿°ï¼ˆå¯é€‰ï¼‰</h2><div class=\"description-container\"><textarea id=\"custom-description\" placeholder=\"åœ¨è¿™é‡Œæ·»åŠ è§’è‰²çš„ç‰¹æ®Šè®¾å®šã€æ€§æ ¼ç‰¹ç‚¹ã€èƒŒæ™¯æ•…äº‹ç­‰...&#10;ä¾‹å¦‚ï¼šå–œæ¬¢ç”œé£Ÿçš„æ¸©æŸ”å¥³å­©ï¼Œæœ‰ç€ä¸ä¸ºäººçŸ¥çš„é­”æ³•å¤©èµ‹...\" rows=\"4\" maxlength=\"300\">\n            </textarea><div class=\"char-counter\"><span id=\"char-count\">0</span>/300</div></div></div><div class=\"section preview-section\"><h2 class=\"section-title\"><span class=\"icon\">ğŸ‘ï¸</span> è§’è‰²é¢„è§ˆ</h2><div class=\"character-preview\"><div class=\"preview-card\"><div class=\"preview-header\"><div class=\"preview-name\">æœªè®¾ç½®è§’è‰²</div><div class=\"preview-faction\">è¯·å…ˆé€‰æ‹©é˜µè¥</div></div><div class=\"preview-details\"><div class=\"preview-item\"><span class=\"label\">èŒä¸šï¼š</span> <span class=\"value\" id=\"preview-job\">æœªé€‰æ‹©</span></div><div class=\"preview-item\"><span class=\"label\">åœ°ç‚¹ï¼š</span> <span class=\"value\" id=\"preview-location\">æœªé€‰æ‹©</span></div></div><div class=\"preview-description\"><div class=\"desc-label\">æè¿°ï¼š</div><div class=\"desc-content\" id=\"preview-description\">AIå°†æ ¹æ®ä½ çš„é€‰æ‹©ç”Ÿæˆè§’è‰²</div></div></div></div></div><div class=\"section actions-section\"><div class=\"action-buttons\"><button id=\"create-character-btn\" class=\"create-btn\" disabled=\"disabled\"><span class=\"btn-icon\">ğŸ­</span> <span class=\"btn-text\">åˆ›å»ºè§’è‰²</span></button> <button id=\"reset-form-btn\" class=\"reset-btn\"><span class=\"btn-icon\">ğŸ”„</span> <span class=\"btn-text\">é‡ç½®è¡¨å•</span></button></div><div class=\"validation-message\" id=\"validation-message\">è¯·é€‰æ‹©é˜µè¥ã€èŒä¸šå’Œåœ°ç‚¹åæ‰èƒ½åˆ›å»ºè§’è‰²</div></div></div></div><script>const e=[{id:'shiroki_high',name:'ç™½æœ¨é«˜ä¸­',description:'{{user}}å°±è¯»çš„å­¦æ ¡ï¼Œæ˜¯åŸå¸‚é«˜ä¸­æ•™è‚²çš„ä¸­å¿ƒ',category:'school'},{id:'shiroki_middle',name:'ç™½æœ¨åˆä¸­',description:'åŸå¸‚ä¸»è¦çš„åˆä¸­ä¹‹ä¸€ï¼ŒåŸ¹å…»é’å°‘å¹´å­¦ç”Ÿ',category:'school'},{id:'shiroki_elementary',name:'ç™½æœ¨å°å­¦',description:'åŸå¸‚é‡ç‚¹å°å­¦ï¼Œä¸ºå„¿ç«¥æä¾›ä¼˜è´¨æ•™è‚²',category:'school'},{id:'user_home',name:'{{user}}çš„å®¶',description:'{{user}}çš„ç”Ÿæ´»èµ·å±…åœºæ‰€',category:'residential'},{id:'city_hall',name:'ç™½æœ¨å¸‚æ”¿å¤§æ¥¼',description:'å¸‚æ”¿åºœæ‰€åœ¨åœ°ï¼Œå¤„ç†åŸå¸‚è¡Œæ”¿äº‹åŠ¡',category:'public'},{id:'forever_convenience',name:'æ°¸å¤œä¾¿åˆ©åº—',description:'24å°æ—¶è¥ä¸šçš„è¶…å¸‚ï¼Œæ»¡è¶³å±…æ°‘æ—¥å¸¸éœ€æ±‚',category:'commercial'},{id:'shirakawa_mansion',name:'ç™½å·è±ªå®…',description:'åŸå¸‚ä¸­ä¸€åº§ç¥ç§˜çš„å¤§å®…é™¢',category:'residential'},{id:'shiroki_shopping_street',name:'ç™½æœ¨å•†ä¸šè¡—',description:'ç¹åçš„è´­ç‰©åŒºï¼Œæ±‡é›†å„ç±»å•†é“º',category:'commercial'},{id:'shiroki_mall',name:'ç™½æœ¨è´­ç‰©ä¸­å¿ƒ',description:'è±ªåå•†åœºï¼Œèšé›†é«˜ç«¯å“ç‰Œ',category:'commercial'},{id:'night_market',name:'å¤œå¸‚å°åƒè¡—',description:'æ±‡é›†å„ç§åœ°æ–¹ç‰¹è‰²å°åƒçš„ç¾é£Ÿå¤©å ‚',category:'commercial'},{id:'shiroki_shrine',name:'ç™½æœ¨ç¥ç¤¾',description:'åŸå¸‚ä¸­å†å²æ‚ ä¹…çš„ç¥ç¤¾ï¼Œå¸‚æ°‘ç¥ˆç¦ä¹‹åœ°',category:'religious'},{id:'central_park',name:'ç™½æœ¨ä¸­å¤®å…¬å›­',description:'åŸå¸‚ä¸­å¿ƒçš„å¤§å‹å…¬å›­ï¼Œå¸‚æ°‘ä¼‘é—²å¨±ä¹åœºæ‰€',category:'public'},{id:'shiroki_hotspring',name:'ç™½æœ¨æ¸©æ³‰',description:'åŸå¸‚è‘—åçš„æ¸©æ³‰åº¦å‡åŒº',category:'entertainment'},{id:'shiroki_cinema',name:'ç™½æœ¨å½±é™¢',description:'å¤§å‹ç”µå½±é™¢ï¼Œæ”¾æ˜ å„ç±»å½±ç‰‡',category:'entertainment'}],t=[{id:'magical_guardian',name:'é­”æ³•å®ˆæŠ¤è€…',description:'è§‰é†’äº†é­”æ³•åŠ›é‡çš„å®ˆæŠ¤è€…ï¼Œå®ˆæŠ¤æ­£ä¹‰ä¸å’Œå¹³',detailedDescription:'å¤©ç”Ÿçš„é­”æ³•ä½¿ç”¨è€…ï¼Œé€šè¿‡ä¸ç¥æ˜ã€ç²¾çµæˆ–æ¦‚å¿µæ„å¿—ç­¾è®¢å¥‘çº¦è·å¾—åŠ›é‡ã€‚è§‰é†’åä¼šè·å¾—å¼ºå¤§çš„é­”æ³•èƒ½åŠ›ï¼Œèƒ½å¤Ÿå˜èº«å¹¶ä½¿ç”¨å„ç§é­”æ³•æŠ€èƒ½æ¥ä¿æŠ¤ä¸–ç•Œã€‚',icon:'ğŸŒŸ',faction:'magical_girl'},{id:'guardian_spirit',name:'å®ˆæŠ¤ç²¾çµ',description:'è¾…åŠ©é­”æ³•å®ˆæŠ¤è€…çš„ç¥ç§˜å­˜åœ¨ï¼Œæä¾›æŒ‡å¯¼å’ŒåŠ›é‡',detailedDescription:'é€šå¸¸ä¸ºéäººç±»çš„ç¥ç§˜å­˜åœ¨ï¼Œä½œä¸ºé­”æ³•å®ˆæŠ¤è€…çš„å¼•å¯¼è€…ä¸åŠ›é‡ä¹‹æºã€‚å®ƒä»¬å¾€å¾€ä»¥å¯çˆ±çš„å°åŠ¨ç‰©ã€ç©å¶æˆ–æ— æœºç‰©çš„å½¢æ€å‡ºç°ï¼Œè´Ÿè´£å¯»æ‰¾æœ‰èµ„è´¨çš„äººç±»å¹¶å¼•å¯¼ä»–ä»¬ç­¾è®¢å¥‘çº¦ã€‚å…¶æœ¬ä½“å¯èƒ½æä¸ºå¼ºå¤§ï¼Œä½†å—é™äºè§„åˆ™ï¼Œåªèƒ½ä»¥è¿™ç§æ— å®³çš„å½¢æ€ç¤ºäººã€‚',icon:'âœ¨',faction:'magical_girl'},{id:'dark_witch',name:'é»‘æš—é­”å¥³',description:'å •å…¥é»‘æš—çš„å‰é­”æ³•ä½¿ç”¨è€…ï¼ŒåŠ›é‡å¼ºå¤§ä½†å†…å¿ƒæ‰­æ›²',detailedDescription:'é€šå¸¸æ˜¯å› ç»æœ›ã€èƒŒå›æˆ–å¼ºçƒˆæ¬²æœ›è€Œå •è½çš„å‰é­”æ³•å®ˆæŠ¤è€…ã€‚å¥¹ä»¬çš„åŠ›é‡æºäºè´Ÿé¢æƒ…æ„Ÿï¼Œè™½ç„¶å¼ºå¤§ï¼Œä½†æä¸ç¨³å®šã€‚å¥¹ä»¬ç²¾é€šè¯…å’’ä¸é»‘é­”æ³•ï¼Œå°†æ›¾ç»å®ˆæŠ¤çš„ä¸€åˆ‡è§†ä¸ºå˜²è®½ï¼Œä»¥æ•£æ’­ç—›è‹¦ä¸ºä¹ã€‚',icon:'ğŸ”®',faction:'evil_forces'},{id:'shadow_apostle',name:'é˜´å½±ä½¿å¾’',description:'ä¾å¥‰é»‘æš—åŠ¿åŠ›çš„ç¥ç§˜å­˜åœ¨ï¼Œæ•£å¸ƒææƒ§å’Œç»æœ›',detailedDescription:'é»‘æš—ä¸»å®°çš„å¿ å®ä»†ä»ï¼Œå½¢æ€å„å¼‚ï¼Œå¯èƒ½æ˜¯è¢«æ”¹é€ çš„äººç±»ï¼Œä¹Ÿå¯èƒ½æ˜¯æ¥è‡ªå¼‚ç•Œçš„é˜´å½±ç”Ÿç‰©ã€‚ä»–ä»¬æ²¡æœ‰è‡ªæˆ‘ï¼Œåªä¸ºæ‰§è¡Œä¸»äººçš„å‘½ä»¤è€Œå­˜åœ¨ï¼Œæ˜¯é»‘æš—åŠ¿åŠ›æœ€ä¸»è¦çš„è¡ŒåŠ¨äººå‘˜ï¼Œè´Ÿè´£åœ¨åŸå¸‚ä¸­åˆ¶é€ æ··ä¹±ä¸ææ…Œã€‚',icon:'ğŸ‘¤',faction:'evil_forces'},{id:'fallen_guardian',name:'å •è½å®ˆæŠ¤è€…',description:'è¢«é»‘æš—ä¾µèš€çš„å‰é­”æ³•å®ˆæŠ¤è€…ï¼Œåœ¨å…‰æ˜ä¸é»‘æš—é—´æŒ£æ‰',detailedDescription:'ä¸é»‘æš—é­”å¥³ä¸åŒï¼Œå •è½å®ˆæŠ¤è€…å¹¶éè‡ªæ„¿å •è½ã€‚ä»–ä»¬å¯èƒ½æ˜¯åœ¨æˆ˜æ–—ä¸­è¢«å¼ºè¡Œæ±¡æŸ“ï¼Œæˆ–æ˜¯ä¸ºäº†å®ˆæŠ¤æŸç‰©è€Œä¸å¾—ä¸å€ŸåŠ©ç¦å¿ŒåŠ›é‡ã€‚å†…å¿ƒä»åœ¨å…‰æ˜ä¸é»‘æš—é—´ç—›è‹¦æŒ£æ‰ï¼Œæ—¶è€Œæ¸…é†’ï¼Œæ—¶è€Œç–¯ç‹‚ï¼Œæ˜¯æä¸ç¨³å®šçš„å±é™©å­˜åœ¨ã€‚',icon:'ğŸ’”',faction:'evil_forces'},{id:'demon_lord',name:'é­”ç‹',description:'é»‘æš—åŠ¿åŠ›çš„ç»Ÿæ²»è€…ï¼Œæ‹¥æœ‰æ¯ç­æ€§çš„åŠ›é‡',detailedDescription:'é»‘æš—åŠ¿åŠ›çš„é¡¶ç‚¹ï¼Œæ˜¯æ‰€æœ‰é‚ªæ¶å­˜åœ¨çš„æºå¤´æˆ–æœ€é«˜ç»Ÿå¸…ã€‚ä»–ä»¬çš„ç›®æ ‡æ˜¯é¢ è¦†ä¸–ç•Œç§©åºï¼Œå°†ä¸€åˆ‡æ‹–å…¥æ··æ²Œã€‚æ¯ä¸€ä½é­”ç‹éƒ½æ‹¥æœ‰è¶³ä»¥ä¸ä¸€ä¸ªå›½å®¶æŠ—è¡¡çš„ææ€–åŠ›é‡ï¼Œå…¶å­˜åœ¨æœ¬èº«å°±æ˜¯å¯¹ä¸–ç•Œæ³•åˆ™çš„æŒ‘æˆ˜ã€‚',icon:'ğŸ‘¹',faction:'evil_forces'},{id:'potential_awakener',name:'æ½œåœ¨è§‰é†’è€…',description:'æ™®é€šäººä¸­éšè—ç€è¶…è‡ªç„¶æ½œèƒ½çš„å­˜åœ¨ï¼Œå°šæœªè§‰é†’',detailedDescription:'ç”Ÿæ´»åœ¨åŸå¸‚ä¸­çš„æ™®é€šäººï¼Œä½†è¡€è„‰æˆ–çµé­‚ä¸­éšè—ç€å°šæœªè¢«å‘ç°çš„è¶…è‡ªç„¶æ½œèƒ½ã€‚ä»–ä»¬å¯èƒ½ä¼šåœ¨æŸä¸ªå¥‘æœºä¸‹è§‰é†’ï¼Œæˆä¸ºé­”æ³•å®ˆæŠ¤è€…ï¼Œä¹Ÿå¯èƒ½è¢«é»‘æš—è¯±æƒ‘è€Œå •è½ã€‚ç›®å‰ï¼Œä»–ä»¬åªæ˜¯æ¯”å¸¸äººç¨å¾®å¹¸è¿æˆ–ä¸å¹¸ä¸€ç‚¹çš„æ™®é€šå¸‚æ°‘ã€‚',icon:'ğŸŒ±',faction:'ordinary_people'}],i=[{id:'student',name:'å­¦ç”Ÿ',description:'åœ¨æ ¡å­¦ä¹ çš„å­¦ç”Ÿï¼Œä¸“æ³¨äºå­¦ä¸šå’Œæˆé•¿',icon:'ğŸ“š'},{id:'office_worker',name:'ä¸Šç­æ—',description:'å¿™ç¢Œçš„éƒ½å¸‚å·¥ä½œè€…ï¼Œç”Ÿæ´»åœ¨è§„å¾‹çš„æ—¥å¸¸ä¸­',icon:'ğŸ’¼'},{id:'shop_owner',name:'åº—ä¸»',description:'ç»è¥ç€å°åº—çš„æ™®é€šäººï¼Œè§è¯ç€åŸå¸‚çš„å˜åŒ–',icon:'ğŸª'},{id:'teacher',name:'æ•™å¸ˆ',description:'æ•™ä¹¦è‚²äººçš„è€å¸ˆï¼Œå…³å¿ƒå­¦ç”Ÿçš„æˆé•¿',icon:'ğŸ‘¨â€ğŸ«'},{id:'freelancer',name:'è‡ªç”±èŒä¸šè€…',description:'ç‹¬ç«‹å·¥ä½œçš„åˆ›ä½œè€…ï¼Œæœ‰ç€çµæ´»çš„ç”Ÿæ´»æ–¹å¼',icon:'ğŸ’»'},{id:'artist',name:'è‰ºæœ¯å®¶',description:'è¿½æ±‚è‰ºæœ¯åˆ›ä½œçš„äººï¼Œæ•æ„Ÿè€Œå¯Œæœ‰æƒ³è±¡åŠ›',icon:'ğŸ¨'},{id:'doctor',name:'åŒ»ç”Ÿ',description:'æ•‘æ­»æ‰¶ä¼¤çš„åŒ»ç–—å·¥ä½œè€…ï¼Œå®ˆæŠ¤ä»–äººå¥åº·',icon:'âš•ï¸'},{id:'police_officer',name:'è­¦å¯Ÿ',description:'ç»´æŠ¤æ²»å®‰çš„æ‰§æ³•è€…ï¼Œä¿æŠ¤å¸‚æ°‘å®‰å…¨',icon:'ğŸ‘®'}],n=[{id:'shiroki',name:'ç™½æœ¨å¸‚',description:'å­˜åœ¨æ€ªè°ˆå’Œæ€ªäººç»„ç»‡ï¼Œä½†åœ¨é­”æ³•å°‘å¥³çš„ä¿æŠ¤ä¸‹ï¼Œæ˜¯ç›¸å¯¹å®‰å…¨çš„å¤šå…ƒåŒ–éƒ½å¸‚ã€‚',emoji:'ğŸ™ï¸',status:'available'},{id:'kogyoku',name:'çº¢ç‰å¸‚',description:'é‚ªæ¶ç»„ç»‡æ´»åŠ¨çŒ–ç—ï¼Œå…¶åŠ›é‡å·²ä¸¥é‡å½±å“åˆ°å¸‚æ°‘çš„æ—¥å¸¸ç”Ÿæ´»ã€‚',emoji:'ğŸŒ‡',status:'developing'},{id:'kokuchou',name:'é»‘æ½®å¸‚',description:'æåº¦æ··ä¹±æ— åºçš„æ³•å¤–ä¹‹åœ°ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¸å¤–ç•Œå‡ ä¹éš”ç»çš„ç¥ç§˜åŸå¸‚ã€‚',emoji:'ğŸŒƒ',status:'developing'}],o={magical_girl:{name:'é­”æ³•å°‘å¥³é˜µè¥',description:'å®ˆæŠ¤æ­£ä¹‰ä¸å’Œå¹³çš„é­”æ³•ä½¿ç”¨è€…',color:'#ff69b4',icon:'ğŸŒŸ'},evil_forces:{name:'é‚ªæ¶æ•Œå¯¹åŠ¿åŠ›',description:'ä¼å›¾ç ´åä¸–ç•Œç§©åºçš„é»‘æš—åŠ›é‡',color:'#8b0000',icon:'ğŸ‘¿'},ordinary_people:{name:'æ™®é€šäºº',description:'ç”Ÿæ´»åœ¨ç°ä»£ç¤¾ä¼šä¸­çš„æ™®é€šæ°‘ä¼—',color:'#4682b4',icon:'ğŸ‘¥'}};class r{container;userName='{{user}}';currentConfig={name:this.userName};constructor(){if(this.container=document.getElementById('character-creator-container'),!this.container)return console.error('Character creator container not found! Looking for element with id=\"character-creator-container\"'),console.log('Available elements:',document.querySelectorAll('*')),void console.log('Body content:',document.body?.innerHTML?.substring(0,500));console.log('âœ… Character creator container found:',this.container),this.initializeEventListeners(),this.renderDefaultState(),this.renderCityOptions(),this.fetchUserName()}async fetchUserName(){try{const e=await triggerSlash('/pass {{user}}');e&&(this.userName=e,this.currentConfig.name=this.userName,this.updatePreview())}catch(e){console.error('Failed to fetch user name:',e),this.userName='ç©å®¶',this.currentConfig.name=this.userName,this.updatePreview()}}initializeEventListeners(){console.log('ğŸ”§ å¼€å§‹ç»‘å®šäº‹ä»¶ç›‘å¬å™¨');const e=document.querySelectorAll('.faction-card');console.log('æ‰¾åˆ°é˜µè¥å¡ç‰‡:',e.length,e),e.forEach((e=>{e.addEventListener('click',(()=>{console.log('é˜µè¥å¡ç‰‡è¢«ç‚¹å‡»:',e);const t=e.getAttribute('data-faction');console.log('é€‰æ‹©çš„é˜µè¥:',t),this.selectFaction(t)}))}));const t=document.getElementById('custom-description');console.log('æ‰¾åˆ°æè¿°è¾“å…¥æ¡†:',t),t?.addEventListener('input',(()=>this.updateCharacterCounter()));const i=document.getElementById('reset-form-btn');console.log('æ‰¾åˆ°é‡ç½®æŒ‰é’®:',i),i?.addEventListener('click',(()=>this.resetForm()));const n=document.getElementById('create-character-btn');console.log('æ‰¾åˆ°åˆ›å»ºæŒ‰é’®:',n),n?.addEventListener('click',(()=>this.createCharacter())),console.log('âœ… äº‹ä»¶ç›‘å¬å™¨ç»‘å®šå®Œæˆ')}selectFaction(e){console.log('ğŸ¯ selectFaction è¢«è°ƒç”¨ï¼Œé€‰æ‹©çš„é˜µè¥:',e);const i=document.querySelectorAll('.faction-card');console.log('æ‰¾åˆ°é˜µè¥å¡ç‰‡æ€»æ•°:',i.length),i.forEach((e=>e.classList.remove('selected')));const n=document.querySelector(`[data-faction=\"${e}\"]`);if(console.log('ç›®æ ‡é˜µè¥å¡ç‰‡:',n),n?.classList.add('selected'),this.currentConfig.faction=e,console.log('å½“å‰é…ç½®æ›´æ–°ä¸º:',this.currentConfig),'ordinary_people'===e){const e=t.find((e=>'potential_awakener'===e.id));this.currentConfig.supernaturalIdentity=e||null,document.querySelectorAll('.supernatural-identity').forEach((e=>{e.style.pointerEvents='none',e.classList.remove('selected')}))}else this.currentConfig.supernaturalIdentity=void 0,document.querySelectorAll('.supernatural-identity').forEach((e=>{e.style.pointerEvents='auto'}));console.log('å¼€å§‹æ¸²æŸ“èŒä¸šé€‰é¡¹...'),this.renderJobOptions(),console.log('å¼€å§‹æ›´æ–°é¢„è§ˆ...'),this.updatePreview(),console.log('å¼€å§‹éªŒè¯è¡¨å•...'),this.validateForm(),console.log('âœ… selectFaction æ‰§è¡Œå®Œæˆ')}renderCityOptions(){console.log('ğŸ™ï¸ å¼€å§‹æ¸²æŸ“åŸå¸‚é€‰é¡¹');const e=document.querySelector('.city-grid');console.log('æ‰¾åˆ°åŸå¸‚ç½‘æ ¼:',e),e?(e.innerHTML='',n.forEach((t=>{const i=document.createElement('div');i.className='city-card',i.dataset.cityId=t.id,'developing'===t.status&&i.classList.add('disabled'),i.innerHTML=`\\n        <div class=\"city-emoji\">${t.emoji}</div>\\n        <div class=\"city-name\">${t.name}</div>\\n        <div class=\"city-desc\">${t.description}</div>\\n        ${'developing'===t.status?'<div class=\"city-status\">å¼€å‘ä¸­</div>':''}\\n      `,'available'===t.status&&i.addEventListener('click',(()=>this.selectCity(t))),e.appendChild(i)}))):console.log('âŒ åŸå¸‚ç½‘æ ¼æœªæ‰¾åˆ°ï¼Œé€€å‡ºæ¸²æŸ“')}selectCity(e){document.querySelectorAll('.city-card').forEach((e=>e.classList.remove('selected'))),document.querySelector(`.city-card[data-city-id=\"${e.id}\"]`)?.classList.add('selected'),this.currentConfig.city=e,this.currentConfig.location=void 0;const t=document.getElementById('location-section-container');if(t&&(t.style.display='block'),'shiroki'===e.id)this.renderLocationOptions();else{const e=document.querySelector('.location-grid');e&&(e.innerHTML='')}this.updatePreview(),this.validateForm()}renderJobOptions(){console.log('ğŸ”¨ å¼€å§‹æ¸²æŸ“èŒä¸šé€‰é¡¹ï¼Œå½“å‰é˜µè¥:',this.currentConfig.faction);const e=document.querySelector('.job-grid');if(console.log('æ‰¾åˆ°èŒä¸šç½‘æ ¼:',e),!e||!this.currentConfig.faction)return void console.log('âŒ èŒä¸šç½‘æ ¼æˆ–é˜µè¥æœªæ‰¾åˆ°ï¼Œé€€å‡ºæ¸²æŸ“');e.innerHTML='';const n=(e,t)=>{const i=document.createElement('div');return i.className='identity-section',i.innerHTML=`<h4>${e}</h4>`,t.forEach((e=>{const t=document.createElement('div'),n='faction'in e;t.className='job-card '+(n?'supernatural-identity':'ordinary-identity'),t.dataset.identityId=e.id,t.innerHTML=`\\n          <div class=\"job-icon\">${e.icon}</div>\\n          <div class=\"job-name\">${n?this.getIdentityDisplayName(e):e.name}</div>\\n          <div class=\"job-desc\">${e.description}</div>\\n          <div class=\"job-detailed-desc\">${n?e.detailedDescription:''}</div>\\n        `,n?t.addEventListener('click',(()=>this.selectSupernaturalIdentity(e))):t.addEventListener('click',(()=>this.selectOrdinaryIdentity(e))),i.appendChild(t)})),i},o=t.filter((e=>e.faction===this.currentConfig.faction));o.length>0&&e.appendChild(n('è¶…è‡ªç„¶èº«ä»½',o)),e.appendChild(n('æ™®é€šèº«ä»½',i))}getIdentityDisplayName(e){return e.name}selectSupernaturalIdentity(e){document.querySelectorAll('.supernatural-identity').forEach((e=>e.classList.remove('selected'))),document.querySelectorAll('.ordinary-identity').forEach((e=>e.classList.remove('selected'))),document.querySelector(`[data-identity-id=\"${e.id}\"]`)?.classList.add('selected'),this.currentConfig.supernaturalIdentity=e,this.currentConfig.ordinaryIdentity||(this.currentConfig.ordinaryIdentity=i[0],document.querySelector(`.ordinary-identity[data-identity-id=\"${i[0].id}\"]`)?.classList.add('selected')),this.updatePreview(),this.validateForm()}selectOrdinaryIdentity(e){document.querySelectorAll('.ordinary-identity').forEach((e=>e.classList.remove('selected'))),document.querySelector(`[data-identity-id=\"${e.id}\"]`)?.classList.add('selected'),this.currentConfig.ordinaryIdentity=e,'ordinary_people'!==this.currentConfig.faction&&void 0===this.currentConfig.supernaturalIdentity&&(this.currentConfig.supernaturalIdentity=null),this.updatePreview(),this.validateForm()}renderLocationOptions(){const t=document.querySelector('.location-grid');t&&(t.innerHTML='',e.forEach((e=>{const i=document.createElement('div');i.className='location-card',i.dataset.locationId=e.id,i.innerHTML=`\\n        <div class=\"location-name\">${e.name}</div>\\n        <div class=\"location-desc\">${e.description}</div>\\n        <div class=\"location-category\">${this.getCategoryName(e.category)}</div>\\n      `,i.addEventListener('click',(()=>this.selectLocation(e))),t.appendChild(i)})))}selectLocation(e){document.querySelectorAll('.location-card').forEach((e=>e.classList.remove('selected'))),document.querySelector(`[data-location-id=\"${e.id}\"]`)?.classList.add('selected'),this.currentConfig.location=e,this.updatePreview(),this.validateForm()}getCategoryName(e){return{school:'å­¦æ ¡',public:'å…¬å…±è®¾æ–½',commercial:'å•†ä¸šåŒº',residential:'å±…ä½åŒº',religious:'å®—æ•™åœºæ‰€',entertainment:'å¨±ä¹åœºæ‰€'}[e]||e}updatePreview(){this.updatePreviewDisplay()}updatePreviewDisplay(){const e={name:document.querySelector('.preview-name'),faction:document.querySelector('.preview-faction'),job:document.getElementById('preview-job'),location:document.getElementById('preview-location'),description:document.getElementById('preview-description')},t=e.name;t&&(t.textContent=this.currentConfig.name||'æœªè®¾ç½®è§’è‰²');const i=e.faction,n=this.currentConfig.faction;if(n){const e=o[n];i.textContent=e.name,i.style.backgroundColor=e.color,i.style.visibility='visible'}else i.textContent='è¯·å…ˆé€‰æ‹©é˜µè¥',i.style.visibility='hidden';const r=e.job;if(r){let e='æœªé€‰æ‹©';this.currentConfig.supernaturalIdentity?e=this.getIdentityDisplayName(this.currentConfig.supernaturalIdentity):null===this.currentConfig.supernaturalIdentity&&(e='å¾…å®š'),r.textContent=e}const c=e.location;if(c){let e=this.currentConfig.city?this.currentConfig.city.name:'æœªé€‰æ‹©åŸå¸‚';this.currentConfig.location&&(e=`${this.currentConfig.city?.name} - ${this.currentConfig.location.name}`),c.textContent=e}const s=e.description;s&&(this.isConfigValid(this.currentConfig)?s.textContent='ç‚¹å‡»\"åˆ›å»ºè§’è‰²\"åï¼Œå°†æ ¹æ®æ‚¨çš„é€‰æ‹©ç”Ÿæˆæè¿°å¹¶å¼€å§‹æ•…äº‹ã€‚':s.textContent='AIå°†æ ¹æ®ä½ çš„é€‰æ‹©ç”Ÿæˆè§’è‰²')}updateCharacterCounter(){const e=document.getElementById('custom-description'),t=document.getElementById('char-count');if(e&&t){const i=e.value.length;t.textContent=i.toString(),t.style.color=i>250?'#dc3545':i>200?'#ffc107':'#6c757d'}this.updatePreview()}validateForm(){const e=document.getElementById('create-character-btn'),t=document.getElementById('validation-message');this.isConfigValid(this.currentConfig)?(e.disabled=!1,t.style.display='none'):(e.disabled=!0,t.style.display='block')}async createCharacter(){console.log('ğŸ­ å¼€å§‹åˆ›å»ºè§’è‰²');const e=document.getElementById('custom-description');if(e&&(this.currentConfig.customDescription=e.value.trim()),!this.isConfigValid(this.currentConfig))return void this.showMessage('è¯·å®Œå–„è§’è‰²ä¿¡æ¯åå†åˆ›å»º','warning');const t=this.currentConfig;console.log('âœ… è§’è‰²é…ç½®éªŒè¯é€šè¿‡:',t);try{console.log('ğŸ“ ç”Ÿæˆè§’è‰²æè¿°æ–‡æœ¬...');const e=this.buildUserDescription(t);console.log('è§’è‰²æè¿°ç”Ÿæˆå®Œæˆ:',e),this.showMessage('è§’è‰²åˆ›å»ºæˆåŠŸï¼æ­£åœ¨å¯åŠ¨æ¸¸æˆ...','success'),await new Promise((e=>setTimeout(e,1e3)));try{console.log('ğŸ“¤ å‘é€è§’è‰²æè¿°ä¸ºç”¨æˆ·æ¶ˆæ¯...'),await triggerSlash(`/send ${e}`),console.log('ğŸš€ è§¦å‘AIå¯¹è¯...'),await triggerSlash('/trigger'),console.log('âœ¨ æ¸¸æˆå¯åŠ¨æˆåŠŸï¼'),this.showMessage('æ¸¸æˆå·²å¯åŠ¨ï¼AIæ­£åœ¨ç”Ÿæˆå¼€åœºå‰§æƒ…...','info')}catch(e){console.error('âŒ TavernHelper API è°ƒç”¨å¤±è´¥:',e),this.showMessage('TavernHelper API è°ƒç”¨å¤±è´¥ï¼Œæ— æ³•å¯åŠ¨æ¸¸æˆã€‚','error')}}catch(e){console.error('âŒ åˆ›å»ºè§’è‰²å¤±è´¥:',e),this.showMessage('åˆ›å»ºè§’è‰²å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚','error')}}buildUserDescription(e){const t=[];t.push(`æˆ‘æ˜¯${e.name}ã€‚`);return t.push(`æˆ‘å±äº${{magical_girl:'é­”æ³•å°‘å¥³',ordinary_people:'æ™®é€šäºº',evil_forces:'é‚ªæ¶åŠ¿åŠ›'}[e.faction]}é˜µè¥ã€‚`),e.ordinaryIdentity&&t.push(`æˆ‘çš„æ™®é€šèº«ä»½æ˜¯${e.ordinaryIdentity.name}ï¼š${e.ordinaryIdentity.description}`),e.supernaturalIdentity&&t.push(`æˆ‘çš„è¶…è‡ªç„¶èº«ä»½æ˜¯${e.supernaturalIdentity.name}ï¼š${e.supernaturalIdentity.description}`),e.city&&t.push(`æˆ‘ç”Ÿæ´»åœ¨${e.city.name}ã€‚${e.city.description}`),e.location&&t.push(`æˆ‘ç›®å‰åœ¨${e.location.name}ã€‚${e.location.description}`),e.customDescription&&e.customDescription.trim()&&t.push(`\\nè¡¥å……æè¿°ï¼š${e.customDescription.trim()}`),t.push('\\nè¯·å¼€å§‹æˆ‘çš„é­”æ³•å°‘å¥³RPGå†’é™©å§ï¼'),t.join(' ')}isConfigValid(e){const{faction:t,supernaturalIdentity:i,ordinaryIdentity:n,city:o,location:r}=e;return'ordinary_people'===t?!!(t&&n&&o&&r):!!(t&&i&&n&&o&&r)}showMessage(e,t){'undefined'!=typeof toastr?toastr[t](e,'',{closeButton:!0,timeOut:5e3,extendedTimeOut:2e3,progressBar:!0,positionClass:'toast-top-center'}):(console.log(`[${t}] ${e}`),alert(`[${t}] ${e}`))}resetForm(){this.currentConfig={name:this.userName},document.querySelectorAll('.faction-card, .job-card, .location-card, .city-card').forEach((e=>{e.classList.remove('selected')})),document.getElementById('custom-description').value='';const e=document.getElementById('location-section-container');e&&(e.style.display='none');const t=document.querySelector('.location-grid');t&&(t.innerHTML='\\x3c!-- åœ°ç‚¹é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ --\\x3e');const i=document.querySelector('.job-grid');i&&(i.innerHTML='\\x3c!-- èŒä¸šé€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ --\\x3e'),this.updateCharacterCounter(),this.updatePreview(),this.validateForm();const n=document.getElementById('create-character-btn');n&&(n.disabled=!0,n.querySelector('.btn-text').textContent='åˆ›å»ºè§’è‰²'),this.showMessage('è¡¨å•å·²é‡ç½®ã€‚','info')}renderDefaultState(){this.updatePreview(),this.updateCharacterCounter(),this.validateForm()}}console.log('ğŸŒŸ ç™½æœ¨å¸‚é­”æ³•å°‘å¥³è§’è‰²åˆ›å»ºç³»ç»Ÿå¯åŠ¨');const c=()=>{console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–è§’è‰²åˆ›å»ºç³»ç»Ÿ');try{if('undefined'==typeof document)return void console.error('âŒ æ–‡æ¡£å¯¹è±¡æœªæ‰¾åˆ°');new r,console.log('âœ¨ è§’è‰²åˆ›å»ºç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ')}catch(e){console.error('âŒ è§’è‰²åˆ›å»ºç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:',e)}};'loading'===document.readyState?document.addEventListener('DOMContentLoaded',c):c();</script></body></html><div class=\"section result-section\" id=\"result-section\" style=\"display:none\"><h2 class=\"section-title\"><span class=\"icon\">ğŸŒŸ</span> è§’è‰²ç”Ÿæˆç»“æœ</h2><div class=\"result-card character-info-card\"><h3 class=\"card-title\"><span class=\"card-icon\">ğŸ‘¤</span> è§’è‰²ä¿¡æ¯</h3><div class=\"character-info-content\" id=\"character-info-content\"></div></div><div class=\"result-card story-card\"><h3 class=\"card-title\"><span class=\"card-icon\">ğŸ“–</span> åˆå§‹å‰§æƒ…</h3><div class=\"story-content\" id=\"story-content\"></div></div><div class=\"result-card combat-card\"><h3 class=\"card-title\"><span class=\"card-icon\">âš”ï¸</span> æˆ˜æ–—æ•°æ®</h3><div class=\"combat-content\"><div class=\"stats-panel\" id=\"stats-panel\"><h4 class=\"panel-title\">è§’è‰²å±æ€§</h4><div class=\"stats-grid\" id=\"stats-grid\"></div></div><div class=\"cards-panel\" id=\"cards-panel\"><h4 class=\"panel-title\">åˆå§‹å¡ç»„</h4><div class=\"cards-grid\" id=\"cards-grid\"></div></div><div class=\"relics-panel\" id=\"relics-panel\"><h4 class=\"panel-title\">åˆå§‹é—ç‰©</h4><div class=\"relics-grid\" id=\"relics-grid\"></div></div></div></div><div class=\"result-actions\"><button id=\"regenerate-btn\" class=\"regenerate-btn\"><span class=\"btn-icon\">ğŸ”„</span> <span class=\"btn-text\">é‡æ–°ç”Ÿæˆ</span></button> <button id=\"save-character-btn\" class=\"save-btn\"><span class=\"btn-icon\">ğŸ’¾</span> <span class=\"btn-text\">ä¿å­˜è§’è‰²</span></button> <button id=\"start-game-btn\" class=\"start-game-btn\"><span class=\"btn-icon\">ğŸ®</span> <span class=\"btn-text\">å¼€å§‹æ¸¸æˆ</span></button></div></div><div class=\"background-effects\"><div class=\"star star-1\">â­</div><div class=\"star star-2\">âœ¨</div><div class=\"star star-3\">ğŸŒŸ</div><div class=\"star star-4\">ğŸ’«</div><div class=\"star star-5\">â­</div><div class=\"star star-6\">âœ¨</div></div>",
    "trimStrings": [],
    "placement": [
        1,
        2
    ],
    "disabled": false,
    "markdownOnly": true,
    "promptOnly": false,
    "runOnEdit": true,
    "substituteRegex": 0,
    "minDepth": null,
    "maxDepth": 1
}