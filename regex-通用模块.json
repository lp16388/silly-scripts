{
    "id": "8aca2252-fa6a-4ed1-8d09-9f00a1ebdfa9",
    "scriptName": "é€šç”¨æ¨¡å—",
    "findRegex": "/<Story>([\\s\\S]*?)<\\/Story>[\\s\\S]*?<Options>([\\s\\S]*?)<\\/Options>/gm",
    "replaceString": "```\n<!doctype html><html lang=\"zh-CN\"><head><meta charset=\"UTF-8\"/><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/><title>é­”æ³•å°‘å¥³RPG</title><style>@import url(https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Noto+Sans+SC:wght@300;400;500&display=swap);\n/*! tailwindcss v4.1.12 | MIT License | https://tailwindcss.com */:root{--notebook-bg:#fffaf7;--notebook-border:#f2e4d5;--text-primary:#6d5b5b;--text-secondary:#b19d9d;--bookmark-pink:#ffd9e2;--bookmark-blue:#d4eaff;--bookmark-green:#d8f5d8;--bookmark-purple:#e9e0ff;--bookmark-yellow:#fff9c4;--bookmark-active-shadow:0 4px 12px rgba(136,98,98,0.15);--transition:all 0.35s cubic-bezier(0.4,0,0.2,1)}*{box-sizing:border-box;margin:0;padding:0}body{font-family:\"Noto Sans SC\",sans-serif;line-height:1.7;color:var(--text-primary);background-color:#f8f3ed;background-image:url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e8e0d4' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");overflow-x:hidden;min-height:100vh;padding:20px}.rpg-container{max-width:900px;margin:2rem auto;position:relative;font-family:\"Microsoft YaHei\",\"Segoe UI\",\"Helvetica Neue\",sans-serif}.rpg-container .notebook-body{background:var(--notebook-bg);border:1px solid var(--notebook-border);border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,.15);padding:2rem;padding-top:5rem;position:relative}.reward-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.3);z-index:1000;display:flex;align-items:flex-start;justify-content:center;padding:20px}.reward-card{background:var(--notebook-bg);border:2px solid var(--notebook-border);border-radius:8px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.08);width:100%;max-width:100%}.reward-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}.reward-header .title{font:800 18px \"ZCOOL KuaiLe\",\"Noto Sans SC\",system-ui;color:var(--text-primary)}.reward-header .badge{margin-left:auto;padding:4px 10px;border-radius:10px;border:2px solid var(--notebook-border);background:var(--bookmark-yellow);color:var(--text-primary);font:900 12px \"ZCOOL KuaiLe\",\"Noto Sans SC\"}.reward-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px;margin-bottom:12px;width:100%}.pane{border-radius:8px;padding:10px;background:#fff;border:2px dashed #d9c7aa}.pane.pane-change{background:#fffef6;grid-column:1/-1}.pane.pane-exp{background:#f0f8ff;border-color:skyblue;grid-column:1/-1}.pane.pane-card{border-color:#ffc1d6}.pane.pane-artifact{border-color:#b9d6ff}.pane.pane-item{border-color:#bfe7bf}.pane-tag{display:inline-block;padding:2px 10px;border-radius:8px;border:2px solid #d9c7aa;background:#fff;color:#6b5b2e;font:800 12px \"ZCOOL KuaiLe\",\"Noto Sans SC\"}.change-list{margin-top:8px;display:flex;flex-wrap:wrap;gap:8px;color:#6b5b2e;font:500 13px \"Noto Sans SC\"}.pill{padding:6px 10px;border-radius:8px;background:#fffef6;border:2px dashed #d9c7aa}.exp-display{margin-top:8px;display:flex;flex-direction:column;gap:8px;color:#2c5aa0;font:500 13px \"Noto Sans SC\"}.exp-item{padding:8px 12px;border-radius:8px;background:#e6f3ff;border:2px solid skyblue;display:flex;align-items:center;gap:8px}.exp-icon{font-size:16px}.exp-text{flex:1;font-weight:600}.pane-head{display:flex;align-items:center;margin-bottom:8px}.pane-title{font:800 14px \"ZCOOL KuaiLe\",\"Noto Sans SC\";color:var(--text-primary)}.pane-sub{margin-left:auto;color:var(--text-secondary);font:700 12px \"Noto Sans SC\"}.option{margin-top:8px;display:flex;gap:10px;align-items:center;padding:8px;border-radius:8px;background:#fffef6;border:2px dashed currentColor;cursor:pointer}.pane-card .option{color:#a66a79;background:#fffef9;border-color:#ffc1d6}.pane-artifact .option{color:#5c6b82;background:#f8fbff;border-color:#b9d6ff}.pane-item .option{color:#5b7a5b;background:#f7fff7;border-color:#bfe7bf}.option .icon{font-size:18px}.option .text{flex:1;min-width:0}.option .name{font:800 13px \"ZCOOL KuaiLe\",\"Noto Sans SC\";color:var(--text-primary);word-break:break-word}.option .desc{font:700 12px \"Noto Sans SC\";color:var(--text-secondary);word-break:break-word}.reward-actions{display:flex;gap:8px;justify-content:flex-end}.btn{padding:8px 12px;border-radius:8px;font:800 12px \"ZCOOL KuaiLe\",\"Noto Sans SC\";border:2px solid var(--notebook-border);background:#fff;color:var(--text-primary);cursor:pointer;transition:var(--transition)}.btn.btn-primary{border:0;color:#634d4d;background:linear-gradient(180deg,var(--bookmark-yellow),#ffd9e2);box-shadow:0 8px 16px rgba(136,98,98,.12),inset 0 0 0 2px var(--notebook-border)}.btn.btn-primary:disabled{opacity:.5;cursor:not-allowed}.btn:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 8px rgba(0,0,0,.1)}.tab-navigation{position:absolute;top:1.5rem;left:2rem;right:2rem;display:flex;justify-content:flex-start;align-items:flex-end;z-index:10;height:50px}.tab-navigation .tab-button{background:var(--bookmark-pink);border:1px solid var(--notebook-border);border-bottom:none;border-radius:12px 12px 4px 4px;padding:.8rem 1.3rem;cursor:pointer;color:var(--text-primary);font-family:\"ZCOOL KuaiLe\",cursive;font-size:1.1rem;margin-right:5px;transition:var(--transition);box-shadow:0 -1px 4px rgba(0,0,0,.04) inset;position:relative;transform-origin:bottom center}.tab-navigation .tab-button:nth-child(1){transform:rotate(-2deg)}.tab-navigation .tab-button:nth-child(2){background-color:var(--bookmark-blue);transform:rotate(1.5deg)}.tab-navigation .tab-button:nth-child(3){background-color:var(--bookmark-green);transform:rotate(-1deg)}.tab-navigation .tab-button:nth-child(4){background-color:var(--bookmark-purple);transform:rotate(2.5deg)}.tab-navigation .tab-button:nth-child(5){background-color:var(--bookmark-yellow);transform:rotate(-1.5deg)}.tab-navigation .tab-button:hover{transform:translateY(-5px) rotate(0)}.tab-navigation .tab-button.active{transform:translateY(-10px) rotate(0);box-shadow:var(--bookmark-active-shadow);z-index:5}.tab-navigation .tab-button.active::after{content:\"\";position:absolute;top:5px;right:5px;width:14px;height:14px;background:radial-gradient(circle,#ff8a8a 0%,#e53935 100%);border:1px solid rgba(0,0,0,.2);border-radius:50%;box-shadow:1px 1px 3px rgba(0,0,0,.2)}.tab-navigation .tab-button .tab-icon{margin-right:.5rem}.tab-navigation .tab-button:nth-child(2).active::after{background:radial-gradient(circle,#8dc8ff 0%,#3a8ee5 100%)}.tab-navigation .tab-button:nth-child(3).active::after{background:radial-gradient(circle,#83e083 0%,#36a536 100%)}.tab-navigation .tab-button:nth-child(4).active::after{background:radial-gradient(circle,#c0a8ff 0%,#8b6ce5 100%)}.tab-navigation .tab-button:nth-child(5).active::after{background:radial-gradient(circle,#ffe68a 0%,#e5b839 100%)}.tab-content .module-content{display:none;animation:fadeIn .5s ease-in-out}.tab-content .module-content[style*=\"display: block\"]{display:block !important}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.section{margin-bottom:2.5rem}.section:last-child{margin-bottom:0}.section-title{font-size:2rem;font-weight:normal;font-family:\"ZCOOL KuaiLe\",cursive;color:var(--text-primary);margin-bottom:1.5rem;padding-bottom:.75rem;border-bottom:3px dotted var(--notebook-border)}.story-text{font-family:\"Noto Sans SC\",sans-serif;font-size:1.15rem;line-height:1.8;color:var(--text-primary);margin-bottom:1.5rem;white-space:pre-wrap}.story-text p{margin-bottom:1rem}.story-text p:last-child{margin-bottom:0}.story-text strong{color:#8b4c98;font-weight:500}.story-text em{color:var(--text-secondary);font-style:italic}.story-options{display:flex;flex-direction:column;gap:.75rem;margin-top:1rem}.story-options p{margin-bottom:.5rem;font-family:\"ZCOOL KuaiLe\",cursive;font-size:1.2rem;color:var(--text-primary)}.story-options ol{padding-left:0;list-style:none}.story-options ol li{background:hsla(0,0%,100%,.5);border:1px solid var(--notebook-border);border-radius:8px;padding:1rem;margin-bottom:.5rem;position:relative;font-family:\"ZCOOL KuaiLe\",cursive;font-size:1.1rem;line-height:1.6;transition:var(--transition)}.story-options ol li:hover{background:rgba(214,182,182,.15);transform:translateX(5px)}.story-options ol li::before{content:counter(list-item) \"ï¸âƒ£\";counter-increment:list-item;position:absolute;left:-2rem;top:50%;transform:translateY(-50%);font-size:1.2rem}.data-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;margin-bottom:1.5rem}.info-card{border:none;border-radius:8px;padding:1.25rem;background:hsla(0,0%,100%,.6);box-shadow:0 4px 15px rgba(136,98,98,.08);transition:var(--transition)}.info-card:hover{box-shadow:0 6px 20px rgba(136,98,98,.12);transform:translateY(-2px)}.info-card .card-title{font-weight:normal;font-family:\"ZCOOL KuaiLe\",cursive;font-size:1.4rem;margin-bottom:.75rem;color:#8b4c98;border-bottom:2px dotted var(--notebook-border);padding-bottom:.5rem}.info-card .info-item{display:flex;justify-content:space-between;align-items:flex-start;padding:.6rem 0;border-top:1px dashed var(--notebook-border);font-family:\"ZCOOL KuaiLe\",cursive;font-size:1rem}.info-card .info-item:first-of-type{border-top:none}.info-card .info-item .label{color:var(--text-secondary);font-weight:400;white-space:nowrap;margin-right:1rem}.info-card .info-item .value{font-weight:500;color:var(--text-primary);text-align:right;word-break:break-word;line-height:1.4}.battle-deck{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1rem}.card,.battle-card-item{border:1px solid var(--notebook-border);padding:1rem;border-radius:8px;text-align:center;background:#fff;font-family:\"ZCOOL KuaiLe\",cursive;font-size:1rem;transition:var(--transition);box-shadow:0 2px 8px rgba(0,0,0,.05)}.card:hover,.battle-card-item:hover{transform:translateY(-3px);box-shadow:0 4px 12px rgba(0,0,0,.1)}.card .card-name,.battle-card-item .card-name{font-weight:600;font-size:1.1rem;margin-bottom:.5rem;color:#8b4c98}.card .card-name .card-quantity,.battle-card-item .card-name .card-quantity{color:var(--text-secondary);font-size:.9rem;margin-left:.5rem}.card .card-cost,.battle-card-item .card-cost{color:var(--bookmark-blue);margin-bottom:.5rem;font-weight:500}.card .card-description,.battle-card-item .card-description{color:var(--text-secondary);font-size:.9rem;line-height:1.4}.delete-control-card{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:120px;background:linear-gradient(135deg,#ffebee,#fce4ec);border:2px dashed #f44}.delete-control-card .delete-mode-btn{background:#f44;color:#fff;border:none;width:50px;height:50px;border-radius:50%;font-size:1.5rem;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 6px rgba(0,0,0,.2);margin-bottom:.5rem}.delete-control-card .delete-mode-btn:hover{background:#f66;transform:scale(1.1);box-shadow:0 4px 10px rgba(0,0,0,.3)}.delete-control-card .delete-mode-btn.delete-mode-active{background:#c33;animation:pulse 1.5s infinite}.delete-control-card .delete-mode-btn.delete-mode-active:hover{background:#d44}.delete-control-card .delete-count{font-size:.8rem;color:#666;text-align:center}@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}.card,.battle-card-item{position:relative}.card .card-delete-overlay,.battle-card-item .card-delete-overlay{position:absolute;top:-5px;right:-5px;width:30px;height:30px;background:#f44;border:2px solid #fff;border-radius:50%;display:none;align-items:center;justify-content:center;cursor:pointer;z-index:10;transition:all .2s ease;box-shadow:0 2px 6px rgba(0,0,0,.3)}.card .card-delete-overlay .delete-icon,.battle-card-item .card-delete-overlay .delete-icon{font-size:.8rem;color:#fff}.card .card-delete-overlay:hover,.battle-card-item .card-delete-overlay:hover{background:#f66;transform:scale(1.1);box-shadow:0 3px 8px rgba(0,0,0,.4)}.battle-deck.delete-mode .card .card-delete-overlay,.battle-deck.delete-mode .battle-card-item .card-delete-overlay{display:flex}.battle-deck.delete-mode .card:hover,.battle-deck.delete-mode .battle-card-item:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(255,68,68,.3)}.item-use-btn{background:#4a4;color:#fff;border:2px solid #393;padding:.4rem .8rem;border-radius:6px;font-size:.85rem;font-weight:600;cursor:pointer;margin-top:.5rem;transition:all .2s ease;box-shadow:0 2px 4px rgba(0,0,0,.1)}.item-use-btn:hover{background:#6c6;border-color:#4a4;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.2)}.item-use-btn:active{transform:translateY(0);box-shadow:0 2px 4px rgba(0,0,0,.1)}.tracking-btn{border:2px solid;padding:.3rem .6rem;border-radius:6px;font-size:.8rem;font-weight:600;cursor:pointer;margin-left:.5rem;transition:all .2s ease;box-shadow:0 2px 4px rgba(0,0,0,.1)}.tracking-btn.tracking-on{background:#f44;color:#fff;border-color:#c33}.tracking-btn.tracking-on:hover{background:#f66;border-color:#f44;transform:translateY(-1px);box-shadow:0 3px 6px rgba(0,0,0,.15)}.tracking-btn.tracking-off{background:#4a4;color:#fff;border-color:#393}.tracking-btn.tracking-off:hover{background:#6c6;border-color:#4a4;transform:translateY(-1px);box-shadow:0 3px 6px rgba(0,0,0,.15)}.tracking-btn:active{transform:translateY(0);box-shadow:0 2px 4px rgba(0,0,0,.1)}.debug-panel{margin-top:2rem;padding:1.25rem;background:rgba(0,0,0,0);border:2px dashed var(--notebook-border);border-radius:8px}.debug-panel h4{text-align:center;margin-bottom:1rem;color:var(--text-secondary);font-size:1.1rem;font-family:\"ZCOOL KuaiLe\",cursive}.debug-panel .debug-buttons{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:.75rem}.debug-panel .debug-buttons .debug-btn{background:rgba(0,0,0,.03);border:1px solid var(--notebook-border);color:var(--text-secondary);padding:.75rem 1rem;border-radius:6px;cursor:pointer;font-family:\"ZCOOL KuaiLe\",cursive;font-size:1rem;transition:var(--transition)}.debug-panel .debug-buttons .debug-btn:hover{background:rgba(0,0,0,.06);color:var(--text-primary);transform:translateY(-1px)}.debug-panel .debug-buttons .debug-btn:active{transform:translateY(0)}@media (max-width:768px){body{background-image:none;padding:10px}.rpg-container{margin:0;width:100%;min-height:100vh;display:flex;flex-direction:column}.rpg-container .notebook-body{border-radius:0;box-shadow:none;flex-grow:1;overflow-y:auto;padding:1rem;padding-top:4.5rem}.rpg-container .debug-panel{flex-shrink:0;border-radius:0;margin-top:0;border-top:2px dashed var(--notebook-border)}.tab-navigation{left:1rem;right:1rem;height:40px}.tab-navigation .tab-button{padding:.6rem .8rem;font-size:1rem;transform:rotate(0) !important;margin-right:-5px}.tab-navigation .tab-button.active{transform:translateY(-5px) !important}.tab-navigation .tab-button.active::after{width:10px;height:10px;top:4px;right:4px}.tab-navigation .tab-button .tab-label{display:none}.section-title{font-size:1.6rem}.data-grid{grid-template-columns:1fr;gap:1rem}.story-text{font-size:1.1rem}.story-options ol li{font-size:1rem;padding:.8rem}.story-options ol li::before{left:-1.5rem;font-size:1rem}}.rpg-container::before{content:\"\";position:absolute;top:0;left:0;right:0;bottom:0;background:repeating-linear-gradient(0deg,transparent,transparent 24px,rgba(0,0,0,0.02) 25px);pointer-events:none;border-radius:8px}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:var(--notebook-bg)}::-webkit-scrollbar-thumb{background:var(--notebook-border);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:var(--text-secondary)}.option-btn{display:inline-block;margin:.3rem .4rem .3rem 0;padding:.5rem 1rem;border:1px solid var(--notebook-border);border-radius:6px;background:var(--bookmark-blue);font-family:\"ZCOOL KuaiLe\",cursive;cursor:pointer;transition:var(--transition)}.option-btn:hover{background:var(--bookmark-purple);transform:translateY(-2px)}.alignment-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-top:1rem}.alignment-cell{border:1px solid var(--notebook-border);padding:.5rem;text-align:center;font-size:.9rem;background:#fdf9f2;border-radius:4px;transition:var(--transition)}.alignment-cell.active{background:var(--bookmark-green);font-weight:bold;box-shadow:0 0 6px rgba(0,0,0,.15)}.faction-status{padding:.2rem .5rem;border-radius:4px;font-size:.9rem;font-weight:500}.faction-status.å‹å¥½,.faction-status.friendly{background:var(--bookmark-green);color:#2e7d32}.faction-status.æ•Œå¯¹,.faction-status.hostile{background:#ffebee;color:#c62828}.faction-status.ä¸­ç«‹,.faction-status.neutral{background:var(--bookmark-yellow);color:#f57c00}.faction-status.è­¦æƒ•,.faction-status.cautious{background:#fff3e0;color:#ef6c00}.faction-status.äº¦æ•Œäº¦å‹,.faction-status.complicated{background:var(--bookmark-purple);color:#6a1b9a}.delete-toggle-btn{background:#ff6b6b;color:#fff;border:none;border-radius:6px;padding:4px 8px;margin-left:10px;cursor:pointer;font-size:14px;transition:var(--transition)}.delete-toggle-btn:hover{background:#ff5252;transform:scale(1.05)}.card,.battle-card-item{position:relative}.card .card-delete-btn,.battle-card-item .card-delete-btn{position:absolute;top:5px;right:5px;background:#ff6b6b;color:#fff;border:none;border-radius:50%;width:24px;height:24px;cursor:pointer;font-size:12px;display:none;align-items:center;justify-content:center;transition:var(--transition)}.card .card-delete-btn:hover,.battle-card-item .card-delete-btn:hover{background:#ff5252;transform:scale(1.1)}.battle-deck.delete-mode .card,.battle-deck.delete-mode .battle-card-item{border:2px dashed #ff6b6b;background:rgba(255,107,107,.05)}.exp-test-btn{background:linear-gradient(135deg,#4caf50,#45a049);color:#fff;border:none;border-radius:8px;padding:8px 16px;cursor:pointer;font-size:14px;font-weight:500;transition:var(--transition);box-shadow:0 2px 4px rgba(76,175,80,.3)}.exp-test-btn:hover{background:linear-gradient(135deg,#45a049,#3d8b40);transform:translateY(-2px);box-shadow:0 4px 8px rgba(76,175,80,.4)}.exp-test-btn:active{transform:translateY(0);box-shadow:0 2px 4px rgba(76,175,80,.3)}.battle-option-btn{display:inline-block;margin:.3rem .4rem .3rem 0;padding:.5rem 1rem;border:1px solid var(--notebook-border);border-radius:6px;font-family:\"ZCOOL KuaiLe\",cursive;cursor:pointer;transition:var(--transition);background:#f44336;color:#fff}.battle-option-btn:hover{background:#d32f2f;transform:translateY(-2px)}.battle-book-container{display:flex;flex-direction:column;gap:12px}.battle-book-btn{background:linear-gradient(180deg,var(--bookmark-yellow),var(--bookmark-pink));color:var(--text-primary);border:2px solid var(--notebook-border);padding:12px 16px;border-radius:8px;font-size:14px;font-weight:800;cursor:pointer;transition:var(--transition);box-shadow:0 6px 14px rgba(136,98,98,.12)}.battle-book-btn:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(136,98,98,.16)}.battle-book-btn:active{transform:translateY(0)}.battle-book-content{background:hsla(0,0%,100%,.65);border-radius:8px;padding:16px;border:2px dashed var(--notebook-border);max-height:400px;overflow-y:auto;color:var(--text-primary)}.battle-book-section{margin-bottom:20px}.battle-book-section h4{color:var(--text-primary);font-size:16px;font-weight:800;margin-bottom:12px;padding-bottom:6px;border-bottom:2px dotted var(--notebook-border)}.status-effect-item{background:#fffef6;border-radius:6px;padding:12px;margin-bottom:8px;border:2px dashed var(--notebook-border)}.status-effect-item .status-header{display:flex;align-items:center;gap:8px;margin-bottom:6px}.status-effect-item .status-header .status-icon{font-size:18px;min-width:24px;text-align:center}.status-effect-item .status-header .status-name{font-weight:800;color:var(--text-primary);font-size:14px}.status-effect-item .status-header .status-stacks{background:var(--bookmark-blue);color:var(--text-primary);padding:2px 8px;border-radius:4px;font-size:12px;font-weight:800;border:1px solid var(--notebook-border)}.status-effect-item .status-header .status-duration{color:var(--text-secondary);font-size:12px}.status-effect-item .status-header .status-type{padding:2px 6px;border-radius:4px;font-size:10px;font-weight:700;border:1px dashed var(--notebook-border);background:var(--bookmark-yellow);color:var(--text-primary)}.status-effect-item .status-header .status-type.buff{background:var(--bookmark-green);color:#2e7d32}.status-effect-item .status-header .status-type.debuff{background:#ffebee;color:#c62828}.status-effect-item .status-description{color:var(--text-primary);font-size:13px;line-height:1.4;margin-bottom:4px}.status-effect-item .status-triggers{color:var(--text-secondary);font-size:11px;font-family:monospace;background:rgba(0,0,0,.04);padding:4px 6px;border-radius:4px;margin-top:6px;border:1px dashed var(--notebook-border)}\n</style></head><body><div class=\"rpg-container\"><nav class=\"tab-navigation\"><button class=\"tab-button active\" data-module=\"story\"><span class=\"tab-icon\">ğŸ“–</span> å‰§æƒ…</button> <button class=\"tab-button\" data-module=\"status\"><span class=\"tab-icon\">âœ¨</span> çŠ¶æ€æ </button> <button class=\"tab-button\" data-module=\"battle\"><span class=\"tab-icon\">âš”ï¸</span> æˆ˜æ–—</button> <button class=\"tab-button\" data-module=\"npc\"><span class=\"tab-icon\">ğŸ‘­</span> NPCå…³ç³»</button> <button class=\"tab-button\" data-module=\"faction\"><span class=\"tab-icon\">ğŸ°</span> åŠ¿åŠ›å…³ç³»</button></nav><div class=\"notebook-body\"><div class=\"tab-content\"><div id=\"story-content\" class=\"module-content\" style=\"display:block\"><div class=\"section\"><h2 class=\"section-title\">ğŸ“– å½“å‰å‰§æƒ…</h2><div class=\"story-text\">$1</div></div><div class=\"section\" id=\"notify-section\" style=\"display:none\"><div class=\"reward-card\" id=\"notify-card\"><div class=\"reward-header\"><strong class=\"title\">çŠ¶æ€æ›´æ–°</strong> <span class=\"badge\" id=\"level-exp-badge\" style=\"display:none\"></span></div><div class=\"reward-grid\"><section class=\"pane pane-change\" id=\"changes-section\" style=\"display:none\"><span class=\"pane-tag\">æœ¬æ¬¡å˜åŒ–</span><div class=\"change-list\" id=\"changes-list\"></div></section><section class=\"pane pane-exp\" id=\"exp-section\" style=\"display:none\"><span class=\"pane-tag\">ç­‰çº§ä¸ç»éªŒ</span><div class=\"exp-display\" id=\"exp-display\"></div></section></div><div class=\"reward-actions\"><button class=\"btn btn-plain\" id=\"notify-dismiss-btn\">çŸ¥é“äº†</button></div></div></div><div class=\"section\"><h2 class=\"section-title\">ğŸ¯ é€‰é¡¹</h2><div class=\"options-text\">$2</div><div class=\"custom-action\" style=\"margin-top:10px;display:flex;gap:8px;align-items:center\"><input id=\"custom-action-input\" placeholder=\"è¾“å…¥ä½ çš„è‡ªå®šä¹‰è¡ŒåŠ¨...\" style=\"flex:1;padding:8px 10px;border:1px solid var(--notebook-border);border-radius:6px;background:#fffef6;color:var(--text-primary)\"/> <button id=\"custom-action-send\" class=\"option-btn\" type=\"button\">å‘é€</button></div><div id=\"choice-container\" style=\"display:none;margin-top:12px\"><div class=\"reward-card\" id=\"choice-card\"><div class=\"reward-header\"><strong class=\"title\">å¥–åŠ±ç»“ç®—</strong></div><div class=\"reward-grid\"><section class=\"pane pane-card\" id=\"card-rewards-section\" style=\"display:none\"><div class=\"pane-head\"><div class=\"pane-title\">å¯é€‰ï¼šå¡ç‰Œ <span id=\"card-selection-count\">3é€‰1</span></div><div class=\"pane-sub\">å·²é€‰ <span id=\"card-selected\">0</span>/<span id=\"card-max\">1</span></div></div><div class=\"options\" id=\"card-options\"></div></section><section class=\"pane pane-artifact\" id=\"artifact-rewards-section\" style=\"display:none\"><div class=\"pane-head\"><div class=\"pane-title\">å¯é€‰ï¼šé—ç‰© <span id=\"artifact-selection-count\">3é€‰1</span></div><div class=\"pane-sub\">å·²é€‰ <span id=\"artifact-selected\">0</span>/<span id=\"artifact-max\">1</span></div></div><div class=\"options\" id=\"artifact-options\"></div></section><section class=\"pane pane-item\" id=\"item-rewards-section\" style=\"display:none\"><div class=\"pane-head\"><div class=\"pane-title\">å¯é€‰ï¼šé“å…· <span id=\"item-selection-count\">3é€‰1</span></div><div class=\"pane-sub\">å·²é€‰ <span id=\"item-selected\">0</span>/<span id=\"item-max\">1</span></div></div><div class=\"options\" id=\"item-options\"></div></section></div><div class=\"reward-actions\"><button class=\"btn btn-primary\" id=\"confirm-btn\" disabled=\"disabled\">ç¡®è®¤é¢†å–</button></div></div></div></div></div><div id=\"status-content\" class=\"module-content\"><div class=\"section\"><h2 class=\"section-title\">âœ¨ è§’è‰²çŠ¶æ€</h2><div class=\"data-grid\"><div class=\"info-card\"><h3>åŸºæœ¬ä¿¡æ¯</h3><div class=\"info-item\"><span class=\"label\">æ—¶é—´:</span> <span class=\"value\" id=\"status-time\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">åœ°ç‚¹å¤©æ°”:</span> <span class=\"value\" id=\"status-location\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">ç§°å·:</span> <span class=\"value\" id=\"status-title\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">èŒä¸š:</span> <span class=\"value\" id=\"status-job\">æœªçŸ¥</span></div></div><div class=\"info-card\"><h3>æœè£…ä¿¡æ¯</h3><div class=\"info-item\"><span class=\"label\">å¤´éƒ¨:</span> <span class=\"value\" id=\"clothing-head\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">é¢ˆéƒ¨:</span> <span class=\"value\" id=\"clothing-neck\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">æ‰‹:</span> <span class=\"value\" id=\"clothing-hands\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">ä¸Šè¡£:</span> <span class=\"value\" id=\"clothing-top\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">ä¸‹è¡£:</span> <span class=\"value\" id=\"clothing-bottom\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">å†…è¡£:</span> <span class=\"value\" id=\"clothing-underwear\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">å†…è£¤:</span> <span class=\"value\" id=\"clothing-panties\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">è…¿:</span> <span class=\"value\" id=\"clothing-legs\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">è„š:</span> <span class=\"value\" id=\"clothing-feet\">æœªçŸ¥</span></div></div><div class=\"info-card\"><h3>æºå¸¦ç‰©å“</h3><div class=\"data-grid\" id=\"carried-items\"></div></div><div class=\"info-card\"><h3>çŠ¶æ€æ•ˆæœ</h3><div class=\"info-item\"><span class=\"label\">æ°¸ä¹…æ€§çŠ¶æ€:</span><div class=\"value\" id=\"permanent-status\">æ— </div></div><div class=\"info-item\"><span class=\"label\">ä¸´æ—¶çŠ¶æ€:</span><div class=\"value\" id=\"temporary-status\">æ— </div></div></div></div></div></div><div id=\"battle-content\" class=\"module-content\"><div class=\"section\"><h2 class=\"section-title\">âš”ï¸ æˆ˜æ–—ä¿¡æ¯</h2><div class=\"data-grid\"><div class=\"info-card\"><h3>æ ¸å¿ƒå±æ€§</h3><div class=\"info-item\"><span class=\"label\">ç”Ÿå‘½å€¼:</span> <span class=\"value\" id=\"battle-hp\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">æ¬²æœ›å€¼:</span> <span class=\"value\" id=\"battle-desire\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">ç­‰çº§:</span> <span class=\"value\" id=\"battle-level\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">ç»éªŒå€¼:</span> <span class=\"value\" id=\"battle-exp\">æœªçŸ¥</span></div><div class=\"info-item\"><span class=\"label\">å¡ç‰Œåˆ é™¤æ¬¡æ•°:</span> <span class=\"value\" id=\"battle-card-remove\">æœªçŸ¥</span></div></div><div class=\"info-card\"><h3>æˆ˜æ–—ä¹‹ä¹¦</h3><div class=\"battle-book-container\"><button class=\"battle-book-btn\" onclick=\"toggleBattleBook()\">ğŸ“– æŸ¥çœ‹çŠ¶æ€æ•ˆæœ</button><div class=\"battle-book-content\" id=\"battle-book-content\" style=\"display:none\"></div></div></div><div class=\"info-card\"><h3>é—ç‰©</h3><div class=\"data-grid\" id=\"battle-artifacts\"></div></div><div class=\"info-card\"><h3>æ¶ˆè€—å“</h3><div class=\"data-grid\" id=\"battle-items\"></div></div><div class=\"info-card\"><h3>å¡ç‰Œç»„åˆ <button id=\"delete-mode-toggle\" class=\"delete-toggle-btn\" onclick=\"toggleDeleteMode()\">ğŸ—‘ï¸<span id=\"delete-count\">0</span></button></h3><div class=\"battle-deck\" id=\"battle-deck\"></div></div></div></div></div><div id=\"npc-content\" class=\"module-content\"><div class=\"section\"><h2 class=\"section-title\">ğŸ‘­ NPCå…³ç³»</h2><div class=\"data-grid\" id=\"npc-relations\"></div></div></div><div id=\"faction-content\" class=\"module-content\"><div class=\"section\"><h2 class=\"section-title\">ğŸ° åŠ¿åŠ›å…³ç³»</h2><div class=\"alignment-grid\" id=\"alignment-grid\"></div><div class=\"data-grid\" id=\"faction-relations\"></div></div></div></div></div></div><script>let t=null,e=null,n=null,s=null,a=!1;function o(t){return t&&'object'==typeof t?t.stat_data&&'object'==typeof t.stat_data?t.stat_data:t:{}}let l=!1,i=[],c=!1;function r(){if(c)return;const t=document.getElementById('custom-action-input'),e=document.getElementById('custom-action-send');if(!t||!e)return;c=!0;const n=async()=>{const n=(t.value||'').trim();if(n){if(!a){a=!0,e.disabled=!0,e.classList.add('disabled');try{await k(n)}catch(t){console.error('è‡ªå®šä¹‰è¡ŒåŠ¨å‘é€å¤±è´¥:',t),a=!1,e.disabled=!1,e.classList.remove('disabled'),'undefined'!=typeof toastr&&toastr.error('å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•')}finally{t.value='',t.focus()}}}else'undefined'!=typeof toastr&&toastr.info('è¯·è¾“å…¥è¦å‘é€çš„å†…å®¹')};e.onclick=n,t.addEventListener('keydown',(t=>{'Enter'===t.key&&n()})),console.log('[è‡ªå®šä¹‰è¡ŒåŠ¨] å·²ç»‘å®š')}const d=[],u=[];!function(){const t=window;if(t.__AUGMENT_INJECT_WRAPPED)return;const e=e=>{const n=t[e];'function'==typeof n&&(t[e]=async e=>{const s=Array.isArray(e?.injects)?[...e.injects]:[];u.length&&s.push(...u.splice(0));const a=e&&'object'==typeof e?{...e,injects:s}:{injects:s};return await n.call(t,a)})};e('generate'),e('generateRaw'),t.__AUGMENT_INJECT_WRAPPED=!0}();const p={head:'å¤´éƒ¨',neck:'é¢ˆéƒ¨',hands:'æ‰‹éƒ¨',upper_body:'ä¸Šèº«',lower_body:'ä¸‹èº«',underwear:'å†…è¡£',undergarments:'å†…è£¤',legs:'è…¿éƒ¨',feet:'è„šéƒ¨',profession:'èŒä¸š',inventory:'æŒæœ‰ç‰©',permanent_status:'æ°¸ä¹…çŠ¶æ€'};function m(t){if(!t)return[];if(Array.isArray(t)){const e=[];return t.forEach(((t,n)=>{Array.isArray(t)?e.push(...x(t)):'$__META_EXTENSIBLE__$'!==t&&null!=t&&''!==t&&e.push(t)})),x(e)}return'object'==typeof t?[t]:[]}function f(t){const e=t?.reward;return e?Array.isArray(e)?e[0]:e:null}function y(t){const e=f(t);if(!e)return!1;const n=m(e.card),s=m(e.artifact),a=m(e.item);return n.length>0||s.length>0||a.length>0}function g(t,e){const n=[],s=t=>{try{return JSON.parse(t)}catch{return null}},a=t=>{if('string'!=typeof t)return null;if(!t.includes('->'))return null;console.log('ğŸ” è§£æç®­å¤´å¯¹:',t);const e=t.split('->');if(e.length<2)return null;const n=e[0].trim(),a=e.slice(1).join('->').trim();console.log('ğŸ” å·¦ä¾§:',n),console.log('ğŸ” å³ä¾§:',a);const o=s(n),l=s(a);return console.log('ğŸ” è§£æç»“æœ:',{oldVal:o,newVal:l}),{oldVal:o,newVal:l}},o=t?.status?.profession;'string'==typeof o&&o.includes('->')&&n.push('èŒä¸šï¼š'+o);const l=t?.status?.clothing,i=['head','neck','hands','upper_body','lower_body','underwear','undergarments','legs','feet'];if(console.log('ğŸ” æœè£… delta:',l),'string'==typeof l&&l.includes('->')&&l.includes('{')){const t=a(l);if(console.log('ğŸ” è§£æçš„æœè£…å¯¹:',t),t&&t.newVal&&'object'==typeof t.newVal){const e=t.oldVal&&'object'==typeof t.oldVal?t.oldVal:{},s=t.newVal;i.forEach((t=>{const a=e?.[t]??'',o=s?.[t]??'';String(a)!==String(o)&&n.push(`${p[t]||t}ï¼š${a||'æ— '}->${o||'æ— '}`)}))}}else'object'==typeof l&&null!==l&&i.forEach((t=>{const e=l?.[t];'string'==typeof e&&e.includes('->')&&n.push(`${p[t]||t}ï¼š${e}`)}));const c=(t,e)=>{(Array.isArray(t)?t:'string'==typeof t?[t]:[]).forEach((t=>{const s=String(t),a=s.match(/ASSIGNED\\s+\"([^\"]+)\"/);a&&a[1]?n.push(`æ–°å¢${e}ï¼š${a[1]}`):/æ–°å¢|ADDED|\\+/.test(s)&&n.push(`æ–°å¢${e}ï¼š${s.replace(/^.*?(æ–°å¢|ADDED|\\+)\\s*/,'')}`)}))};c(t?.status?.permanent_status,'æ°¸ä¹…çŠ¶æ€'),c(t?.status?.inventory,'æŒæœ‰ç‰©');const r=(t,e)=>{if(!t)return;console.log(`ğŸ” ${e} delta:`,t);(Array.isArray(t)?t:'string'==typeof t?[t]:[]).forEach((t=>{const a=String(t);if(console.log(`ğŸ” ${e} æ¡ç›®:`,a),a.includes('[')||a.includes('{')){const t=(t=>{if('string'!=typeof t)return null;const e=t.match(/ASSIGNED\\s+(\\[.*|\\{.*)/),n=(t=>{const e=t.indexOf('[')>=0&&(-1===t.indexOf('{')||t.indexOf('[')<t.indexOf('{'))?'[':'{',n=t.indexOf(e);if(-1===n)return null;let s=0,a=!1,o=!1;for(let l=n;l<t.length;l++){const i=t[l];if(a){if(o){o=!1;continue}if('\\\\'===i){o=!0;continue}if('\"'===i){a=!1;continue}}else if('\"'!==i){if(i===e)s++;else if(i===('['===e?']':'}')&&(s--,0===s))return t.slice(n,l+1)}else a=!0}return null})(e?e[1]:t);if(!n)return null;const a=s(n);return Array.isArray(a)?a:a&&'object'==typeof a?[a]:null})(a);console.log(`ğŸ” ${e} è§£æç»“æœ:`,t),t&&t.length&&t.forEach((t=>{const s=t?.name||t?.id||'æœªçŸ¥',a=t?.quantity?` x${t.quantity}`:'';n.push(`æ–°å¢${e}ï¼š${s}${a}`)}))}else a.includes('->')&&n.push(`${e}ï¼š${a}`)}))};r(t?.battle?.cards,'å¡ç‰Œ'),r(t?.battle?.artifacts,'é—ç‰©'),r(t?.battle?.items,'é“å…·');const d=t?.battle?.player_lust_effect;if(d)if('string'==typeof d){if(d.includes('->')){const t=a(d),e=t&&t.newVal&&'object'==typeof t.newVal?t.newVal.name:null;e&&n.push(`ç©å®¶æ¬²æœ›æ•ˆæœï¼š${e}`)}}else if('object'==typeof d&&null!==d){const t=d.name;if('string'==typeof t)if(t.includes('->')){const e=t.split('->').slice(1).join('->').trim();try{const t=JSON.parse(e),s='string'==typeof t?t:null;s&&n.push(`ç©å®¶æ¬²æœ›æ•ˆæœï¼š${s}`)}catch{const t=e.replace(/^\"|\"$/g,'');t&&n.push(`ç©å®¶æ¬²æœ›æ•ˆæœï¼š${t}`)}}else t&&n.push(`ç©å®¶æ¬²æœ›æ•ˆæœï¼š${t}`)}const u=t?.battle?.core?.card_removal_count;return'string'==typeof u&&u.includes('->')&&n.push('åˆ å¡æ¬¡æ•°ï¼š'+u),n}async function h(t){await updateVariablesWith((e=>{if(!e.stat_data)throw new Error('stat_dataä¸å­˜åœ¨');const s=e.stat_data.reward;if(!s)throw new Error('rewardæ•°æ®ä¸å­˜åœ¨');const a=Array.isArray(s)?s[0]||{}:s,o=m(a.card),l=m(a.artifact),c=m(a.item),r=e.stat_data.battle,d=(t,e)=>{if(!e||'object'!=typeof e)return void t.push(e);const n=e.id||e.name;if(!n)return void t.push(e);const s=t.find((t=>t&&'object'==typeof t&&(t.id||t.name)===n));if(s){const t=Math.max(1,Number(e.quantity||1));s.quantity=Math.max(0,Number(s.quantity||1))+t}else null==e.quantity&&(e.quantity=1),t.push(e)},u=(t,e,n)=>{const s=(t=>{const e=r[t];return Array.isArray(e)?e.length>=2&&Array.isArray(e[0])&&'string'==typeof e[1]||e.length>=1&&Array.isArray(e[0])?e[0]:e:(console.warn(`[MVU] ç›®æ ‡ ${t} ä¸å­˜åœ¨æˆ–éæ•°ç»„ï¼Œè·³è¿‡å†™å…¥ä»¥é¿å…ç ´åå¯æ‰©å±•ç»“æ„`),null)})(t);Array.isArray(s)?n.forEach((n=>{const a=e[n];null!=a&&(Array.isArray(a)?a.forEach((e=>{null!=e&&('cards'===t?d(s,e):s.push(e))})):'cards'===t?d(s,a):s.push(a))})):console.warn(`[MVU] è¿½åŠ  ${t} å¤±è´¥ï¼šç›®æ ‡ä¸å¯å†™ï¼ˆä¸å­˜åœ¨æˆ–éæ•°ç»„ï¼‰`)},p={cards:[],artifacts:[],items:[]};t.cards.length&&(u('cards',o,t.cards),t.cards.forEach((t=>{const e=o[t];if(e){const t=e.name||e.id||'æœªçŸ¥',n=e.quantity?` x${e.quantity}`:'';i.push(`æ–°å¢å¡ç‰Œï¼š${t}${n}`),p.cards.push(t+n)}}))),t.artifacts.length&&(u('artifacts',l,t.artifacts),t.artifacts.forEach((t=>{const e=l[t];if(e){const t=e.name||e.id||'æœªçŸ¥',n=e.quantity?` x${e.quantity}`:'';i.push(`æ–°å¢é—ç‰©ï¼š${t}${n}`),p.artifacts.push(t+n)}}))),t.items.length&&(u('items',c,t.items),t.items.forEach((t=>{const e=c[t];if(e){const t=e.name||e.id||'æœªçŸ¥',n=e.count?` x${e.count}`:e.quantity?` x${e.quantity}`:'';i.push(`æ–°å¢é“å…·ï¼š${t}${n}`),p.items.push(t+n)}})));try{if(p.cards.length+p.artifacts.length+p.items.length>0){const t=[];p.cards.length&&t.push(`å¡ç‰Œ[${p.cards.join('ï¼Œ')}]`),p.artifacts.length&&t.push(`é—ç‰©[${p.artifacts.join('ï¼Œ')}]`),p.items.length&&t.push(`é“å…·[${p.items.join('ï¼Œ')}]`),n=`æœ¬è½®ç©å®¶é¢†å–å¥–åŠ±ï¼š${t.join(' ')}`,console.log('ğŸ¯ å·²ç”Ÿæˆé¢†å–æ‘˜è¦ï¼ˆå¾…ç»‘å®šè‡³é€‰é¡¹å‘é€ï¼‰ï¼š',n)}}catch(t){console.warn('ç”Ÿæˆé¢†å–æ‘˜è¦å¤±è´¥:',t)}return a.card=[],a.artifact=[],a.item=[],a.limits={},Array.isArray(s)&&(e.stat_data.reward[0]=a),e}),{type:'message'})}function v(){const n=t||{},s=e||{};console.log('ğŸ“¢ æ¸²æŸ“é€šçŸ¥æ¨¡å— - stat:',n),console.log('ğŸ“¢ æ¸²æŸ“é€šçŸ¥æ¨¡å— - delta:',s),console.log('ğŸ“¢ æ¸²æŸ“é€šçŸ¥æ¨¡å— - ç”¨æˆ·æ“ä½œ pills:',i);const a=t=>{t.forEach((t=>{d.includes(t)||d.push(t)}))};a(g(s)),i.length&&a(i),i=[],console.log('ğŸ“¢ æ¸²æŸ“é€šçŸ¥æ¨¡å— - æœ€ç»ˆ pills:',d);const o=e?.battle?.exp,l=e?.battle?.level;let c=!1;if('string'==typeof o&&o.includes('->')){const t=o.split('->'),e=parseInt(t[0].trim(),10),n=parseInt(t.slice(1).join('->').trim(),10);!isNaN(e)&&!isNaN(n)&&n>e&&(c=!0)}const r='string'==typeof l&&l.includes('->'),u=document.getElementById('notify-section'),p=document.getElementById('changes-section'),m=document.getElementById('exp-section'),f=document.getElementById('changes-list'),y=document.getElementById('exp-display'),h=document.getElementById('level-exp-badge');if(!(u&&p&&m&&f&&y&&h))return;if(d.length>0?(p.style.display='block',f.innerHTML=d.map((t=>`<span class=\"pill\">${t}</span>`)).join('')):p.style.display='none',c||r){m.style.display='block';const t=[];if(c&&'string'==typeof o&&o.includes('->')){const e=o.split('->'),s=parseInt(e[0].trim(),10)||0,a=parseInt(e.slice(1).join('->').trim(),10)||0,l=Number(n?.battle?.level??1),i=Number(n?.battle?.exp??0);let c=l,r=i,d=a-s;for(;d>0&&c>1;)r>=d?(r-=d,d=0):(d-=r,c--,r=Math.max(50*c,50)-1);if(d>0){r=s,c=1;let t=r;for(;t>=50*c;)t-=50*c,c++;r=t}const u=Math.max(50*c,50),p=Math.max(50*l,50);t.push(`ç­‰çº§ï¼šLV ${c} -> LV ${l}`),t.push(`ç»éªŒå€¼ï¼š${r}/${u} -> ${i}/${p}`)}else{const e=Number(n?.battle?.level??1),s=Number(n?.battle?.exp??0),a=Math.max(50*e,50);t.push(`ç­‰çº§ï¼šLV ${e}`),t.push(`ç»éªŒå€¼ï¼š${s}/${a}`)}y.innerHTML=t.map((t=>`<div class=\"exp-item\"><span class=\"exp-icon\">âœ¨</span><span class=\"exp-text\">${t}</span></div>`)).join('');const e=Number(n?.battle?.level??1),s=Number(n?.battle?.exp??0);h.textContent=`Lv.${e} Â· EXP ${s}`,h.style.display='block'}else m.style.display='none',h.style.display='none';const v=d.length>0||c||r;u.style.display=v?'block':'none'}function b(){const e=t||{},s=f(e)||{},a=function(t){const e=f(t)||{};return{cards:e?.limits?.cards||1,artifacts:e?.limits?.artifacts||1,items:e?.limits?.items||1}}(e),o=m(s.card),i=m(s.artifact),c=m(s.item),r=document.getElementById('choice-container'),d=document.getElementById('card-rewards-section'),u=document.getElementById('artifact-rewards-section'),p=document.getElementById('item-rewards-section');if(!(r&&d&&u&&p))return;if(o.length>0){d.style.display='block';const t=document.getElementById('card-options'),e=document.getElementById('card-selection-count'),n=document.getElementById('card-selected'),s=document.getElementById('card-max');if(t&&e&&n&&s){e.textContent=`${o.length}é€‰${a.cards}`,s.textContent=String(a.cards);const n='checkbox',l='';t.innerHTML=o.map(((t,e)=>`\\n        <label class=\"option\">\\n          <input type=\"${n}\" ${l?`name=\"${l}\"`:''} value=\"${e}\" />\\n          <span class=\"icon\">${t.emoji||'ğŸƒ'}</span>\\n          <span class=\"text\">\\n            <div class=\"name\">${t.name||'æœªçŸ¥'}</div>\\n            <div class=\"desc\">${t.description||'æ— æè¿°'}</div>\\n          </span>\\n        </label>\\n      `)).join('')}}else d.style.display='none';if(i.length>0){u.style.display='block';const t=document.getElementById('artifact-options'),e=document.getElementById('artifact-selection-count'),n=document.getElementById('artifact-selected'),s=document.getElementById('artifact-max');if(t&&e&&n&&s){e.textContent=`${i.length}é€‰${a.artifacts}`,s.textContent=String(a.artifacts);const n='checkbox',o='';t.innerHTML=i.map(((t,e)=>`\\n        <label class=\"option\">\\n          <input type=\"${n}\" ${o?`name=\"${o}\"`:''} value=\"${e}\" />\\n          <span class=\"icon\">${t.emoji||'ğŸ’'}</span>\\n          <span class=\"text\">\\n            <div class=\"name\">${t.name||'æœªçŸ¥'}</div>\\n            <div class=\"desc\">${t.description||'æ— æè¿°'}</div>\\n          </span>\\n        </label>\\n      `)).join('')}}else u.style.display='none';if(c.length>0){p.style.display='block';const t=document.getElementById('item-options'),e=document.getElementById('item-selection-count'),n=document.getElementById('item-selected'),s=document.getElementById('item-max');if(t&&e&&n&&s){e.textContent=`${c.length}é€‰${a.items}`,s.textContent=String(a.items);const n='checkbox',o='';t.innerHTML=c.map(((t,e)=>`\\n        <label class=\"option\">\\n          <input type=\"${n}\" ${o?`name=\"${o}\"`:''} value=\"${e}\" />\\n          <span class=\"icon\">${t.emoji||'ğŸ§ª'}</span>\\n          <span class=\"text\">\\n            <div class=\"name\">${t.name||'æœªçŸ¥'}</div>\\n            <div class=\"desc\">${t.description||'æ— æè¿°'}</div>\\n          </span>\\n        </label>\\n      `)).join('')}}else p.style.display='none';const y=o.length>0||i.length>0||c.length>0;r.style.display=y?'flex':'none',y&&function(t,e,s,a){const o={cards:[],artifacts:[],items:[]},i=(t,e)=>'cards'===t?`card-${e}`:'artifacts'===t?`artifact-${e}`:`item-${e}`;function c(n,l){const c=document.getElementById(i(n,'options')),r=document.getElementById(i(n,'selected'));c&&c.querySelectorAll('input[type=\"checkbox\"]').forEach((i=>{i.addEventListener('change',(i=>{const d=i.target,u=parseInt(d.value),p=o[n];if(d.checked)if(1===l){if(1===p.length&&p[0]!==u){const t=p[0],e=c.querySelector(`input[type=\"checkbox\"][value=\"${t}\"]`);e&&(e.checked=!1),p.length=0}-1===p.indexOf(u)&&p.push(u)}else-1===p.indexOf(u)&&(p.length<l?p.push(u):d.checked=!1);else{const t=p.indexOf(u);-1!==t&&p.splice(t,1)}r&&(r.textContent=String(o[n].length)),E(o,t,e,s,a)}))}))}c('cards',a.cards),c('artifacts',a.artifacts),c('items',a.items),E(o,t,e,s,a);const r=document.getElementById('confirm-btn');if(r){const i=r.cloneNode(!0);r.parentNode?.replaceChild(i,r),i.addEventListener('click',(async()=>{if(l)return;if(t.length>0&&o.cards.length<Math.min(a.cards,t.length)||e.length>0&&o.artifacts.length<Math.min(a.artifacts,e.length)||s.length>0&&o.items.length<Math.min(a.items,s.length)){let t=document.getElementById('inline-confirm-bar');if(!t){i.style.display='none',t=document.createElement('div'),t.id='inline-confirm-bar',t.style.cssText=['margin-top:8px','padding:12px','border:1px solid #ffd666','background:#fff7e6','border-radius:8px','box-shadow:0 1px 4px rgba(0,0,0,0.06)'].join(';'),t.innerHTML='\\n            <div style=\"display:flex;align-items:center;gap:12px;flex-wrap:wrap;\">\\n              <span style=\"color:#ad6800;\">æ‚¨å°šæœªé€‰æ»¡æ‰€æœ‰å¥–åŠ±ä¸Šé™ï¼Œæ˜¯å¦ä»¥å½“å‰é€‰æ‹©ç»§ç»­é¢†å–ï¼Ÿ</span>\\n              <div style=\"display:flex;gap:8px;\">\\n                <button id=\"inline-confirm-yes\" class=\"option-btn\">ç»§ç»­é¢†å–</button>\\n                <button id=\"inline-confirm-no\" class=\"option-btn\" style=\"background:#f0f0f0;color:#333;\">å–æ¶ˆ</button>\\n              </div>\\n            </div>\\n          ',i.parentElement?.appendChild(t);const e=document.getElementById('inline-confirm-yes'),n=document.getElementById('inline-confirm-no');e?.addEventListener('click',(async()=>{t.remove(),i.style.display='',await c()})),n?.addEventListener('click',(()=>{t.remove(),i.style.display=''}))}}else await c();async function c(){try{l=!0,i.disabled=!0;const a=document.getElementById('choice-container');a&&(a.style.display='none'),await h(o);try{const a=[];if(o.cards.length){const e=o.cards.map((e=>(t[e]?.name||t[e]?.id||'æœªçŸ¥')+(t[e]?.quantity?` x${t[e]?.quantity}`:''))).filter(Boolean);e.length&&a.push(`å¡ç‰Œ[${e.join('ï¼Œ')}]`)}if(o.artifacts.length){const t=o.artifacts.map((t=>(e[t]?.name||e[t]?.id||'æœªçŸ¥')+(e[t]?.quantity?` x${e[t]?.quantity}`:''))).filter(Boolean);t.length&&a.push(`é—ç‰©[${t.join('ï¼Œ')}]`)}if(o.items.length){const t=o.items.map((t=>(s[t]?.name||s[t]?.id||'æœªçŸ¥')+(s[t]?.count?` x${s[t]?.count}`:s[t]?.quantity?` x${s[t]?.quantity}`:''))).filter(Boolean);t.length&&a.push(`é“å…·[${t.join('ï¼Œ')}]`)}n=a.length?`{{user}}å·²è·å¾—ï¼š${a.join(' ')}`:'{{user}}æ²¡æœ‰é¢†å–å¥–åŠ±',console.log('âœ… å·²ç¼“å­˜æœ¬è½®å¥–åŠ±é€‰æ‹©æ‘˜è¦ï¼ˆå°†é™„å¸¦åˆ°ä¸‹ä¸€æ¬¡é€‰é¡¹å‘é€ä¸­ï¼‰:',n)}catch(t){console.warn('æ’å…¥ç©å®¶å¥–åŠ±é€‰æ‹©æ¶ˆæ¯å¤±è´¥:',t)}v(),'undefined'!=typeof toastr&&toastr.success('å¥–åŠ±å·²æˆåŠŸé¢†å–ï¼','æ­å–œï¼'),setTimeout((()=>window.refreshData()),200)}catch(t){console.error('ç¡®è®¤é¢†å–å¤±è´¥',t),'undefined'!=typeof toastr&&toastr.error('é¢†å–å¥–åŠ±å¤±è´¥ï¼Œè¯·é‡è¯•','é”™è¯¯')}finally{l=!1}}}))}}(o,i,c,a)}function E(t,e,n,s,a){const o=document.getElementById('confirm-btn');o&&(o.disabled=l)}function w(e){if(l)return;console.log('ğŸ æ¸²æŸ“å¥–åŠ±å†…è” - å¼€å§‹'),console.log('ğŸ æ¸²æŸ“å¥–åŠ±å†…è” - å¯é€‰å¥–åŠ±:',y(t));const n=y(t),s=e.previousElementSibling||null;e.style.display=n?'none':'',s&&s.classList.contains('section-title')&&(s.style.display=n?'none':''),v(),b(),r();const a=document.getElementById('notify-dismiss-btn');a&&a.addEventListener('click',(()=>{const t=document.getElementById('notify-section');t&&(t.style.display='none')})),r()}function x(t){return Array.isArray(t)?t.filter((t=>'$__META_EXTENSIBLE__$'!==t&&'[]'!==t&&null!=t&&''!==t)):[]}async function I(){try{let n=null,a={};try{n=getVariables({type:'message'}),t=o(n)||{},e=n?.delta_data||n?.delta||{},a=t,console.log('ğŸ”„ åŠ è½½æ¸¸æˆæ•°æ® - å˜é‡:',n),console.log('ğŸ”„ åŠ è½½æ¸¸æˆæ•°æ® - stat_data:',t),console.log('ğŸ”„ åŠ è½½æ¸¸æˆæ•°æ® - delta_data:',e)}catch(t){return void console.warn('è·å–å˜é‡å¤±è´¥ï¼š',t)}try{await async function(){try{await updateVariablesWith((async t=>{const e=o(t)||{},n=e?.battle||t?.battle;if(!n)return t;n.core||(n.core={});let s=Number(n.level)||1,a=Number(n.exp)||0,l=0;const i=t=>Math.max(50*t,50);for(;a>=i(s);)if(a-=i(s),s+=1,l+=1,s%2==0){const t=Number(n.core.card_removal_count)||0;n.core.card_removal_count=t+1}return l>0&&(n.level=s,n.exp=a),t}),{type:'message'})}catch(t){console.warn('ç»“ç®—å‡çº§å¤±è´¥ï¼š',t)}}()}catch(t){console.warn('ç»“ç®—å‡çº§å¼‚å¸¸:',t)}try{n=getVariables({type:'message'}),t=o(n)||{},e=n?.delta_data||n?.delta||{},a=t,s={level:Number(t?.battle?.level??1),exp:Number(t?.battle?.exp??0)}}catch(t){console.warn('ç»“ç®—åé‡æ–°è·å–å˜é‡å¤±è´¥ï¼š',t)}!function(t){const e=t.status||{};[{id:'status-time',path:'time'},{id:'status-location',path:'location_weather'},{id:'status-title',path:'title'},{id:'status-job',path:'profession'}].forEach((({id:t,path:n})=>{const s=document.getElementById(t);s&&(s.textContent=e?.[n]||'æœªçŸ¥')}));const n=e.clothing||{};[{id:'clothing-head',path:'head'},{id:'clothing-neck',path:'neck'},{id:'clothing-hands',path:'hands'},{id:'clothing-top',path:'upper_body'},{id:'clothing-bottom',path:'lower_body'},{id:'clothing-underwear',path:'underwear'},{id:'clothing-panties',path:'panties'},{id:'clothing-legs',path:'legs'},{id:'clothing-feet',path:'feet'}].forEach((({id:t,path:e})=>{const s=document.getElementById(t);s&&(s.textContent=n?.[e]||'æœªç©¿æˆ´')}));let s=e?.inventory||[];s=s.filter((t=>null!=t&&''!==t));const a=document.getElementById('carried-items');a&&(s.length>0?a.innerHTML=s.map((t=>`<div class=\"info-item\"><span class=\"value\">${t}</span></div>`)).join(''):a.innerHTML='<div class=\"info-item\"><span class=\"value\">æ— </span></div>');let o=e?.permanent_status||[],l=e?.temporary_status||[];o=o.filter((t=>null!=t&&''!==t)),l=l.filter((t=>null!=t&&''!==t));const i=document.getElementById('permanent-status');i&&(i.innerHTML=o.length>0?o.map((t=>`<div class=\"info-item\"><span class=\"value\">${t}</span></div>`)).join(''):'<div class=\"info-item\"><span class=\"value\">æ— </span></div>');const c=document.getElementById('temporary-status');c&&(c.innerHTML=l.length>0?l.map((t=>`<div class=\"info-item\"><span class=\"value\">${t}</span></div>`)).join(''):'<div class=\"info-item\"><span class=\"value\">æ— </span></div>')}(a),function(t){const e=t.battle||{},n=e.core||{},s=m(e.cards),a=m(e.artifacts),o=m(e.items),l=document.getElementById('battle-hp');if(l){const t=n?.hp||0,e=n?.max_hp||100;l.textContent=`${t}/${e}`}const i=document.getElementById('battle-desire');if(i){const t=n?.lust||0,e=n?.max_lust||100;i.textContent=`${t}/${e}`}const c=document.getElementById('battle-level');if(c){const t=e?.level||1;c.textContent=`LV ${t}`}const r=document.getElementById('battle-exp');if(r){const t=Number(e?.exp)||0,n=Number(e?.level)||1,s=Math.max(50*n,50);r.textContent=`${t}/${s}`}const d=document.getElementById('delete-count');if(d){const t=n?.card_removal_count||0;d.textContent=t.toString()}const u=document.getElementById('battle-card-remove');if(u){const t=n?.card_removal_count||0;u.textContent=t.toString()}const p=document.getElementById('battle-deck'),f=document.getElementById('battle-artifacts'),y=document.getElementById('battle-items');if(p){const t=x(s||[]);if(t.length>0){const e=t.map((t=>{return`\\n          <div class=\"card\" data-card-id=\"${t.id}\">\\n            <div class=\"card-delete-btn\" onclick=\"removeCard('${t.id}')\" style=\"display: none;\">\\n              ğŸ—‘ï¸\\n            </div>\\n            <div class=\"card-name\">${t.emoji||'ğŸƒ'} ${t.name}</div>\\n            <div class=\"card-cost\">æ¶ˆè€—: ${t.cost||0}</div>\\n            <div class=\"card-type\">${e=t.type||'Skill',{Attack:'æ”»å‡»',Skill:'æŠ€èƒ½',Power:'èƒ½åŠ›',Event:'äº‹ä»¶',Corrupt:'è…åŒ–'}[e]||e}</div>\\n            <div class=\"card-quantity\">æ•°é‡: ${t.quantity||1}</div>\\n          </div>`;var e})).join('');p.innerHTML=e}else p.innerHTML='<div class=\"value\">ç‰Œåº“ä¸ºç©º</div>'}if(f){const t=x(a);t.length>0?f.innerHTML=t.map((t=>`\\n          <div class=\"info-item\">\\n            <span class=\"value\">${t.emoji||'ğŸ’'} ${t.name}: ${t.description}</span>\\n          </div>`)).join(''):f.innerHTML='<div class=\"value\">æ— é—ç‰©</div>'}if(y){const t=x(o);t.length>0?y.innerHTML=t.map((t=>`\\n          <div class=\"info-item\">\\n            <span class=\"value\">${t.emoji||'ğŸ§ª'} ${t.name} x${t.count||1}</span>\\n            <div class=\"item-description\">${t.description||'æ— æè¿°'}</div>\\n          </div>`)).join(''):y.innerHTML='<div class=\"value\">æ— é“å…·</div>'}window.battleBookData={playerStatusEffects:e.player_status_effects||[],statuses:e.statuses||[]}}(a),function(t){const e=t.npcs||{},n=document.getElementById('npc-relations');if(n){const t=Object.entries(e).filter((([t,e])=>'$meta'!==t&&e&&'object'==typeof e&&!Array.isArray(e)&&(e.name||e.NPCå§“å)));t.length>0?n.innerHTML=t.map((([t,e])=>{const n=e?.name||t,s=e?.tracking||!1,a=e?.current_action||'æ— åŠ¨ä½œ',o=e?.affection||0,l=e?.affection_level||'æœªçŸ¥';return`<div class=\"info-card\">\\n            <h3 class=\"card-title\">${n}</h3>\\n            <div class=\"info-item\">\\n              <span class=\"label\">è¿½è¸ªçŠ¶æ€:</span>\\n              <span class=\"value\">${s?'è¿½è¸ªä¸­':'æœªè¿½è¸ª'}</span>\\n              <button class=\"tracking-btn ${s?'tracking-on':'tracking-off'}\"\\n                      onclick=\"toggleNPCTracking('${t}', ${!s})\">\\n                ${s?'ğŸ”´ åœæ­¢è¿½è¸ª':'ğŸŸ¢ å¼€å§‹è¿½è¸ª'}\\n              </button>\\n            </div>\\n            ${s?`<div class=\"info-item\">\\n              <span class=\"label\">å½“å‰è¡ŒåŠ¨:</span>\\n              <span class=\"value\">${a}</span>\\n            </div>`:''}\\n            <div class=\"info-item\">\\n              <span class=\"label\">å¥½æ„Ÿåº¦:</span>\\n              <span class=\"value\">${o} ${l?`(${l})`:''}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">é˜µè¥:</span>\\n              <span class=\"value\">${e?.alignment||'æœªçŸ¥é˜µè¥'}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">å¯¹ä¸»è§’çš„çœ‹æ³•/å…³ç³»:</span>\\n              <span class=\"value\">${e?.relationship||'æœªçŸ¥å…³ç³»'}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">ä¸å…¶ä»–NPCå…³ç³»:</span>\\n              <span class=\"value\">${e?.other_npc_relations||'æ— '}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">ç­‰çº§:</span>\\n              <span class=\"value\">LV ${e?.level||1}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">å¤–è²Œæè¿°:</span>\\n              <span class=\"value\">${e?.appearance||'æ— æè¿°'}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">èƒ½åŠ›æè¿°:</span>\\n              <span class=\"value\">${e?.abilities||'æ— '}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">æˆ˜æ–—é£æ ¼æè¿°:</span>\\n              <span class=\"value\">${e?.battle_style||'æ— '}</span>\\n            </div>\\n          </div>`})).join(''):n.innerHTML='<div class=\"info-card\"><h3>æš‚æ— NPCå…³ç³»</h3></div>'}}(a),function(t){const e=t.factions||{},n=e?.player_alignment||'ç»å¯¹ä¸­ç«‹',s=x(e.relations||[]);!function(t){const e=document.getElementById('alignment-grid');if(!e)return;const n=['å®ˆåºå–„è‰¯','ä¸­ç«‹å–„è‰¯','æ··ä¹±å–„è‰¯','å®ˆåºä¸­ç«‹','ç»å¯¹ä¸­ç«‹','æ··ä¹±ä¸­ç«‹','å®ˆåºé‚ªæ¶','ä¸­ç«‹é‚ªæ¶','æ··ä¹±é‚ªæ¶'];e.innerHTML='',n.forEach((n=>{const s=document.createElement('div');s.className='alignment-cell'+(n===t?' active':''),s.textContent=n,e.appendChild(s)}))}(n);const a=document.getElementById('faction-relations');a&&(s.length>0?a.innerHTML=s.map((t=>`\\n        <div class=\"info-card\">\\n          <h3>${t.name}</h3>\\n          <div class=\"info-item\">\\n            <span class=\"label\">çŠ¶æ€:</span>\\n            <span class=\"value faction-status ${t.status?.toLowerCase()||'neutral'}\">${t.status||'ä¸­ç«‹'}</span>\\n          </div>\\n          <div class=\"info-item\">\\n            <span class=\"label\">å£°æœ›:</span>\\n            <span class=\"value\">${t.reputation||0}</span>\\n          </div>\\n          <div class=\"info-item\">\\n            <span class=\"label\">å¤‡æ³¨:</span>\\n            <span class=\"value\">${t.note||'æ— '}</span>\\n          </div>\\n        </div>\\n      `)).join(''):a.innerHTML='<div class=\"info-card\"><h3>æš‚æ— åŠ¿åŠ›å…³ç³»</h3></div>')}(a),console.log('ğŸ”„ åŠ è½½æ¸¸æˆæ•°æ® - å¼€å§‹æ¸²æŸ“é€‰é¡¹'),B(),console.log('ğŸ”„ åŠ è½½æ¸¸æˆæ•°æ® - æ¸²æŸ“é€‰é¡¹å®Œæˆ')}catch(t){console.error('åŠ è½½æ¸¸æˆæ•°æ®å¤±è´¥:',t)}}function B(){const n=document.querySelector('.options-text');if(!n)return;a=!1,r();let s=n.innerHTML.trim();console.log('Options HTMLå†…å®¹:',s),s.includes('<Option')||s.includes('<BattleOption')||(s=n.textContent||n.innerText||'',console.log('Optionsæ–‡æœ¬å†…å®¹:',s));const l=s.includes('<REWARD>');s.replace(/<REWARD>/g,'').trim();try{if(!t){const n=getVariables({type:'message'});t=o(n)||{},e=n?.delta_data||n?.delta||{}}}catch(t){console.warn('è·å–å˜é‡å¤±è´¥ï¼ˆå¥–åŠ±é¢„å¤„ç†ï¼‰',t)}console.log('ğŸ” å½“å‰ delta_data:',e),console.log(' å½“å‰ stat_data:',t);try{console.log('ğŸ“¦ å®Œæ•´ stat_data JSON:',JSON.stringify(t,null,2))}catch(t){console.warn('stat_data åºåˆ—åŒ–å¤±è´¥:',t)}n.style.display='';const i=y(t),c=g(e||{}),d=e?.battle?.exp,u=e?.battle?.level,p=c.length>0||'string'==typeof d&&d.includes('->')||'string'==typeof u&&u.includes('->');if(console.log('ğŸ” é€šçŸ¥ pills:',c),console.log('ğŸ” ç»éªŒå˜åŒ–:',d),console.log('ğŸ” ç­‰çº§å˜åŒ–:',u),console.log('ğŸ” æœ‰é€šçŸ¥:',p),console.log('ğŸ¯ æ¸²æŸ“é€‰é¡¹ - æœ‰å¯é€‰å¥–åŠ±:',i),console.log('ğŸ¯ æ¸²æŸ“é€‰é¡¹ - æœ‰å¥–åŠ±æ ‡ç­¾:',l),console.log('ğŸ¯ æ¸²æŸ“é€‰é¡¹ - æœ‰é€šçŸ¥:',p),i)return console.log('ğŸ¯ æ¸²æŸ“é€‰é¡¹ - æ¸²æŸ“å¥–åŠ±å†…è”ï¼ˆæœ‰å¯é€‰å¥–åŠ±ï¼‰'),void w(n);if((l||p)&&(console.log('ğŸ¯ æ¸²æŸ“é€‰é¡¹ - æ¸²æŸ“å¥–åŠ±å†…è”ï¼ˆæœ‰å¥–åŠ±æ ‡ç­¾æˆ–é€šçŸ¥ï¼‰'),w(n)),'1'===n.getAttribute('data-options-rendered'))return;if(n.innerHTML='',!s.trim())return;const m=/<(Option|BattleOption)[^>]*>([\\s\\S]*?)<\\/\\1>/g;let f,h=!1;for(;null!==(f=m.exec(s));){h=!0;const t=f[1],e=f[2].trim();if(console.log('åŒ¹é…åˆ°é€‰é¡¹:',t,e),e){const s=document.createElement('button');'BattleOption'===t?(s.className='battle-option-btn',s.addEventListener('click',(()=>A(e))),console.log('åˆ›å»ºæˆ˜æ–—é€‰é¡¹æŒ‰é’®:',e,'className:',s.className)):(s.className='option-btn',s.addEventListener('click',(()=>k(e))),console.log('åˆ›å»ºæ™®é€šé€‰é¡¹æŒ‰é’®:',e,'className:',s.className)),s.textContent=e,n.appendChild(s),console.log('æŒ‰é’®å·²æ·»åŠ åˆ°DOMï¼Œæœ€ç»ˆclassName:',s.className)}}if(n.setAttribute('data-options-rendered','1'),!h){console.log('æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•é€‰é¡¹ï¼Œå°è¯•æŒ‰è¡Œè§£æ');s.split(/\\r?\\n/).map((t=>t.trim())).filter((t=>t&&!t.startsWith('<')&&!t.endsWith('>'))).forEach((t=>{const e=t.replace(/^\\d+[.ã€)]?\\s*/,'').trim();if(e){const t=document.createElement('button'),s=/[\\u2694\\u26A1]|æˆ˜æ–—|æ”»å‡»|è¿å‡»|å†²å‡»/u.test(e),o=async()=>{if(!a){a=!0,t.disabled=!0,t.classList.add('disabled');try{s?await A(e):await k(e)}catch(e){console.error('é€‰é¡¹å‘é€å¤±è´¥:',e),a=!1,t.disabled=!1,t.classList.remove('disabled'),'undefined'!=typeof toastr&&toastr.error('å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•')}}};s?(t.className='battle-option-btn',t.addEventListener('click',o),console.log('æŒ‰æ–‡æœ¬è¯†åˆ«åˆ›å»ºæˆ˜æ–—é€‰é¡¹:',e)):(t.className='option-btn',t.addEventListener('click',o),console.log('æŒ‰æ–‡æœ¬è¯†åˆ«åˆ›å»ºæ™®é€šé€‰é¡¹:',e)),t.textContent=e,n.appendChild(t)}}))}}async function A(t){console.log('ğŸ”¥ æˆ˜æ–—é€‰é¡¹è¢«ç‚¹å‡»:',t);try{const e=`ç”¨æˆ·é€‰æ‹©äº†æˆ˜æ–—é€‰é¡¹ï¼š${t}${n?`\\n\\n${n}`:''}\\n\\n[å¼€å§‹æˆ˜æ–—]`;await triggerSlash(`/send ${e}`),await triggerSlash('/trigger'),console.log('âœ… æˆ˜æ–—è§¦å‘æ¶ˆæ¯å·²å‘é€ï¼Œç­‰å¾…AIç”Ÿæˆæˆ˜æ–—å†…å®¹')}catch(t){console.error('âŒ è§¦å‘æˆ˜æ–—å¤±è´¥:',t),alert('è§¦å‘æˆ˜æ–—å¤±è´¥ï¼Œè¯·é‡è¯•')}finally{n=null}}async function k(t){console.log('ğŸ¯ æ™®é€šé€‰é¡¹è¢«ç‚¹å‡»:',t);try{const e=`ç”¨æˆ·çš„é€‰æ‹©æ˜¯ï¼š${t}${n?`\\n\\n${n}`:''}`;await triggerSlash(`/send ${e}`),await triggerSlash('/trigger')}catch(t){console.error('å‘é€é€‰é¡¹å¤±è´¥',t),alert('å‘é€é€‰é¡¹å¤±è´¥ï¼Œè¯·é‡è¯•')}finally{n=null}}window.refreshData=async function(){console.log('åˆ·æ–°æ¸¸æˆæ•°æ®'),await I()},window.removeCard=async function(t){try{if(!t)return void console.warn('æ— æ•ˆçš„å¡ç‰ŒID');await updateVariablesWith((e=>{const n=e?.stat_data?.battle||e?.battle;if(!n)throw new Error('æœªæ‰¾åˆ° battle å˜é‡');const s=e=>{let n=0;return{processed:(e||[]).map((e=>{if(e&&e.id===t){const t=Number(e.quantity)||1;return t>1?(n++,{...e,quantity:t-1}):(n++,null)}return e})).filter((t=>null!==t)),removed:n}};let a=0;if(Array.isArray(n.cards))if(n.cards.length>=2&&Array.isArray(n.cards[0])&&'string'==typeof n.cards[1]){const t=s(n.cards[0]);n.cards[0]=t.processed,a+=t.removed}else if(n.cards.length>=1&&Array.isArray(n.cards[0])){const t=s(n.cards[0]);n.cards[0]=t.processed,a+=t.removed}else{const t=s(n.cards);n.cards=t.processed,a+=t.removed}n.core||(n.core={});const o=Number(n.core.card_removal_count)||0;return a>0&&(n.core.card_removal_count=Math.max(0,o-1)),e}),{type:'message'}),'undefined'!=typeof toastr&&toastr.success('å·²åˆ é™¤æ‰€é€‰å¡ç‰Œ');try{await I()}catch(t){console.warn('åˆ·æ–°æ•°æ®å¤±è´¥:',t)}}catch(t){console.error('åˆ é™¤å¡ç‰Œå¤±è´¥:',t),'undefined'!=typeof toastr&&toastr.error('åˆ é™¤å¡ç‰Œå¤±è´¥ï¼Œè¯·é‡è¯•')}},window.toggleBattleBook=function(){const t=document.getElementById('battle-book-content'),e=document.querySelector('.battle-book-btn');t&&e&&('none'===t.style.display?(t.style.display='block',e.textContent='ğŸ“– éšè—çŠ¶æ€æ•ˆæœ',function(){const t=document.getElementById('battle-book-content');if(!t)return;const e=window.battleBookData;if(!e)return void(t.innerHTML='<div class=\"value\">æ— æˆ˜æ–—æ•°æ®</div>');const n=x(e.playerStatusEffects),s=x(e.statuses);let a='';n.length>0&&(a+='<div class=\"battle-book-section\"><h4>ğŸ”¥ å½“å‰çŠ¶æ€æ•ˆæœ</h4>',n.forEach((t=>{a+=`\\n        <div class=\"status-effect-item\">\\n          <div class=\"status-header\">\\n            <span class=\"status-icon\">${t.emoji||'âœ¨'}</span>\\n            <span class=\"status-name\">${t.name}</span>\\n            <span class=\"status-stacks\">${t.stacks||1}</span>\\n            ${t.duration?`<span class=\"status-duration\">(${t.duration}å›åˆ)</span>`:''}\\n          </div>\\n          <div class=\"status-description\">${t.description||'æ— æè¿°'}</div>\\n        </div>\\n      `})),a+='</div>');s.length>0&&(a+='<div class=\"battle-book-section\"><h4>ğŸ“š çŠ¶æ€æ•ˆæœå›¾é‰´</h4>',s.forEach((t=>{a+=`\\n        <div class=\"status-effect-item\">\\n          <div class=\"status-header\">\\n            <span class=\"status-icon\">${t.emoji||'âœ¨'}</span>\\n            <span class=\"status-name\">${t.name}</span>\\n            <span class=\"status-type ${t.type}\">${'buff'===t.type?'BUFF':'DEBUFF'}</span>\\n          </div>\\n          <div class=\"status-description\">${t.description||'æ— æè¿°'}</div>\\n          ${t.triggers?`<div class=\"status-triggers\">è§¦å‘: ${JSON.stringify(t.triggers)}</div>`:''}\\n        </div>\\n      `})),a+='</div>');''===a&&(a='<div class=\"value\">æš‚æ— çŠ¶æ€æ•ˆæœæ•°æ®</div>');t.innerHTML=a}()):(t.style.display='none',e.textContent='ğŸ“– æŸ¥çœ‹çŠ¶æ€æ•ˆæœ'))},window.toggleNPCTracking=async function(t,e){console.warn('[åªè¯»æ¨¡å¼] common é¡µé¢ä¸ä¿®æ”¹ NPC è¿½è¸ªçŠ¶æ€ã€‚')},window.gainExperience=async function(t=160){console.warn('[åªè¯»æ¨¡å¼] common é¡µé¢ä¸åœ¨æ­¤å¤„ç›´æ¥å†™å…¥ç»éªŒã€‚')},window.toggleDeleteMode=function(){const t=document.getElementById('battle-deck'),e=document.getElementById('delete-mode-toggle');if(!t||!e)return;const n=window.getVariables?.({type:'message'})||{},s=n?.stat_data?.battle||n?.battle;if((Number(s?.core?.card_removal_count)||0)<=0)return void('undefined'!=typeof toastr&&toastr.warning('åˆ å¡æ¬¡æ•°ä¸è¶³ï¼Œæ— æ³•è¿›å…¥åˆ é™¤æ¨¡å¼'));if(t.classList.contains('delete-mode')){t.classList.remove('delete-mode'),e.style.backgroundColor='#ff6b6b';t.querySelectorAll('.card-delete-btn').forEach((t=>{t.style.display='none'}))}else{t.classList.add('delete-mode'),e.style.backgroundColor='#51cf66';t.querySelectorAll('.card-delete-btn').forEach((t=>{t.style.display='block'}))}},window.debugData=function(){try{const t=getVariables({type:'message'});if(console.log('=== å®Œæ•´æ•°æ®ç»“æ„ ==='),console.log(t),t?.stat_data){if(console.log('=== stat_data ç»“æ„ ==='),console.log(t.stat_data),t.stat_data.status){console.log('=== çŠ¶æ€æ•°æ®è¯¦ç»†åˆ†æ ===');const e=t.stat_data.status;Object.keys(e).forEach((t=>{const n=e[t];console.log(`${t}:`,{type:typeof n,isArray:Array.isArray(n),value:n,length:Array.isArray(n)?n.length:'N/A'})})),console.log('=== é‡ç‚¹æ£€æŸ¥æ•°ç»„å­—æ®µ ==='),console.log('æŒæœ‰ç‰©:',e.inventory),console.log('æ°¸ä¹…æ€§çŠ¶æ€:',e.permanent_status),console.log('ä¸´æ—¶çŠ¶æ€:',e.temporary_status)}t.stat_data.battle&&(console.log('=== æˆ˜æ–—æ•°æ® ==='),console.log('battle.items:',t.stat_data.battle.items),console.log('battle.artifacts:',t.stat_data.battle.artifacts)),t.stat_data.npcs&&(console.log('=== NPCæ•°æ® ==='),console.log('npcs:',t.stat_data.npcs))}alert('æ•°æ®ç»“æ„å·²è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œè¯·æŸ¥çœ‹')}catch(t){console.error('è°ƒè¯•å¤±è´¥:',t),alert('è°ƒè¯•å¤±è´¥: '+(t?.message||'æœªçŸ¥é”™è¯¯'))}},window.testVariableOperations=async function(){console.warn('[åªè¯»æ¨¡å¼] å·²ç¦ç”¨æœ¬é¡µé¢çš„æµ‹è¯•å˜é‡å†™å…¥æ“ä½œã€‚')},window.switchToStory=function(){const t=document.querySelector('.tab-button[data-module=\"story\"]');t&&t.click()},'undefined'!=typeof window&&document.addEventListener('DOMContentLoaded',(async()=>{console.log('RPG UI é™æ€æ¨¡æ¿å·²åŠ è½½ - ä½¿ç”¨é…’é¦†å˜é‡å®ç³»ç»Ÿ'),console.log('åˆå§‹åŒ–RPG UIç•Œé¢'),B(),function(){const t=document.querySelectorAll('.tab-button'),e=document.querySelectorAll('.module-content');t.forEach((n=>{n.addEventListener('click',(function(){const n=this.getAttribute('data-module');t.forEach((t=>t.classList.remove('active'))),e.forEach((t=>t.style.display='none')),this.classList.add('active');const s=document.getElementById(n+'-content');s&&(s.style.display='block')}))}))}(),await I(),console.log('âœ… Commonæ¨¡å—å®Œå…¨åˆå§‹åŒ–å®Œæˆ')}));</script></body></html>\n```",
    "trimStrings": [],
    "placement": [
        2
    ],
    "disabled": false,
    "markdownOnly": true,
    "promptOnly": false,
    "runOnEdit": false,
    "substituteRegex": 0,
    "minDepth": null,
    "maxDepth": 5
}