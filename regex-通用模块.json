{
    "id": "8aca2252-fa6a-4ed1-8d09-9f00a1ebdfa9",
    "scriptName": "通用模块",
    "findRegex": "/<Story>([\\s\\S]*?)<\\/Story>[\\s\\S]*?<Options>([\\s\\S]*?)<\\/Options>/gm",
    "replaceString": "```\n<!doctype html><html lang=\"zh-CN\"><head><meta charset=\"UTF-8\"/><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/><title>魔法少女RPG</title><style>@import url(https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Noto+Sans+SC:wght@300;400;500&display=swap);\n/*! tailwindcss v4.1.12 | MIT License | https://tailwindcss.com */:root{--notebook-bg:#fffaf7;--notebook-border:#f2e4d5;--text-primary:#6d5b5b;--text-secondary:#b19d9d;--bookmark-pink:#ffd9e2;--bookmark-blue:#d4eaff;--bookmark-green:#d8f5d8;--bookmark-purple:#e9e0ff;--bookmark-yellow:#fff9c4;--bookmark-active-shadow:0 4px 12px rgba(136,98,98,0.15);--transition:all 0.35s cubic-bezier(0.4,0,0.2,1)}*{box-sizing:border-box;margin:0;padding:0}body{font-family:\"Noto Sans SC\",sans-serif;line-height:1.7;color:var(--text-primary);background-color:#f8f3ed;background-image:url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e8e0d4' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");overflow-x:hidden;min-height:100vh;padding:20px}.rpg-container{max-width:900px;margin:2rem auto;position:relative;font-family:\"Microsoft YaHei\",\"Segoe UI\",\"Helvetica Neue\",sans-serif}.rpg-container .notebook-body{background:var(--notebook-bg);border:1px solid var(--notebook-border);border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,.15);padding:2rem;padding-top:5rem;position:relative}.reward-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.3);z-index:1000;display:flex;align-items:flex-start;justify-content:center;padding:20px}.reward-card{background:var(--notebook-bg);border:2px solid var(--notebook-border);border-radius:8px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.08);width:100%;max-width:100%}.reward-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}.reward-header .title{font:800 18px \"ZCOOL KuaiLe\",\"Noto Sans SC\",system-ui;color:var(--text-primary)}.reward-header .badge{margin-left:auto;padding:4px 10px;border-radius:10px;border:2px solid var(--notebook-border);background:var(--bookmark-yellow);color:var(--text-primary);font:900 12px \"ZCOOL KuaiLe\",\"Noto Sans SC\"}.reward-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px;margin-bottom:12px;width:100%}.pane{border-radius:8px;padding:10px;background:#fff;border:2px dashed #d9c7aa}.pane.pane-change{background:#fffef6;grid-column:1/-1}.pane.pane-exp{background:#f0f8ff;border-color:skyblue;grid-column:1/-1}.pane.pane-card{border-color:#ffc1d6}.pane.pane-artifact{border-color:#b9d6ff}.pane.pane-item{border-color:#bfe7bf}.pane-tag{display:inline-block;padding:2px 10px;border-radius:8px;border:2px solid #d9c7aa;background:#fff;color:#6b5b2e;font:800 12px \"ZCOOL KuaiLe\",\"Noto Sans SC\"}.change-list{margin-top:8px;display:flex;flex-wrap:wrap;gap:8px;color:#6b5b2e;font:500 13px \"Noto Sans SC\"}.pill{padding:6px 10px;border-radius:8px;background:#fffef6;border:2px dashed #d9c7aa}.exp-display{margin-top:8px;display:flex;flex-direction:column;gap:8px;color:#2c5aa0;font:500 13px \"Noto Sans SC\"}.exp-item{padding:8px 12px;border-radius:8px;background:#e6f3ff;border:2px solid skyblue;display:flex;align-items:center;gap:8px}.exp-icon{font-size:16px}.exp-text{flex:1;font-weight:600}.pane-head{display:flex;align-items:center;margin-bottom:8px}.pane-title{font:800 14px \"ZCOOL KuaiLe\",\"Noto Sans SC\";color:var(--text-primary)}.pane-sub{margin-left:auto;color:var(--text-secondary);font:700 12px \"Noto Sans SC\"}.option{margin-top:8px;display:flex;gap:10px;align-items:center;padding:8px;border-radius:8px;background:#fffef6;border:2px dashed currentColor;cursor:pointer}.pane-card .option{color:#a66a79;background:#fffef9;border-color:#ffc1d6}.pane-artifact .option{color:#5c6b82;background:#f8fbff;border-color:#b9d6ff}.pane-item .option{color:#5b7a5b;background:#f7fff7;border-color:#bfe7bf}.option .icon{font-size:18px}.option .text{flex:1;min-width:0}.option .name{font:800 13px \"ZCOOL KuaiLe\",\"Noto Sans SC\";color:var(--text-primary);word-break:break-word}.option .desc{font:700 12px \"Noto Sans SC\";color:var(--text-secondary);word-break:break-word}.reward-actions{display:flex;gap:8px;justify-content:flex-end}.btn{padding:8px 12px;border-radius:8px;font:800 12px \"ZCOOL KuaiLe\",\"Noto Sans SC\";border:2px solid var(--notebook-border);background:#fff;color:var(--text-primary);cursor:pointer;transition:var(--transition)}.btn.btn-primary{border:0;color:#634d4d;background:linear-gradient(180deg,var(--bookmark-yellow),#ffd9e2);box-shadow:0 8px 16px rgba(136,98,98,.12),inset 0 0 0 2px var(--notebook-border)}.btn.btn-primary:disabled{opacity:.5;cursor:not-allowed}.btn:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 8px rgba(0,0,0,.1)}.tab-navigation{position:absolute;top:1.5rem;left:2rem;right:2rem;display:flex;justify-content:flex-start;align-items:flex-end;z-index:10;height:50px}.tab-navigation .tab-button{background:var(--bookmark-pink);border:1px solid var(--notebook-border);border-bottom:none;border-radius:12px 12px 4px 4px;padding:.8rem 1.3rem;cursor:pointer;color:var(--text-primary);font-family:\"ZCOOL KuaiLe\",cursive;font-size:1.1rem;margin-right:5px;transition:var(--transition);box-shadow:0 -1px 4px rgba(0,0,0,.04) inset;position:relative;transform-origin:bottom center}.tab-navigation .tab-button:nth-child(1){transform:rotate(-2deg)}.tab-navigation .tab-button:nth-child(2){background-color:var(--bookmark-blue);transform:rotate(1.5deg)}.tab-navigation .tab-button:nth-child(3){background-color:var(--bookmark-green);transform:rotate(-1deg)}.tab-navigation .tab-button:nth-child(4){background-color:var(--bookmark-purple);transform:rotate(2.5deg)}.tab-navigation .tab-button:nth-child(5){background-color:var(--bookmark-yellow);transform:rotate(-1.5deg)}.tab-navigation .tab-button:hover{transform:translateY(-5px) rotate(0)}.tab-navigation .tab-button.active{transform:translateY(-10px) rotate(0);box-shadow:var(--bookmark-active-shadow);z-index:5}.tab-navigation .tab-button.active::after{content:\"\";position:absolute;top:5px;right:5px;width:14px;height:14px;background:radial-gradient(circle,#ff8a8a 0%,#e53935 100%);border:1px solid rgba(0,0,0,.2);border-radius:50%;box-shadow:1px 1px 3px rgba(0,0,0,.2)}.tab-navigation .tab-button .tab-icon{margin-right:.5rem}.tab-navigation .tab-button:nth-child(2).active::after{background:radial-gradient(circle,#8dc8ff 0%,#3a8ee5 100%)}.tab-navigation .tab-button:nth-child(3).active::after{background:radial-gradient(circle,#83e083 0%,#36a536 100%)}.tab-navigation .tab-button:nth-child(4).active::after{background:radial-gradient(circle,#c0a8ff 0%,#8b6ce5 100%)}.tab-navigation .tab-button:nth-child(5).active::after{background:radial-gradient(circle,#ffe68a 0%,#e5b839 100%)}.tab-content .module-content{display:none;animation:fadeIn .5s ease-in-out}.tab-content .module-content[style*=\"display: block\"]{display:block !important}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.section{margin-bottom:2.5rem}.section:last-child{margin-bottom:0}.section-title{font-size:2rem;font-weight:normal;font-family:\"ZCOOL KuaiLe\",cursive;color:var(--text-primary);margin-bottom:1.5rem;padding-bottom:.75rem;border-bottom:3px dotted var(--notebook-border)}.story-text{font-family:\"Noto Sans SC\",sans-serif;font-size:1.15rem;line-height:1.8;color:var(--text-primary);margin-bottom:1.5rem;white-space:pre-wrap}.story-text p{margin-bottom:1rem}.story-text p:last-child{margin-bottom:0}.story-text strong{color:#8b4c98;font-weight:500}.story-text em{color:var(--text-secondary);font-style:italic}.story-options{display:flex;flex-direction:column;gap:.75rem;margin-top:1rem}.story-options p{margin-bottom:.5rem;font-family:\"ZCOOL KuaiLe\",cursive;font-size:1.2rem;color:var(--text-primary)}.story-options ol{padding-left:0;list-style:none}.story-options ol li{background:hsla(0,0%,100%,.5);border:1px solid var(--notebook-border);border-radius:8px;padding:1rem;margin-bottom:.5rem;position:relative;font-family:\"ZCOOL KuaiLe\",cursive;font-size:1.1rem;line-height:1.6;transition:var(--transition)}.story-options ol li:hover{background:rgba(214,182,182,.15);transform:translateX(5px)}.story-options ol li::before{content:counter(list-item) \"️⃣\";counter-increment:list-item;position:absolute;left:-2rem;top:50%;transform:translateY(-50%);font-size:1.2rem}.data-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;margin-bottom:1.5rem}.info-card{border:none;border-radius:8px;padding:1.25rem;background:hsla(0,0%,100%,.6);box-shadow:0 4px 15px rgba(136,98,98,.08);transition:var(--transition)}.info-card:hover{box-shadow:0 6px 20px rgba(136,98,98,.12);transform:translateY(-2px)}.info-card .card-title{font-weight:normal;font-family:\"ZCOOL KuaiLe\",cursive;font-size:1.4rem;margin-bottom:.75rem;color:#8b4c98;border-bottom:2px dotted var(--notebook-border);padding-bottom:.5rem}.info-card .info-item{display:flex;justify-content:space-between;align-items:flex-start;padding:.6rem 0;border-top:1px dashed var(--notebook-border);font-family:\"ZCOOL KuaiLe\",cursive;font-size:1rem}.info-card .info-item:first-of-type{border-top:none}.info-card .info-item .label{color:var(--text-secondary);font-weight:400;white-space:nowrap;margin-right:1rem}.info-card .info-item .value{font-weight:500;color:var(--text-primary);text-align:right;word-break:break-word;line-height:1.4}.battle-deck{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1rem}.card,.battle-card-item{border:1px solid var(--notebook-border);padding:1rem;border-radius:8px;text-align:center;background:#fff;font-family:\"ZCOOL KuaiLe\",cursive;font-size:1rem;transition:var(--transition);box-shadow:0 2px 8px rgba(0,0,0,.05)}.card:hover,.battle-card-item:hover{transform:translateY(-3px);box-shadow:0 4px 12px rgba(0,0,0,.1)}.card .card-name,.battle-card-item .card-name{font-weight:600;font-size:1.1rem;margin-bottom:.5rem;color:#8b4c98}.card .card-name .card-quantity,.battle-card-item .card-name .card-quantity{color:var(--text-secondary);font-size:.9rem;margin-left:.5rem}.card .card-cost,.battle-card-item .card-cost{color:var(--bookmark-blue);margin-bottom:.5rem;font-weight:500}.card .card-description,.battle-card-item .card-description{color:var(--text-secondary);font-size:.9rem;line-height:1.4}.delete-control-card{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:120px;background:linear-gradient(135deg,#ffebee,#fce4ec);border:2px dashed #f44}.delete-control-card .delete-mode-btn{background:#f44;color:#fff;border:none;width:50px;height:50px;border-radius:50%;font-size:1.5rem;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 6px rgba(0,0,0,.2);margin-bottom:.5rem}.delete-control-card .delete-mode-btn:hover{background:#f66;transform:scale(1.1);box-shadow:0 4px 10px rgba(0,0,0,.3)}.delete-control-card .delete-mode-btn.delete-mode-active{background:#c33;animation:pulse 1.5s infinite}.delete-control-card .delete-mode-btn.delete-mode-active:hover{background:#d44}.delete-control-card .delete-count{font-size:.8rem;color:#666;text-align:center}@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}.card,.battle-card-item{position:relative}.card .card-delete-overlay,.battle-card-item .card-delete-overlay{position:absolute;top:-5px;right:-5px;width:30px;height:30px;background:#f44;border:2px solid #fff;border-radius:50%;display:none;align-items:center;justify-content:center;cursor:pointer;z-index:10;transition:all .2s ease;box-shadow:0 2px 6px rgba(0,0,0,.3)}.card .card-delete-overlay .delete-icon,.battle-card-item .card-delete-overlay .delete-icon{font-size:.8rem;color:#fff}.card .card-delete-overlay:hover,.battle-card-item .card-delete-overlay:hover{background:#f66;transform:scale(1.1);box-shadow:0 3px 8px rgba(0,0,0,.4)}.battle-deck.delete-mode .card .card-delete-overlay,.battle-deck.delete-mode .battle-card-item .card-delete-overlay{display:flex}.battle-deck.delete-mode .card:hover,.battle-deck.delete-mode .battle-card-item:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(255,68,68,.3)}.item-use-btn{background:#4a4;color:#fff;border:2px solid #393;padding:.4rem .8rem;border-radius:6px;font-size:.85rem;font-weight:600;cursor:pointer;margin-top:.5rem;transition:all .2s ease;box-shadow:0 2px 4px rgba(0,0,0,.1)}.item-use-btn:hover{background:#6c6;border-color:#4a4;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.2)}.item-use-btn:active{transform:translateY(0);box-shadow:0 2px 4px rgba(0,0,0,.1)}.tracking-btn{border:2px solid;padding:.3rem .6rem;border-radius:6px;font-size:.8rem;font-weight:600;cursor:pointer;margin-left:.5rem;transition:all .2s ease;box-shadow:0 2px 4px rgba(0,0,0,.1)}.tracking-btn.tracking-on{background:#f44;color:#fff;border-color:#c33}.tracking-btn.tracking-on:hover{background:#f66;border-color:#f44;transform:translateY(-1px);box-shadow:0 3px 6px rgba(0,0,0,.15)}.tracking-btn.tracking-off{background:#4a4;color:#fff;border-color:#393}.tracking-btn.tracking-off:hover{background:#6c6;border-color:#4a4;transform:translateY(-1px);box-shadow:0 3px 6px rgba(0,0,0,.15)}.tracking-btn:active{transform:translateY(0);box-shadow:0 2px 4px rgba(0,0,0,.1)}.debug-panel{margin-top:2rem;padding:1.25rem;background:rgba(0,0,0,0);border:2px dashed var(--notebook-border);border-radius:8px}.debug-panel h4{text-align:center;margin-bottom:1rem;color:var(--text-secondary);font-size:1.1rem;font-family:\"ZCOOL KuaiLe\",cursive}.debug-panel .debug-buttons{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:.75rem}.debug-panel .debug-buttons .debug-btn{background:rgba(0,0,0,.03);border:1px solid var(--notebook-border);color:var(--text-secondary);padding:.75rem 1rem;border-radius:6px;cursor:pointer;font-family:\"ZCOOL KuaiLe\",cursive;font-size:1rem;transition:var(--transition)}.debug-panel .debug-buttons .debug-btn:hover{background:rgba(0,0,0,.06);color:var(--text-primary);transform:translateY(-1px)}.debug-panel .debug-buttons .debug-btn:active{transform:translateY(0)}@media (max-width:768px){body{background-image:none;padding:10px}.rpg-container{margin:0;width:100%;min-height:100vh;display:flex;flex-direction:column}.rpg-container .notebook-body{border-radius:0;box-shadow:none;flex-grow:1;overflow-y:auto;padding:1rem;padding-top:4.5rem}.rpg-container .debug-panel{flex-shrink:0;border-radius:0;margin-top:0;border-top:2px dashed var(--notebook-border)}.tab-navigation{left:1rem;right:1rem;height:40px}.tab-navigation .tab-button{padding:.6rem .8rem;font-size:1rem;transform:rotate(0) !important;margin-right:-5px}.tab-navigation .tab-button.active{transform:translateY(-5px) !important}.tab-navigation .tab-button.active::after{width:10px;height:10px;top:4px;right:4px}.tab-navigation .tab-button .tab-label{display:none}.section-title{font-size:1.6rem}.data-grid{grid-template-columns:1fr;gap:1rem}.story-text{font-size:1.1rem}.story-options ol li{font-size:1rem;padding:.8rem}.story-options ol li::before{left:-1.5rem;font-size:1rem}}.rpg-container::before{content:\"\";position:absolute;top:0;left:0;right:0;bottom:0;background:repeating-linear-gradient(0deg,transparent,transparent 24px,rgba(0,0,0,0.02) 25px);pointer-events:none;border-radius:8px}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:var(--notebook-bg)}::-webkit-scrollbar-thumb{background:var(--notebook-border);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:var(--text-secondary)}.option-btn{display:inline-block;margin:.3rem .4rem .3rem 0;padding:.5rem 1rem;border:1px solid var(--notebook-border);border-radius:6px;background:var(--bookmark-blue);font-family:\"ZCOOL KuaiLe\",cursive;cursor:pointer;transition:var(--transition)}.option-btn:hover{background:var(--bookmark-purple);transform:translateY(-2px)}.alignment-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-top:1rem}.alignment-cell{border:1px solid var(--notebook-border);padding:.5rem;text-align:center;font-size:.9rem;background:#fdf9f2;border-radius:4px;transition:var(--transition)}.alignment-cell.active{background:var(--bookmark-green);font-weight:bold;box-shadow:0 0 6px rgba(0,0,0,.15)}.faction-status{padding:.2rem .5rem;border-radius:4px;font-size:.9rem;font-weight:500}.faction-status.友好,.faction-status.friendly{background:var(--bookmark-green);color:#2e7d32}.faction-status.敌对,.faction-status.hostile{background:#ffebee;color:#c62828}.faction-status.中立,.faction-status.neutral{background:var(--bookmark-yellow);color:#f57c00}.faction-status.警惕,.faction-status.cautious{background:#fff3e0;color:#ef6c00}.faction-status.亦敌亦友,.faction-status.complicated{background:var(--bookmark-purple);color:#6a1b9a}.delete-toggle-btn{background:#ff6b6b;color:#fff;border:none;border-radius:6px;padding:4px 8px;margin-left:10px;cursor:pointer;font-size:14px;transition:var(--transition)}.delete-toggle-btn:hover{background:#ff5252;transform:scale(1.05)}.card,.battle-card-item{position:relative}.card .card-delete-btn,.battle-card-item .card-delete-btn{position:absolute;top:5px;right:5px;background:#ff6b6b;color:#fff;border:none;border-radius:50%;width:24px;height:24px;cursor:pointer;font-size:12px;display:none;align-items:center;justify-content:center;transition:var(--transition)}.card .card-delete-btn:hover,.battle-card-item .card-delete-btn:hover{background:#ff5252;transform:scale(1.1)}.battle-deck.delete-mode .card,.battle-deck.delete-mode .battle-card-item{border:2px dashed #ff6b6b;background:rgba(255,107,107,.05)}.exp-test-btn{background:linear-gradient(135deg,#4caf50,#45a049);color:#fff;border:none;border-radius:8px;padding:8px 16px;cursor:pointer;font-size:14px;font-weight:500;transition:var(--transition);box-shadow:0 2px 4px rgba(76,175,80,.3)}.exp-test-btn:hover{background:linear-gradient(135deg,#45a049,#3d8b40);transform:translateY(-2px);box-shadow:0 4px 8px rgba(76,175,80,.4)}.exp-test-btn:active{transform:translateY(0);box-shadow:0 2px 4px rgba(76,175,80,.3)}.battle-option-btn{display:inline-block;margin:.3rem .4rem .3rem 0;padding:.5rem 1rem;border:1px solid var(--notebook-border);border-radius:6px;font-family:\"ZCOOL KuaiLe\",cursive;cursor:pointer;transition:var(--transition);background:#f44336;color:#fff}.battle-option-btn:hover{background:#d32f2f;transform:translateY(-2px)}.battle-book-container{display:flex;flex-direction:column;gap:12px}.battle-book-btn{background:linear-gradient(180deg,var(--bookmark-yellow),var(--bookmark-pink));color:var(--text-primary);border:2px solid var(--notebook-border);padding:12px 16px;border-radius:8px;font-size:14px;font-weight:800;cursor:pointer;transition:var(--transition);box-shadow:0 6px 14px rgba(136,98,98,.12)}.battle-book-btn:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(136,98,98,.16)}.battle-book-btn:active{transform:translateY(0)}.battle-book-content{background:hsla(0,0%,100%,.65);border-radius:8px;padding:16px;border:2px dashed var(--notebook-border);max-height:400px;overflow-y:auto;color:var(--text-primary)}.battle-book-section{margin-bottom:20px}.battle-book-section h4{color:var(--text-primary);font-size:16px;font-weight:800;margin-bottom:12px;padding-bottom:6px;border-bottom:2px dotted var(--notebook-border)}.status-effect-item{background:#fffef6;border-radius:6px;padding:12px;margin-bottom:8px;border:2px dashed var(--notebook-border)}.status-effect-item .status-header{display:flex;align-items:center;gap:8px;margin-bottom:6px}.status-effect-item .status-header .status-icon{font-size:18px;min-width:24px;text-align:center}.status-effect-item .status-header .status-name{font-weight:800;color:var(--text-primary);font-size:14px}.status-effect-item .status-header .status-stacks{background:var(--bookmark-blue);color:var(--text-primary);padding:2px 8px;border-radius:4px;font-size:12px;font-weight:800;border:1px solid var(--notebook-border)}.status-effect-item .status-header .status-duration{color:var(--text-secondary);font-size:12px}.status-effect-item .status-header .status-type{padding:2px 6px;border-radius:4px;font-size:10px;font-weight:700;border:1px dashed var(--notebook-border);background:var(--bookmark-yellow);color:var(--text-primary)}.status-effect-item .status-header .status-type.buff{background:var(--bookmark-green);color:#2e7d32}.status-effect-item .status-header .status-type.debuff{background:#ffebee;color:#c62828}.status-effect-item .status-description{color:var(--text-primary);font-size:13px;line-height:1.4;margin-bottom:4px}.status-effect-item .status-triggers{color:var(--text-secondary);font-size:11px;font-family:monospace;background:rgba(0,0,0,.04);padding:4px 6px;border-radius:4px;margin-top:6px;border:1px dashed var(--notebook-border)}\n</style></head><body><div class=\"rpg-container\"><nav class=\"tab-navigation\"><button class=\"tab-button active\" data-module=\"story\"><span class=\"tab-icon\">📖</span> 剧情</button> <button class=\"tab-button\" data-module=\"status\"><span class=\"tab-icon\">✨</span> 状态栏</button> <button class=\"tab-button\" data-module=\"battle\"><span class=\"tab-icon\">⚔️</span> 战斗</button> <button class=\"tab-button\" data-module=\"npc\"><span class=\"tab-icon\">👭</span> NPC关系</button> <button class=\"tab-button\" data-module=\"faction\"><span class=\"tab-icon\">🏰</span> 势力关系</button></nav><div class=\"notebook-body\"><div class=\"tab-content\"><div id=\"story-content\" class=\"module-content\" style=\"display:block\"><div class=\"section\"><h2 class=\"section-title\">📖 当前剧情</h2><div class=\"story-text\">$1</div></div><div class=\"section\" id=\"notify-section\" style=\"display:none\"><div class=\"reward-card\" id=\"notify-card\"><div class=\"reward-header\"><strong class=\"title\">状态更新</strong> <span class=\"badge\" id=\"level-exp-badge\" style=\"display:none\"></span></div><div class=\"reward-grid\"><section class=\"pane pane-change\" id=\"changes-section\" style=\"display:none\"><span class=\"pane-tag\">本次变化</span><div class=\"change-list\" id=\"changes-list\"></div></section><section class=\"pane pane-exp\" id=\"exp-section\" style=\"display:none\"><span class=\"pane-tag\">等级与经验</span><div class=\"exp-display\" id=\"exp-display\"></div></section></div><div class=\"reward-actions\"><button class=\"btn btn-plain\" id=\"notify-dismiss-btn\">知道了</button></div></div></div><div class=\"section\"><h2 class=\"section-title\">🎯 选项</h2><div class=\"options-text\">$2</div><div class=\"custom-action\" style=\"margin-top:10px;display:flex;gap:8px;align-items:center\"><input id=\"custom-action-input\" placeholder=\"输入你的自定义行动...\" style=\"flex:1;padding:8px 10px;border:1px solid var(--notebook-border);border-radius:6px;background:#fffef6;color:var(--text-primary)\"/> <button id=\"custom-action-send\" class=\"option-btn\" type=\"button\">发送</button></div><div id=\"choice-container\" style=\"display:none;margin-top:12px\"><div class=\"reward-card\" id=\"choice-card\"><div class=\"reward-header\"><strong class=\"title\">奖励结算</strong></div><div class=\"reward-grid\"><section class=\"pane pane-card\" id=\"card-rewards-section\" style=\"display:none\"><div class=\"pane-head\"><div class=\"pane-title\">可选：卡牌 <span id=\"card-selection-count\">3选1</span></div><div class=\"pane-sub\">已选 <span id=\"card-selected\">0</span>/<span id=\"card-max\">1</span></div></div><div class=\"options\" id=\"card-options\"></div></section><section class=\"pane pane-artifact\" id=\"artifact-rewards-section\" style=\"display:none\"><div class=\"pane-head\"><div class=\"pane-title\">可选：遗物 <span id=\"artifact-selection-count\">3选1</span></div><div class=\"pane-sub\">已选 <span id=\"artifact-selected\">0</span>/<span id=\"artifact-max\">1</span></div></div><div class=\"options\" id=\"artifact-options\"></div></section><section class=\"pane pane-item\" id=\"item-rewards-section\" style=\"display:none\"><div class=\"pane-head\"><div class=\"pane-title\">可选：道具 <span id=\"item-selection-count\">3选1</span></div><div class=\"pane-sub\">已选 <span id=\"item-selected\">0</span>/<span id=\"item-max\">1</span></div></div><div class=\"options\" id=\"item-options\"></div></section></div><div class=\"reward-actions\"><button class=\"btn btn-primary\" id=\"confirm-btn\" disabled=\"disabled\">确认领取</button></div></div></div></div></div><div id=\"status-content\" class=\"module-content\"><div class=\"section\"><h2 class=\"section-title\">✨ 角色状态</h2><div class=\"data-grid\"><div class=\"info-card\"><h3>基本信息</h3><div class=\"info-item\"><span class=\"label\">时间:</span> <span class=\"value\" id=\"status-time\">未知</span></div><div class=\"info-item\"><span class=\"label\">地点天气:</span> <span class=\"value\" id=\"status-location\">未知</span></div><div class=\"info-item\"><span class=\"label\">称号:</span> <span class=\"value\" id=\"status-title\">未知</span></div><div class=\"info-item\"><span class=\"label\">职业:</span> <span class=\"value\" id=\"status-job\">未知</span></div></div><div class=\"info-card\"><h3>服装信息</h3><div class=\"info-item\"><span class=\"label\">头部:</span> <span class=\"value\" id=\"clothing-head\">未知</span></div><div class=\"info-item\"><span class=\"label\">颈部:</span> <span class=\"value\" id=\"clothing-neck\">未知</span></div><div class=\"info-item\"><span class=\"label\">手:</span> <span class=\"value\" id=\"clothing-hands\">未知</span></div><div class=\"info-item\"><span class=\"label\">上衣:</span> <span class=\"value\" id=\"clothing-top\">未知</span></div><div class=\"info-item\"><span class=\"label\">下衣:</span> <span class=\"value\" id=\"clothing-bottom\">未知</span></div><div class=\"info-item\"><span class=\"label\">内衣:</span> <span class=\"value\" id=\"clothing-underwear\">未知</span></div><div class=\"info-item\"><span class=\"label\">内裤:</span> <span class=\"value\" id=\"clothing-panties\">未知</span></div><div class=\"info-item\"><span class=\"label\">腿:</span> <span class=\"value\" id=\"clothing-legs\">未知</span></div><div class=\"info-item\"><span class=\"label\">脚:</span> <span class=\"value\" id=\"clothing-feet\">未知</span></div></div><div class=\"info-card\"><h3>携带物品</h3><div class=\"data-grid\" id=\"carried-items\"></div></div><div class=\"info-card\"><h3>状态效果</h3><div class=\"info-item\"><span class=\"label\">永久性状态:</span><div class=\"value\" id=\"permanent-status\">无</div></div><div class=\"info-item\"><span class=\"label\">临时状态:</span><div class=\"value\" id=\"temporary-status\">无</div></div></div></div></div></div><div id=\"battle-content\" class=\"module-content\"><div class=\"section\"><h2 class=\"section-title\">⚔️ 战斗信息</h2><div class=\"data-grid\"><div class=\"info-card\"><h3>核心属性</h3><div class=\"info-item\"><span class=\"label\">生命值:</span> <span class=\"value\" id=\"battle-hp\">未知</span></div><div class=\"info-item\"><span class=\"label\">欲望值:</span> <span class=\"value\" id=\"battle-desire\">未知</span></div><div class=\"info-item\"><span class=\"label\">等级:</span> <span class=\"value\" id=\"battle-level\">未知</span></div><div class=\"info-item\"><span class=\"label\">经验值:</span> <span class=\"value\" id=\"battle-exp\">未知</span></div><div class=\"info-item\"><span class=\"label\">卡牌删除次数:</span> <span class=\"value\" id=\"battle-card-remove\">未知</span></div></div><div class=\"info-card\"><h3>战斗之书</h3><div class=\"battle-book-container\"><button class=\"battle-book-btn\" onclick=\"toggleBattleBook()\">📖 查看状态效果</button><div class=\"battle-book-content\" id=\"battle-book-content\" style=\"display:none\"></div></div></div><div class=\"info-card\"><h3>遗物</h3><div class=\"data-grid\" id=\"battle-artifacts\"></div></div><div class=\"info-card\"><h3>消耗品</h3><div class=\"data-grid\" id=\"battle-items\"></div></div><div class=\"info-card\"><h3>卡牌组合 <button id=\"delete-mode-toggle\" class=\"delete-toggle-btn\" onclick=\"toggleDeleteMode()\">🗑️<span id=\"delete-count\">0</span></button></h3><div class=\"battle-deck\" id=\"battle-deck\"></div></div></div></div></div><div id=\"npc-content\" class=\"module-content\"><div class=\"section\"><h2 class=\"section-title\">👭 NPC关系</h2><div class=\"data-grid\" id=\"npc-relations\"></div></div></div><div id=\"faction-content\" class=\"module-content\"><div class=\"section\"><h2 class=\"section-title\">🏰 势力关系</h2><div class=\"alignment-grid\" id=\"alignment-grid\"></div><div class=\"data-grid\" id=\"faction-relations\"></div></div></div></div></div></div><script>let t=null,e=null,n=null,s=null,a=!1;function o(t){return t&&'object'==typeof t?t.stat_data&&'object'==typeof t.stat_data?t.stat_data:t:{}}let l=!1,i=[],c=!1;function r(){if(c)return;const t=document.getElementById('custom-action-input'),e=document.getElementById('custom-action-send');if(!t||!e)return;c=!0;const n=async()=>{const n=(t.value||'').trim();if(n){if(!a){a=!0,e.disabled=!0,e.classList.add('disabled');try{await k(n)}catch(t){console.error('自定义行动发送失败:',t),a=!1,e.disabled=!1,e.classList.remove('disabled'),'undefined'!=typeof toastr&&toastr.error('发送失败，请重试')}finally{t.value='',t.focus()}}}else'undefined'!=typeof toastr&&toastr.info('请输入要发送的内容')};e.onclick=n,t.addEventListener('keydown',(t=>{'Enter'===t.key&&n()})),console.log('[自定义行动] 已绑定')}const d=[],u=[];!function(){const t=window;if(t.__AUGMENT_INJECT_WRAPPED)return;const e=e=>{const n=t[e];'function'==typeof n&&(t[e]=async e=>{const s=Array.isArray(e?.injects)?[...e.injects]:[];u.length&&s.push(...u.splice(0));const a=e&&'object'==typeof e?{...e,injects:s}:{injects:s};return await n.call(t,a)})};e('generate'),e('generateRaw'),t.__AUGMENT_INJECT_WRAPPED=!0}();const p={head:'头部',neck:'颈部',hands:'手部',upper_body:'上身',lower_body:'下身',underwear:'内衣',undergarments:'内裤',legs:'腿部',feet:'脚部',profession:'职业',inventory:'持有物',permanent_status:'永久状态'};function m(t){if(!t)return[];if(Array.isArray(t)){const e=[];return t.forEach(((t,n)=>{Array.isArray(t)?e.push(...x(t)):'$__META_EXTENSIBLE__$'!==t&&null!=t&&''!==t&&e.push(t)})),x(e)}return'object'==typeof t?[t]:[]}function f(t){const e=t?.reward;return e?Array.isArray(e)?e[0]:e:null}function y(t){const e=f(t);if(!e)return!1;const n=m(e.card),s=m(e.artifact),a=m(e.item);return n.length>0||s.length>0||a.length>0}function g(t,e){const n=[],s=t=>{try{return JSON.parse(t)}catch{return null}},a=t=>{if('string'!=typeof t)return null;if(!t.includes('->'))return null;console.log('🔍 解析箭头对:',t);const e=t.split('->');if(e.length<2)return null;const n=e[0].trim(),a=e.slice(1).join('->').trim();console.log('🔍 左侧:',n),console.log('🔍 右侧:',a);const o=s(n),l=s(a);return console.log('🔍 解析结果:',{oldVal:o,newVal:l}),{oldVal:o,newVal:l}},o=t?.status?.profession;'string'==typeof o&&o.includes('->')&&n.push('职业：'+o);const l=t?.status?.clothing,i=['head','neck','hands','upper_body','lower_body','underwear','undergarments','legs','feet'];if(console.log('🔍 服装 delta:',l),'string'==typeof l&&l.includes('->')&&l.includes('{')){const t=a(l);if(console.log('🔍 解析的服装对:',t),t&&t.newVal&&'object'==typeof t.newVal){const e=t.oldVal&&'object'==typeof t.oldVal?t.oldVal:{},s=t.newVal;i.forEach((t=>{const a=e?.[t]??'',o=s?.[t]??'';String(a)!==String(o)&&n.push(`${p[t]||t}：${a||'无'}->${o||'无'}`)}))}}else'object'==typeof l&&null!==l&&i.forEach((t=>{const e=l?.[t];'string'==typeof e&&e.includes('->')&&n.push(`${p[t]||t}：${e}`)}));const c=(t,e)=>{(Array.isArray(t)?t:'string'==typeof t?[t]:[]).forEach((t=>{const s=String(t),a=s.match(/ASSIGNED\\s+\"([^\"]+)\"/);a&&a[1]?n.push(`新增${e}：${a[1]}`):/新增|ADDED|\\+/.test(s)&&n.push(`新增${e}：${s.replace(/^.*?(新增|ADDED|\\+)\\s*/,'')}`)}))};c(t?.status?.permanent_status,'永久状态'),c(t?.status?.inventory,'持有物');const r=(t,e)=>{if(!t)return;console.log(`🔍 ${e} delta:`,t);(Array.isArray(t)?t:'string'==typeof t?[t]:[]).forEach((t=>{const a=String(t);if(console.log(`🔍 ${e} 条目:`,a),a.includes('[')||a.includes('{')){const t=(t=>{if('string'!=typeof t)return null;const e=t.match(/ASSIGNED\\s+(\\[.*|\\{.*)/),n=(t=>{const e=t.indexOf('[')>=0&&(-1===t.indexOf('{')||t.indexOf('[')<t.indexOf('{'))?'[':'{',n=t.indexOf(e);if(-1===n)return null;let s=0,a=!1,o=!1;for(let l=n;l<t.length;l++){const i=t[l];if(a){if(o){o=!1;continue}if('\\\\'===i){o=!0;continue}if('\"'===i){a=!1;continue}}else if('\"'!==i){if(i===e)s++;else if(i===('['===e?']':'}')&&(s--,0===s))return t.slice(n,l+1)}else a=!0}return null})(e?e[1]:t);if(!n)return null;const a=s(n);return Array.isArray(a)?a:a&&'object'==typeof a?[a]:null})(a);console.log(`🔍 ${e} 解析结果:`,t),t&&t.length&&t.forEach((t=>{const s=t?.name||t?.id||'未知',a=t?.quantity?` x${t.quantity}`:'';n.push(`新增${e}：${s}${a}`)}))}else a.includes('->')&&n.push(`${e}：${a}`)}))};r(t?.battle?.cards,'卡牌'),r(t?.battle?.artifacts,'遗物'),r(t?.battle?.items,'道具');const d=t?.battle?.player_lust_effect;if(d)if('string'==typeof d){if(d.includes('->')){const t=a(d),e=t&&t.newVal&&'object'==typeof t.newVal?t.newVal.name:null;e&&n.push(`玩家欲望效果：${e}`)}}else if('object'==typeof d&&null!==d){const t=d.name;if('string'==typeof t)if(t.includes('->')){const e=t.split('->').slice(1).join('->').trim();try{const t=JSON.parse(e),s='string'==typeof t?t:null;s&&n.push(`玩家欲望效果：${s}`)}catch{const t=e.replace(/^\"|\"$/g,'');t&&n.push(`玩家欲望效果：${t}`)}}else t&&n.push(`玩家欲望效果：${t}`)}const u=t?.battle?.core?.card_removal_count;return'string'==typeof u&&u.includes('->')&&n.push('删卡次数：'+u),n}async function h(t){await updateVariablesWith((e=>{if(!e.stat_data)throw new Error('stat_data不存在');const s=e.stat_data.reward;if(!s)throw new Error('reward数据不存在');const a=Array.isArray(s)?s[0]||{}:s,o=m(a.card),l=m(a.artifact),c=m(a.item),r=e.stat_data.battle,d=(t,e)=>{if(!e||'object'!=typeof e)return void t.push(e);const n=e.id||e.name;if(!n)return void t.push(e);const s=t.find((t=>t&&'object'==typeof t&&(t.id||t.name)===n));if(s){const t=Math.max(1,Number(e.quantity||1));s.quantity=Math.max(0,Number(s.quantity||1))+t}else null==e.quantity&&(e.quantity=1),t.push(e)},u=(t,e,n)=>{const s=(t=>{const e=r[t];return Array.isArray(e)?e.length>=2&&Array.isArray(e[0])&&'string'==typeof e[1]||e.length>=1&&Array.isArray(e[0])?e[0]:e:(console.warn(`[MVU] 目标 ${t} 不存在或非数组，跳过写入以避免破坏可扩展结构`),null)})(t);Array.isArray(s)?n.forEach((n=>{const a=e[n];null!=a&&(Array.isArray(a)?a.forEach((e=>{null!=e&&('cards'===t?d(s,e):s.push(e))})):'cards'===t?d(s,a):s.push(a))})):console.warn(`[MVU] 追加 ${t} 失败：目标不可写（不存在或非数组）`)},p={cards:[],artifacts:[],items:[]};t.cards.length&&(u('cards',o,t.cards),t.cards.forEach((t=>{const e=o[t];if(e){const t=e.name||e.id||'未知',n=e.quantity?` x${e.quantity}`:'';i.push(`新增卡牌：${t}${n}`),p.cards.push(t+n)}}))),t.artifacts.length&&(u('artifacts',l,t.artifacts),t.artifacts.forEach((t=>{const e=l[t];if(e){const t=e.name||e.id||'未知',n=e.quantity?` x${e.quantity}`:'';i.push(`新增遗物：${t}${n}`),p.artifacts.push(t+n)}}))),t.items.length&&(u('items',c,t.items),t.items.forEach((t=>{const e=c[t];if(e){const t=e.name||e.id||'未知',n=e.count?` x${e.count}`:e.quantity?` x${e.quantity}`:'';i.push(`新增道具：${t}${n}`),p.items.push(t+n)}})));try{if(p.cards.length+p.artifacts.length+p.items.length>0){const t=[];p.cards.length&&t.push(`卡牌[${p.cards.join('，')}]`),p.artifacts.length&&t.push(`遗物[${p.artifacts.join('，')}]`),p.items.length&&t.push(`道具[${p.items.join('，')}]`),n=`本轮玩家领取奖励：${t.join(' ')}`,console.log('🎯 已生成领取摘要（待绑定至选项发送）：',n)}}catch(t){console.warn('生成领取摘要失败:',t)}return a.card=[],a.artifact=[],a.item=[],a.limits={},Array.isArray(s)&&(e.stat_data.reward[0]=a),e}),{type:'message'})}function v(){const n=t||{},s=e||{};console.log('📢 渲染通知模块 - stat:',n),console.log('📢 渲染通知模块 - delta:',s),console.log('📢 渲染通知模块 - 用户操作 pills:',i);const a=t=>{t.forEach((t=>{d.includes(t)||d.push(t)}))};a(g(s)),i.length&&a(i),i=[],console.log('📢 渲染通知模块 - 最终 pills:',d);const o=e?.battle?.exp,l=e?.battle?.level;let c=!1;if('string'==typeof o&&o.includes('->')){const t=o.split('->'),e=parseInt(t[0].trim(),10),n=parseInt(t.slice(1).join('->').trim(),10);!isNaN(e)&&!isNaN(n)&&n>e&&(c=!0)}const r='string'==typeof l&&l.includes('->'),u=document.getElementById('notify-section'),p=document.getElementById('changes-section'),m=document.getElementById('exp-section'),f=document.getElementById('changes-list'),y=document.getElementById('exp-display'),h=document.getElementById('level-exp-badge');if(!(u&&p&&m&&f&&y&&h))return;if(d.length>0?(p.style.display='block',f.innerHTML=d.map((t=>`<span class=\"pill\">${t}</span>`)).join('')):p.style.display='none',c||r){m.style.display='block';const t=[];if(c&&'string'==typeof o&&o.includes('->')){const e=o.split('->'),s=parseInt(e[0].trim(),10)||0,a=parseInt(e.slice(1).join('->').trim(),10)||0,l=Number(n?.battle?.level??1),i=Number(n?.battle?.exp??0);let c=l,r=i,d=a-s;for(;d>0&&c>1;)r>=d?(r-=d,d=0):(d-=r,c--,r=Math.max(50*c,50)-1);if(d>0){r=s,c=1;let t=r;for(;t>=50*c;)t-=50*c,c++;r=t}const u=Math.max(50*c,50),p=Math.max(50*l,50);t.push(`等级：LV ${c} -> LV ${l}`),t.push(`经验值：${r}/${u} -> ${i}/${p}`)}else{const e=Number(n?.battle?.level??1),s=Number(n?.battle?.exp??0),a=Math.max(50*e,50);t.push(`等级：LV ${e}`),t.push(`经验值：${s}/${a}`)}y.innerHTML=t.map((t=>`<div class=\"exp-item\"><span class=\"exp-icon\">✨</span><span class=\"exp-text\">${t}</span></div>`)).join('');const e=Number(n?.battle?.level??1),s=Number(n?.battle?.exp??0);h.textContent=`Lv.${e} · EXP ${s}`,h.style.display='block'}else m.style.display='none',h.style.display='none';const v=d.length>0||c||r;u.style.display=v?'block':'none'}function b(){const e=t||{},s=f(e)||{},a=function(t){const e=f(t)||{};return{cards:e?.limits?.cards||1,artifacts:e?.limits?.artifacts||1,items:e?.limits?.items||1}}(e),o=m(s.card),i=m(s.artifact),c=m(s.item),r=document.getElementById('choice-container'),d=document.getElementById('card-rewards-section'),u=document.getElementById('artifact-rewards-section'),p=document.getElementById('item-rewards-section');if(!(r&&d&&u&&p))return;if(o.length>0){d.style.display='block';const t=document.getElementById('card-options'),e=document.getElementById('card-selection-count'),n=document.getElementById('card-selected'),s=document.getElementById('card-max');if(t&&e&&n&&s){e.textContent=`${o.length}选${a.cards}`,s.textContent=String(a.cards);const n='checkbox',l='';t.innerHTML=o.map(((t,e)=>`\\n        <label class=\"option\">\\n          <input type=\"${n}\" ${l?`name=\"${l}\"`:''} value=\"${e}\" />\\n          <span class=\"icon\">${t.emoji||'🃏'}</span>\\n          <span class=\"text\">\\n            <div class=\"name\">${t.name||'未知'}</div>\\n            <div class=\"desc\">${t.description||'无描述'}</div>\\n          </span>\\n        </label>\\n      `)).join('')}}else d.style.display='none';if(i.length>0){u.style.display='block';const t=document.getElementById('artifact-options'),e=document.getElementById('artifact-selection-count'),n=document.getElementById('artifact-selected'),s=document.getElementById('artifact-max');if(t&&e&&n&&s){e.textContent=`${i.length}选${a.artifacts}`,s.textContent=String(a.artifacts);const n='checkbox',o='';t.innerHTML=i.map(((t,e)=>`\\n        <label class=\"option\">\\n          <input type=\"${n}\" ${o?`name=\"${o}\"`:''} value=\"${e}\" />\\n          <span class=\"icon\">${t.emoji||'💎'}</span>\\n          <span class=\"text\">\\n            <div class=\"name\">${t.name||'未知'}</div>\\n            <div class=\"desc\">${t.description||'无描述'}</div>\\n          </span>\\n        </label>\\n      `)).join('')}}else u.style.display='none';if(c.length>0){p.style.display='block';const t=document.getElementById('item-options'),e=document.getElementById('item-selection-count'),n=document.getElementById('item-selected'),s=document.getElementById('item-max');if(t&&e&&n&&s){e.textContent=`${c.length}选${a.items}`,s.textContent=String(a.items);const n='checkbox',o='';t.innerHTML=c.map(((t,e)=>`\\n        <label class=\"option\">\\n          <input type=\"${n}\" ${o?`name=\"${o}\"`:''} value=\"${e}\" />\\n          <span class=\"icon\">${t.emoji||'🧪'}</span>\\n          <span class=\"text\">\\n            <div class=\"name\">${t.name||'未知'}</div>\\n            <div class=\"desc\">${t.description||'无描述'}</div>\\n          </span>\\n        </label>\\n      `)).join('')}}else p.style.display='none';const y=o.length>0||i.length>0||c.length>0;r.style.display=y?'flex':'none',y&&function(t,e,s,a){const o={cards:[],artifacts:[],items:[]},i=(t,e)=>'cards'===t?`card-${e}`:'artifacts'===t?`artifact-${e}`:`item-${e}`;function c(n,l){const c=document.getElementById(i(n,'options')),r=document.getElementById(i(n,'selected'));c&&c.querySelectorAll('input[type=\"checkbox\"]').forEach((i=>{i.addEventListener('change',(i=>{const d=i.target,u=parseInt(d.value),p=o[n];if(d.checked)if(1===l){if(1===p.length&&p[0]!==u){const t=p[0],e=c.querySelector(`input[type=\"checkbox\"][value=\"${t}\"]`);e&&(e.checked=!1),p.length=0}-1===p.indexOf(u)&&p.push(u)}else-1===p.indexOf(u)&&(p.length<l?p.push(u):d.checked=!1);else{const t=p.indexOf(u);-1!==t&&p.splice(t,1)}r&&(r.textContent=String(o[n].length)),E(o,t,e,s,a)}))}))}c('cards',a.cards),c('artifacts',a.artifacts),c('items',a.items),E(o,t,e,s,a);const r=document.getElementById('confirm-btn');if(r){const i=r.cloneNode(!0);r.parentNode?.replaceChild(i,r),i.addEventListener('click',(async()=>{if(l)return;if(t.length>0&&o.cards.length<Math.min(a.cards,t.length)||e.length>0&&o.artifacts.length<Math.min(a.artifacts,e.length)||s.length>0&&o.items.length<Math.min(a.items,s.length)){let t=document.getElementById('inline-confirm-bar');if(!t){i.style.display='none',t=document.createElement('div'),t.id='inline-confirm-bar',t.style.cssText=['margin-top:8px','padding:12px','border:1px solid #ffd666','background:#fff7e6','border-radius:8px','box-shadow:0 1px 4px rgba(0,0,0,0.06)'].join(';'),t.innerHTML='\\n            <div style=\"display:flex;align-items:center;gap:12px;flex-wrap:wrap;\">\\n              <span style=\"color:#ad6800;\">您尚未选满所有奖励上限，是否以当前选择继续领取？</span>\\n              <div style=\"display:flex;gap:8px;\">\\n                <button id=\"inline-confirm-yes\" class=\"option-btn\">继续领取</button>\\n                <button id=\"inline-confirm-no\" class=\"option-btn\" style=\"background:#f0f0f0;color:#333;\">取消</button>\\n              </div>\\n            </div>\\n          ',i.parentElement?.appendChild(t);const e=document.getElementById('inline-confirm-yes'),n=document.getElementById('inline-confirm-no');e?.addEventListener('click',(async()=>{t.remove(),i.style.display='',await c()})),n?.addEventListener('click',(()=>{t.remove(),i.style.display=''}))}}else await c();async function c(){try{l=!0,i.disabled=!0;const a=document.getElementById('choice-container');a&&(a.style.display='none'),await h(o);try{const a=[];if(o.cards.length){const e=o.cards.map((e=>(t[e]?.name||t[e]?.id||'未知')+(t[e]?.quantity?` x${t[e]?.quantity}`:''))).filter(Boolean);e.length&&a.push(`卡牌[${e.join('，')}]`)}if(o.artifacts.length){const t=o.artifacts.map((t=>(e[t]?.name||e[t]?.id||'未知')+(e[t]?.quantity?` x${e[t]?.quantity}`:''))).filter(Boolean);t.length&&a.push(`遗物[${t.join('，')}]`)}if(o.items.length){const t=o.items.map((t=>(s[t]?.name||s[t]?.id||'未知')+(s[t]?.count?` x${s[t]?.count}`:s[t]?.quantity?` x${s[t]?.quantity}`:''))).filter(Boolean);t.length&&a.push(`道具[${t.join('，')}]`)}n=a.length?`{{user}}已获得：${a.join(' ')}`:'{{user}}没有领取奖励',console.log('✅ 已缓存本轮奖励选择摘要（将附带到下一次选项发送中）:',n)}catch(t){console.warn('插入玩家奖励选择消息失败:',t)}v(),'undefined'!=typeof toastr&&toastr.success('奖励已成功领取！','恭喜！'),setTimeout((()=>window.refreshData()),200)}catch(t){console.error('确认领取失败',t),'undefined'!=typeof toastr&&toastr.error('领取奖励失败，请重试','错误')}finally{l=!1}}}))}}(o,i,c,a)}function E(t,e,n,s,a){const o=document.getElementById('confirm-btn');o&&(o.disabled=l)}function w(e){if(l)return;console.log('🎁 渲染奖励内联 - 开始'),console.log('🎁 渲染奖励内联 - 可选奖励:',y(t));const n=y(t),s=e.previousElementSibling||null;e.style.display=n?'none':'',s&&s.classList.contains('section-title')&&(s.style.display=n?'none':''),v(),b(),r();const a=document.getElementById('notify-dismiss-btn');a&&a.addEventListener('click',(()=>{const t=document.getElementById('notify-section');t&&(t.style.display='none')})),r()}function x(t){return Array.isArray(t)?t.filter((t=>'$__META_EXTENSIBLE__$'!==t&&'[]'!==t&&null!=t&&''!==t)):[]}async function I(){try{let n=null,a={};try{n=getVariables({type:'message'}),t=o(n)||{},e=n?.delta_data||n?.delta||{},a=t,console.log('🔄 加载游戏数据 - 变量:',n),console.log('🔄 加载游戏数据 - stat_data:',t),console.log('🔄 加载游戏数据 - delta_data:',e)}catch(t){return void console.warn('获取变量失败：',t)}try{await async function(){try{await updateVariablesWith((async t=>{const e=o(t)||{},n=e?.battle||t?.battle;if(!n)return t;n.core||(n.core={});let s=Number(n.level)||1,a=Number(n.exp)||0,l=0;const i=t=>Math.max(50*t,50);for(;a>=i(s);)if(a-=i(s),s+=1,l+=1,s%2==0){const t=Number(n.core.card_removal_count)||0;n.core.card_removal_count=t+1}return l>0&&(n.level=s,n.exp=a),t}),{type:'message'})}catch(t){console.warn('结算升级失败：',t)}}()}catch(t){console.warn('结算升级异常:',t)}try{n=getVariables({type:'message'}),t=o(n)||{},e=n?.delta_data||n?.delta||{},a=t,s={level:Number(t?.battle?.level??1),exp:Number(t?.battle?.exp??0)}}catch(t){console.warn('结算后重新获取变量失败：',t)}!function(t){const e=t.status||{};[{id:'status-time',path:'time'},{id:'status-location',path:'location_weather'},{id:'status-title',path:'title'},{id:'status-job',path:'profession'}].forEach((({id:t,path:n})=>{const s=document.getElementById(t);s&&(s.textContent=e?.[n]||'未知')}));const n=e.clothing||{};[{id:'clothing-head',path:'head'},{id:'clothing-neck',path:'neck'},{id:'clothing-hands',path:'hands'},{id:'clothing-top',path:'upper_body'},{id:'clothing-bottom',path:'lower_body'},{id:'clothing-underwear',path:'underwear'},{id:'clothing-panties',path:'panties'},{id:'clothing-legs',path:'legs'},{id:'clothing-feet',path:'feet'}].forEach((({id:t,path:e})=>{const s=document.getElementById(t);s&&(s.textContent=n?.[e]||'未穿戴')}));let s=e?.inventory||[];s=s.filter((t=>null!=t&&''!==t));const a=document.getElementById('carried-items');a&&(s.length>0?a.innerHTML=s.map((t=>`<div class=\"info-item\"><span class=\"value\">${t}</span></div>`)).join(''):a.innerHTML='<div class=\"info-item\"><span class=\"value\">无</span></div>');let o=e?.permanent_status||[],l=e?.temporary_status||[];o=o.filter((t=>null!=t&&''!==t)),l=l.filter((t=>null!=t&&''!==t));const i=document.getElementById('permanent-status');i&&(i.innerHTML=o.length>0?o.map((t=>`<div class=\"info-item\"><span class=\"value\">${t}</span></div>`)).join(''):'<div class=\"info-item\"><span class=\"value\">无</span></div>');const c=document.getElementById('temporary-status');c&&(c.innerHTML=l.length>0?l.map((t=>`<div class=\"info-item\"><span class=\"value\">${t}</span></div>`)).join(''):'<div class=\"info-item\"><span class=\"value\">无</span></div>')}(a),function(t){const e=t.battle||{},n=e.core||{},s=m(e.cards),a=m(e.artifacts),o=m(e.items),l=document.getElementById('battle-hp');if(l){const t=n?.hp||0,e=n?.max_hp||100;l.textContent=`${t}/${e}`}const i=document.getElementById('battle-desire');if(i){const t=n?.lust||0,e=n?.max_lust||100;i.textContent=`${t}/${e}`}const c=document.getElementById('battle-level');if(c){const t=e?.level||1;c.textContent=`LV ${t}`}const r=document.getElementById('battle-exp');if(r){const t=Number(e?.exp)||0,n=Number(e?.level)||1,s=Math.max(50*n,50);r.textContent=`${t}/${s}`}const d=document.getElementById('delete-count');if(d){const t=n?.card_removal_count||0;d.textContent=t.toString()}const u=document.getElementById('battle-card-remove');if(u){const t=n?.card_removal_count||0;u.textContent=t.toString()}const p=document.getElementById('battle-deck'),f=document.getElementById('battle-artifacts'),y=document.getElementById('battle-items');if(p){const t=x(s||[]);if(t.length>0){const e=t.map((t=>{return`\\n          <div class=\"card\" data-card-id=\"${t.id}\">\\n            <div class=\"card-delete-btn\" onclick=\"removeCard('${t.id}')\" style=\"display: none;\">\\n              🗑️\\n            </div>\\n            <div class=\"card-name\">${t.emoji||'🃏'} ${t.name}</div>\\n            <div class=\"card-cost\">消耗: ${t.cost||0}</div>\\n            <div class=\"card-type\">${e=t.type||'Skill',{Attack:'攻击',Skill:'技能',Power:'能力',Event:'事件',Corrupt:'腐化'}[e]||e}</div>\\n            <div class=\"card-quantity\">数量: ${t.quantity||1}</div>\\n          </div>`;var e})).join('');p.innerHTML=e}else p.innerHTML='<div class=\"value\">牌库为空</div>'}if(f){const t=x(a);t.length>0?f.innerHTML=t.map((t=>`\\n          <div class=\"info-item\">\\n            <span class=\"value\">${t.emoji||'💎'} ${t.name}: ${t.description}</span>\\n          </div>`)).join(''):f.innerHTML='<div class=\"value\">无遗物</div>'}if(y){const t=x(o);t.length>0?y.innerHTML=t.map((t=>`\\n          <div class=\"info-item\">\\n            <span class=\"value\">${t.emoji||'🧪'} ${t.name} x${t.count||1}</span>\\n            <div class=\"item-description\">${t.description||'无描述'}</div>\\n          </div>`)).join(''):y.innerHTML='<div class=\"value\">无道具</div>'}window.battleBookData={playerStatusEffects:e.player_status_effects||[],statuses:e.statuses||[]}}(a),function(t){const e=t.npcs||{},n=document.getElementById('npc-relations');if(n){const t=Object.entries(e).filter((([t,e])=>'$meta'!==t&&e&&'object'==typeof e&&!Array.isArray(e)&&(e.name||e.NPC姓名)));t.length>0?n.innerHTML=t.map((([t,e])=>{const n=e?.name||t,s=e?.tracking||!1,a=e?.current_action||'无动作',o=e?.affection||0,l=e?.affection_level||'未知';return`<div class=\"info-card\">\\n            <h3 class=\"card-title\">${n}</h3>\\n            <div class=\"info-item\">\\n              <span class=\"label\">追踪状态:</span>\\n              <span class=\"value\">${s?'追踪中':'未追踪'}</span>\\n              <button class=\"tracking-btn ${s?'tracking-on':'tracking-off'}\"\\n                      onclick=\"toggleNPCTracking('${t}', ${!s})\">\\n                ${s?'🔴 停止追踪':'🟢 开始追踪'}\\n              </button>\\n            </div>\\n            ${s?`<div class=\"info-item\">\\n              <span class=\"label\">当前行动:</span>\\n              <span class=\"value\">${a}</span>\\n            </div>`:''}\\n            <div class=\"info-item\">\\n              <span class=\"label\">好感度:</span>\\n              <span class=\"value\">${o} ${l?`(${l})`:''}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">阵营:</span>\\n              <span class=\"value\">${e?.alignment||'未知阵营'}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">对主角的看法/关系:</span>\\n              <span class=\"value\">${e?.relationship||'未知关系'}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">与其他NPC关系:</span>\\n              <span class=\"value\">${e?.other_npc_relations||'无'}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">等级:</span>\\n              <span class=\"value\">LV ${e?.level||1}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">外貌描述:</span>\\n              <span class=\"value\">${e?.appearance||'无描述'}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">能力描述:</span>\\n              <span class=\"value\">${e?.abilities||'无'}</span>\\n            </div>\\n            <div class=\"info-item\">\\n              <span class=\"label\">战斗风格描述:</span>\\n              <span class=\"value\">${e?.battle_style||'无'}</span>\\n            </div>\\n          </div>`})).join(''):n.innerHTML='<div class=\"info-card\"><h3>暂无NPC关系</h3></div>'}}(a),function(t){const e=t.factions||{},n=e?.player_alignment||'绝对中立',s=x(e.relations||[]);!function(t){const e=document.getElementById('alignment-grid');if(!e)return;const n=['守序善良','中立善良','混乱善良','守序中立','绝对中立','混乱中立','守序邪恶','中立邪恶','混乱邪恶'];e.innerHTML='',n.forEach((n=>{const s=document.createElement('div');s.className='alignment-cell'+(n===t?' active':''),s.textContent=n,e.appendChild(s)}))}(n);const a=document.getElementById('faction-relations');a&&(s.length>0?a.innerHTML=s.map((t=>`\\n        <div class=\"info-card\">\\n          <h3>${t.name}</h3>\\n          <div class=\"info-item\">\\n            <span class=\"label\">状态:</span>\\n            <span class=\"value faction-status ${t.status?.toLowerCase()||'neutral'}\">${t.status||'中立'}</span>\\n          </div>\\n          <div class=\"info-item\">\\n            <span class=\"label\">声望:</span>\\n            <span class=\"value\">${t.reputation||0}</span>\\n          </div>\\n          <div class=\"info-item\">\\n            <span class=\"label\">备注:</span>\\n            <span class=\"value\">${t.note||'无'}</span>\\n          </div>\\n        </div>\\n      `)).join(''):a.innerHTML='<div class=\"info-card\"><h3>暂无势力关系</h3></div>')}(a),console.log('🔄 加载游戏数据 - 开始渲染选项'),B(),console.log('🔄 加载游戏数据 - 渲染选项完成')}catch(t){console.error('加载游戏数据失败:',t)}}function B(){const n=document.querySelector('.options-text');if(!n)return;a=!1,r();let s=n.innerHTML.trim();console.log('Options HTML内容:',s),s.includes('<Option')||s.includes('<BattleOption')||(s=n.textContent||n.innerText||'',console.log('Options文本内容:',s));const l=s.includes('<REWARD>');s.replace(/<REWARD>/g,'').trim();try{if(!t){const n=getVariables({type:'message'});t=o(n)||{},e=n?.delta_data||n?.delta||{}}}catch(t){console.warn('获取变量失败（奖励预处理）',t)}console.log('🔍 当前 delta_data:',e),console.log(' 当前 stat_data:',t);try{console.log('📦 完整 stat_data JSON:',JSON.stringify(t,null,2))}catch(t){console.warn('stat_data 序列化失败:',t)}n.style.display='';const i=y(t),c=g(e||{}),d=e?.battle?.exp,u=e?.battle?.level,p=c.length>0||'string'==typeof d&&d.includes('->')||'string'==typeof u&&u.includes('->');if(console.log('🔍 通知 pills:',c),console.log('🔍 经验变化:',d),console.log('🔍 等级变化:',u),console.log('🔍 有通知:',p),console.log('🎯 渲染选项 - 有可选奖励:',i),console.log('🎯 渲染选项 - 有奖励标签:',l),console.log('🎯 渲染选项 - 有通知:',p),i)return console.log('🎯 渲染选项 - 渲染奖励内联（有可选奖励）'),void w(n);if((l||p)&&(console.log('🎯 渲染选项 - 渲染奖励内联（有奖励标签或通知）'),w(n)),'1'===n.getAttribute('data-options-rendered'))return;if(n.innerHTML='',!s.trim())return;const m=/<(Option|BattleOption)[^>]*>([\\s\\S]*?)<\\/\\1>/g;let f,h=!1;for(;null!==(f=m.exec(s));){h=!0;const t=f[1],e=f[2].trim();if(console.log('匹配到选项:',t,e),e){const s=document.createElement('button');'BattleOption'===t?(s.className='battle-option-btn',s.addEventListener('click',(()=>A(e))),console.log('创建战斗选项按钮:',e,'className:',s.className)):(s.className='option-btn',s.addEventListener('click',(()=>k(e))),console.log('创建普通选项按钮:',e,'className:',s.className)),s.textContent=e,n.appendChild(s),console.log('按钮已添加到DOM，最终className:',s.className)}}if(n.setAttribute('data-options-rendered','1'),!h){console.log('没有匹配到任何选项，尝试按行解析');s.split(/\\r?\\n/).map((t=>t.trim())).filter((t=>t&&!t.startsWith('<')&&!t.endsWith('>'))).forEach((t=>{const e=t.replace(/^\\d+[.、)]?\\s*/,'').trim();if(e){const t=document.createElement('button'),s=/[\\u2694\\u26A1]|战斗|攻击|迎击|冲击/u.test(e),o=async()=>{if(!a){a=!0,t.disabled=!0,t.classList.add('disabled');try{s?await A(e):await k(e)}catch(e){console.error('选项发送失败:',e),a=!1,t.disabled=!1,t.classList.remove('disabled'),'undefined'!=typeof toastr&&toastr.error('发送失败，请重试')}}};s?(t.className='battle-option-btn',t.addEventListener('click',o),console.log('按文本识别创建战斗选项:',e)):(t.className='option-btn',t.addEventListener('click',o),console.log('按文本识别创建普通选项:',e)),t.textContent=e,n.appendChild(t)}}))}}async function A(t){console.log('🔥 战斗选项被点击:',t);try{const e=`用户选择了战斗选项：${t}${n?`\\n\\n${n}`:''}\\n\\n[开始战斗]`;await triggerSlash(`/send ${e}`),await triggerSlash('/trigger'),console.log('✅ 战斗触发消息已发送，等待AI生成战斗内容')}catch(t){console.error('❌ 触发战斗失败:',t),alert('触发战斗失败，请重试')}finally{n=null}}async function k(t){console.log('🎯 普通选项被点击:',t);try{const e=`用户的选择是：${t}${n?`\\n\\n${n}`:''}`;await triggerSlash(`/send ${e}`),await triggerSlash('/trigger')}catch(t){console.error('发送选项失败',t),alert('发送选项失败，请重试')}finally{n=null}}window.refreshData=async function(){console.log('刷新游戏数据'),await I()},window.removeCard=async function(t){try{if(!t)return void console.warn('无效的卡牌ID');await updateVariablesWith((e=>{const n=e?.stat_data?.battle||e?.battle;if(!n)throw new Error('未找到 battle 变量');const s=e=>{let n=0;return{processed:(e||[]).map((e=>{if(e&&e.id===t){const t=Number(e.quantity)||1;return t>1?(n++,{...e,quantity:t-1}):(n++,null)}return e})).filter((t=>null!==t)),removed:n}};let a=0;if(Array.isArray(n.cards))if(n.cards.length>=2&&Array.isArray(n.cards[0])&&'string'==typeof n.cards[1]){const t=s(n.cards[0]);n.cards[0]=t.processed,a+=t.removed}else if(n.cards.length>=1&&Array.isArray(n.cards[0])){const t=s(n.cards[0]);n.cards[0]=t.processed,a+=t.removed}else{const t=s(n.cards);n.cards=t.processed,a+=t.removed}n.core||(n.core={});const o=Number(n.core.card_removal_count)||0;return a>0&&(n.core.card_removal_count=Math.max(0,o-1)),e}),{type:'message'}),'undefined'!=typeof toastr&&toastr.success('已删除所选卡牌');try{await I()}catch(t){console.warn('刷新数据失败:',t)}}catch(t){console.error('删除卡牌失败:',t),'undefined'!=typeof toastr&&toastr.error('删除卡牌失败，请重试')}},window.toggleBattleBook=function(){const t=document.getElementById('battle-book-content'),e=document.querySelector('.battle-book-btn');t&&e&&('none'===t.style.display?(t.style.display='block',e.textContent='📖 隐藏状态效果',function(){const t=document.getElementById('battle-book-content');if(!t)return;const e=window.battleBookData;if(!e)return void(t.innerHTML='<div class=\"value\">无战斗数据</div>');const n=x(e.playerStatusEffects),s=x(e.statuses);let a='';n.length>0&&(a+='<div class=\"battle-book-section\"><h4>🔥 当前状态效果</h4>',n.forEach((t=>{a+=`\\n        <div class=\"status-effect-item\">\\n          <div class=\"status-header\">\\n            <span class=\"status-icon\">${t.emoji||'✨'}</span>\\n            <span class=\"status-name\">${t.name}</span>\\n            <span class=\"status-stacks\">${t.stacks||1}</span>\\n            ${t.duration?`<span class=\"status-duration\">(${t.duration}回合)</span>`:''}\\n          </div>\\n          <div class=\"status-description\">${t.description||'无描述'}</div>\\n        </div>\\n      `})),a+='</div>');s.length>0&&(a+='<div class=\"battle-book-section\"><h4>📚 状态效果图鉴</h4>',s.forEach((t=>{a+=`\\n        <div class=\"status-effect-item\">\\n          <div class=\"status-header\">\\n            <span class=\"status-icon\">${t.emoji||'✨'}</span>\\n            <span class=\"status-name\">${t.name}</span>\\n            <span class=\"status-type ${t.type}\">${'buff'===t.type?'BUFF':'DEBUFF'}</span>\\n          </div>\\n          <div class=\"status-description\">${t.description||'无描述'}</div>\\n          ${t.triggers?`<div class=\"status-triggers\">触发: ${JSON.stringify(t.triggers)}</div>`:''}\\n        </div>\\n      `})),a+='</div>');''===a&&(a='<div class=\"value\">暂无状态效果数据</div>');t.innerHTML=a}()):(t.style.display='none',e.textContent='📖 查看状态效果'))},window.toggleNPCTracking=async function(t,e){console.warn('[只读模式] common 页面不修改 NPC 追踪状态。')},window.gainExperience=async function(t=160){console.warn('[只读模式] common 页面不在此处直接写入经验。')},window.toggleDeleteMode=function(){const t=document.getElementById('battle-deck'),e=document.getElementById('delete-mode-toggle');if(!t||!e)return;const n=window.getVariables?.({type:'message'})||{},s=n?.stat_data?.battle||n?.battle;if((Number(s?.core?.card_removal_count)||0)<=0)return void('undefined'!=typeof toastr&&toastr.warning('删卡次数不足，无法进入删除模式'));if(t.classList.contains('delete-mode')){t.classList.remove('delete-mode'),e.style.backgroundColor='#ff6b6b';t.querySelectorAll('.card-delete-btn').forEach((t=>{t.style.display='none'}))}else{t.classList.add('delete-mode'),e.style.backgroundColor='#51cf66';t.querySelectorAll('.card-delete-btn').forEach((t=>{t.style.display='block'}))}},window.debugData=function(){try{const t=getVariables({type:'message'});if(console.log('=== 完整数据结构 ==='),console.log(t),t?.stat_data){if(console.log('=== stat_data 结构 ==='),console.log(t.stat_data),t.stat_data.status){console.log('=== 状态数据详细分析 ===');const e=t.stat_data.status;Object.keys(e).forEach((t=>{const n=e[t];console.log(`${t}:`,{type:typeof n,isArray:Array.isArray(n),value:n,length:Array.isArray(n)?n.length:'N/A'})})),console.log('=== 重点检查数组字段 ==='),console.log('持有物:',e.inventory),console.log('永久性状态:',e.permanent_status),console.log('临时状态:',e.temporary_status)}t.stat_data.battle&&(console.log('=== 战斗数据 ==='),console.log('battle.items:',t.stat_data.battle.items),console.log('battle.artifacts:',t.stat_data.battle.artifacts)),t.stat_data.npcs&&(console.log('=== NPC数据 ==='),console.log('npcs:',t.stat_data.npcs))}alert('数据结构已输出到控制台，请查看')}catch(t){console.error('调试失败:',t),alert('调试失败: '+(t?.message||'未知错误'))}},window.testVariableOperations=async function(){console.warn('[只读模式] 已禁用本页面的测试变量写入操作。')},window.switchToStory=function(){const t=document.querySelector('.tab-button[data-module=\"story\"]');t&&t.click()},'undefined'!=typeof window&&document.addEventListener('DOMContentLoaded',(async()=>{console.log('RPG UI 静态模板已加载 - 使用酒馆变量宏系统'),console.log('初始化RPG UI界面'),B(),function(){const t=document.querySelectorAll('.tab-button'),e=document.querySelectorAll('.module-content');t.forEach((n=>{n.addEventListener('click',(function(){const n=this.getAttribute('data-module');t.forEach((t=>t.classList.remove('active'))),e.forEach((t=>t.style.display='none')),this.classList.add('active');const s=document.getElementById(n+'-content');s&&(s.style.display='block')}))}))}(),await I(),console.log('✅ Common模块完全初始化完成')}));</script></body></html>\n```",
    "trimStrings": [],
    "placement": [
        2
    ],
    "disabled": false,
    "markdownOnly": true,
    "promptOnly": false,
    "runOnEdit": false,
    "substituteRegex": 0,
    "minDepth": null,
    "maxDepth": 5
}